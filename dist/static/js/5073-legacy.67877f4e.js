"use strict";(self["webpackChunksphere_dashboard"]=self["webpackChunksphere_dashboard"]||[]).push([[5073],{92902:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:function(){return count_item}});var runtime_core_esm_bundler=__webpack_require__(66252);var shared_esm_bundler=__webpack_require__(3577);var _withScopeId=function _withScopeId(n){return(0,runtime_core_esm_bundler.dD)("data-v-7dbcedfc"),n=n(),(0,runtime_core_esm_bundler.Cn)(),n};var _hoisted_1=_withScopeId((function(){return(0,runtime_core_esm_bundler._)("hr",null,null,-1)}));function render(_ctx,_cache,$props,$setup,$data,$options){var _component_ssf_text=(0,runtime_core_esm_bundler.up)("ssf-text");var _component_ssf_title=(0,runtime_core_esm_bundler.up)("ssf-title");var _component_ssf_loader=(0,runtime_core_esm_bundler.up)("ssf-loader");var _component_ssf_container=(0,runtime_core_esm_bundler.up)("ssf-container");return(0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_container,{class:"bg-white p-3 rounded z-depth-1 mt-3 mx-auto",name:"count-item","not-full":""},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_container,{class:"text-center"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[_ctx.countValue?((0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_title,{key:0,class:"font-weight-light text-uppercase",h2:""},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_text,null,{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Uk)((0,shared_esm_bundler.zw)(_ctx.countValue),1)]})),_:1})]})),_:1})):((0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_loader,{key:1,class:"mx-auto count-item-loader",double:"",size:"38px",stroke:"1px"}))]})),_:1}),_hoisted_1,(0,runtime_core_esm_bundler.Wm)(_component_ssf_container,{class:"text-center"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_text,{class:"font-weight-light text-uppercase h4-responsive"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Uk)((0,shared_esm_bundler.zw)(_ctx.label),1)]})),_:1})]})),_:1})]})),_:1})}var es_number_constructor=__webpack_require__(9653);var helpers=__webpack_require__(56818);var count_itemvue_type_script_lang_ts=(0,runtime_core_esm_bundler.aZ)({name:"count-item",props:{count:{type:[String,Number,null],required:true},label:{type:String,required:true}},setup:function setup(props){var countValue=(0,runtime_core_esm_bundler.Fl)((function(){return props.count!==null?helpers.Rx.pretty(props.count):null}));return{countValue:countValue}}});var exportHelper=__webpack_require__(83744);const __exports__=(0,exportHelper.Z)(count_itemvue_type_script_lang_ts,[["render",render],["__scopeId","data-v-7dbcedfc"]]);var count_item=__exports__},5073:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:function(){return components}});var runtime_core_esm_bundler=__webpack_require__(66252);var logo_animated=__webpack_require__(73277);var _withScopeId=function _withScopeId(n){return(0,runtime_core_esm_bundler.dD)("data-v-ce3ef3b8"),n=n(),(0,runtime_core_esm_bundler.Cn)(),n};var _hoisted_1=_withScopeId((function(){return(0,runtime_core_esm_bundler._)("img",{id:"animatedLogo",alt:"Animated logo",class:"img-fluid mx-auto d-block",src:logo_animated},null,-1)}));var _hoisted_2=(0,runtime_core_esm_bundler.Uk)("Dashboard");function render(_ctx,_cache,$props,$setup,$data,$options){var _component_ssf_container=(0,runtime_core_esm_bundler.up)("ssf-container");var _component_logo=(0,runtime_core_esm_bundler.up)("logo");var _component_ssf_text=(0,runtime_core_esm_bundler.up)("ssf-text");var _component_count_item=(0,runtime_core_esm_bundler.up)("count-item");var _component_ssf_col=(0,runtime_core_esm_bundler.up)("ssf-col");var _component_ssf_row=(0,runtime_core_esm_bundler.up)("ssf-row");return(0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_container,{class:"color-1 bg-color-1",name:"home"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_container,{class:"py-3"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[_hoisted_1]})),_:1}),(0,runtime_core_esm_bundler.Wm)(_component_ssf_container,{class:"bg-white p-3 rounded z-depth-1","not-full":""},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_container,{class:"full-flex"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_logo,{class:"mb-3 home-logo"})]})),_:1}),(0,runtime_core_esm_bundler.Wm)(_component_ssf_container,{class:"text-center"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_text,{class:"font-weight-light text-uppercase h4-responsive"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[_hoisted_2]})),_:1})]})),_:1})]})),_:1}),(0,runtime_core_esm_bundler.Wm)(_component_ssf_row,null,{default:(0,runtime_core_esm_bundler.w5)((function(){return[((0,runtime_core_esm_bundler.wg)(true),(0,runtime_core_esm_bundler.iD)(runtime_core_esm_bundler.HY,null,(0,runtime_core_esm_bundler.Ko)(_ctx.countItems,(function(countItem){return(0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_col,{lg:"3",xs:"12",md:"4"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_count_item,{count:countItem.count,label:countItem.label},null,8,["count","label"])]})),_:2},1024)})),256))]})),_:1})]})),_:1})}var asyncToGenerator=__webpack_require__(48534);var regenerator=__webpack_require__(19298);var regenerator_default=__webpack_require__.n(regenerator);var logo=__webpack_require__(52013);var objectSpread2=__webpack_require__(95082);var reactivity_esm_bundler=__webpack_require__(2262);var createClass=__webpack_require__(62833);var classCallCheck=__webpack_require__(13087);var assertThisInitialized=__webpack_require__(52417);var inherits=__webpack_require__(93806);var createSuper=__webpack_require__(24343);var defineProperty=__webpack_require__(82482);var user=__webpack_require__(17961);var User=function(_MainUser){(0,inherits.Z)(User,_MainUser);var _super=(0,createSuper.Z)(User);function User(){(0,classCallCheck.Z)(this,User);return _super.apply(this,arguments)}return(0,createClass.Z)(User)}(user.Z);(0,defineProperty.Z)(User,"collection","users");var es_object_to_string=__webpack_require__(41539);var es_string_iterator=__webpack_require__(78783);var web_dom_collections_iterator=__webpack_require__(33948);var es_array_map=__webpack_require__(21249);var es_string_trim=__webpack_require__(73210);var firebase=__webpack_require__(66281);var index_esm2017=__webpack_require__(25816);var esm_index_esm2017=__webpack_require__(8463);var dist_esm_index_esm2017=__webpack_require__(53333);var dist_index_esm2017=__webpack_require__(74444);var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof __webpack_require__.g!=="undefined"?__webpack_require__.g:typeof self!=="undefined"?self:{};var esm={};var k,goog=goog||{},l=commonjsGlobal||self;function aa(){}function ba(a){var b=typeof a;b="object"!=b?b:a?Array.isArray(a)?"array":b:"null";return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function da(a){return Object.prototype.hasOwnProperty.call(a,ea)&&a[ea]||(a[ea]=++fa)}var ea="closure_uid_"+(1e9*Math.random()>>>0),fa=0;function ha(a,b,c){return a.call.apply(a.bind,arguments)}function ia(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}function q(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?q=ha:q=ia;return q.apply(null,arguments)}function ja(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function t(a,b){function c(){}c.prototype=b.prototype;a.Z=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Vb=function(d,e,f){for(var h=Array(arguments.length-2),n=2;n<arguments.length;n++)h[n-2]=arguments[n];return b.prototype[e].apply(d,h)}}function v(){this.s=this.s;this.o=this.o}var ka=0,la={};v.prototype.s=!1;v.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0!=ka)){var a=da(this);delete la[a]}};v.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ma=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(let c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},na=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){const d=a.length,e="string"===typeof a?a.split(""):a;for(let f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};function oa(a){a:{var b=pa;const c=a.length,d="string"===typeof a?a.split(""):a;for(let e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:"string"===typeof a?a.charAt(b):a[b]}function qa(a){return Array.prototype.concat.apply([],arguments)}function ra(a){const b=a.length;if(0<b){const c=Array(b);for(let d=0;d<b;d++)c[d]=a[d];return c}return[]}function sa(a){return/^[\s\xa0]*$/.test(a)}var ta=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function w(a,b){return-1!=a.indexOf(b)}function ua(a,b){return a<b?-1:a>b?1:0}var x;a:{var va=l.navigator;if(va){var wa=va.userAgent;if(wa){x=wa;break a}}x=""}function xa(a,b,c){for(const d in a)b.call(c,a[d],d,a)}function ya(a){const b={};for(const c in a)b[c]=a[c];return b}var za="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Aa(a,b){let c,d;for(let e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(let f=0;f<za.length;f++)c=za[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Ca(a){Ca[" "](a);return a}Ca[" "]=aa;function Fa(a){var b=Ga;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}var Ha=w(x,"Opera"),y=w(x,"Trident")||w(x,"MSIE"),Ia=w(x,"Edge"),Ja=Ia||y,Ka=w(x,"Gecko")&&!(w(x.toLowerCase(),"webkit")&&!w(x,"Edge"))&&!(w(x,"Trident")||w(x,"MSIE"))&&!w(x,"Edge"),La=w(x.toLowerCase(),"webkit")&&!w(x,"Edge");function Ma(){var a=l.document;return a?a.documentMode:void 0}var Na;a:{var Oa="",Pa=function(){var a=x;if(Ka)return/rv:([^\);]+)(\)|;)/.exec(a);if(Ia)return/Edge\/([\d\.]+)/.exec(a);if(y)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(La)return/WebKit\/(\S+)/.exec(a);if(Ha)return/(?:Version)[ \/]?(\S+)/.exec(a)}();Pa&&(Oa=Pa?Pa[1]:"");if(y){var Qa=Ma();if(null!=Qa&&Qa>parseFloat(Oa)){Na=String(Qa);break a}}Na=Oa}var Ga={};function Ra(){return Fa((function(){let a=0;const b=ta(String(Na)).split("."),c=ta("9").split("."),d=Math.max(b.length,c.length);for(let h=0;0==a&&h<d;h++){var e=b[h]||"",f=c[h]||"";do{e=/(\d*)(\D*)(.*)/.exec(e)||["","","",""];f=/(\d*)(\D*)(.*)/.exec(f)||["","","",""];if(0==e[0].length&&0==f[0].length)break;a=ua(0==e[1].length?0:parseInt(e[1],10),0==f[1].length?0:parseInt(f[1],10))||ua(0==e[2].length,0==f[2].length)||ua(e[2],f[2]);e=e[3];f=f[3]}while(0==a)}return 0<=a}))}var Sa;if(l.document&&y){var Ta=Ma();Sa=Ta?Ta:parseInt(Na,10)||void 0}else Sa=void 0;var Ua=Sa;var Va=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",aa,b),l.removeEventListener("test",aa,b)}catch(c){}return a}();function z(a,b){this.type=a;this.g=this.target=b;this.defaultPrevented=!1}z.prototype.h=function(){this.defaultPrevented=!0};function A(a,b){z.call(this,a?a.type:"");this.relatedTarget=this.g=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.i=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.g=b;if(b=a.relatedTarget){if(Ka){a:{try{Ca(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:Wa[a.pointerType]||"";this.state=a.state;this.i=a;a.defaultPrevented&&A.Z.h.call(this)}}t(A,z);var Wa={2:"touch",3:"pen",4:"mouse"};A.prototype.h=function(){A.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var B="closure_listenable_"+(1e6*Math.random()|0);var Xa=0;function Ya(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.ia=e;this.key=++Xa;this.ca=this.fa=!1}function Za(a){a.ca=!0;a.listener=null;a.proxy=null;a.src=null;a.ia=null}function $a(a){this.src=a;this.g={};this.h=0}$a.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.g[f];a||(a=this.g[f]=[],this.h++);var h=ab(a,b,d,e);-1<h?(b=a[h],c||(b.fa=!1)):(b=new Ya(b,this.src,f,!!d,e),b.fa=c,a.push(b));return b};function bb(a,b){var c=b.type;if(c in a.g){var d=a.g[c],e=ma(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Za(b),0==a.g[c].length&&(delete a.g[c],a.h--))}}function ab(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.ca&&f.listener==b&&f.capture==!!c&&f.ia==d)return e}return-1}var cb="closure_lm_"+(1e6*Math.random()|0),db={};function fb(a,b,c,d,e){if(d&&d.once)return gb(a,b,c,d,e);if(Array.isArray(b)){for(var f=0;f<b.length;f++)fb(a,b[f],c,d,e);return null}c=hb(c);return a&&a[B]?a.N(b,c,p(d)?!!d.capture:!!d,e):ib(a,b,c,!1,d,e)}function ib(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var h=p(e)?!!e.capture:!!e,n=jb(a);n||(a[cb]=n=new $a(a));c=n.add(b,c,d,h,f);if(c.proxy)return c;d=kb();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Va||(e=h),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(lb(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return c}function kb(){function a(c){return b.call(a.src,a.listener,c)}var b=mb;return a}function gb(a,b,c,d,e){if(Array.isArray(b)){for(var f=0;f<b.length;f++)gb(a,b[f],c,d,e);return null}c=hb(c);return a&&a[B]?a.O(b,c,p(d)?!!d.capture:!!d,e):ib(a,b,c,!0,d,e)}function nb(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)nb(a,b[f],c,d,e);else(d=p(d)?!!d.capture:!!d,c=hb(c),a&&a[B])?(a=a.i,b=String(b).toString(),b in a.g&&(f=a.g[b],c=ab(f,c,d,e),-1<c&&(Za(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.g[b],a.h--)))):a&&(a=jb(a))&&(b=a.g[b.toString()],a=-1,b&&(a=ab(b,c,d,e)),(c=-1<a?b[a]:null)&&ob(c))}function ob(a){if("number"!==typeof a&&a&&!a.ca){var b=a.src;if(b&&b[B])bb(b.i,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(lb(c),d):b.addListener&&b.removeListener&&b.removeListener(d);(c=jb(b))?(bb(c,a),0==c.h&&(c.src=null,b[cb]=null)):Za(a)}}}function lb(a){return a in db?db[a]:db[a]="on"+a}function mb(a,b){if(a.ca)a=!0;else{b=new A(b,this);var c=a.listener,d=a.ia||a.src;a.fa&&ob(a);a=c.call(d,b)}return a}function jb(a){a=a[cb];return a instanceof $a?a:null}var pb="__closure_events_fn_"+(1e9*Math.random()>>>0);function hb(a){if("function"===typeof a)return a;a[pb]||(a[pb]=function(b){return a.handleEvent(b)});return a[pb]}function C(){v.call(this);this.i=new $a(this);this.P=this;this.I=null}t(C,v);C.prototype[B]=!0;C.prototype.removeEventListener=function(a,b,c,d){nb(this,a,b,c,d)};function D(a,b){var c,d=a.I;if(d)for(c=[];d;d=d.I)c.push(d);a=a.P;d=b.type||b;if("string"===typeof b)b=new z(b,a);else if(b instanceof z)b.target=b.target||a;else{var e=b;b=new z(d,a);Aa(b,e)}e=!0;if(c)for(var f=c.length-1;0<=f;f--){var h=b.g=c[f];e=qb(h,d,!0,b)&&e}h=b.g=a;e=qb(h,d,!0,b)&&e;e=qb(h,d,!1,b)&&e;if(c)for(f=0;f<c.length;f++)h=b.g=c[f],e=qb(h,d,!1,b)&&e}C.prototype.M=function(){C.Z.M.call(this);if(this.i){var a=this.i,c;for(c in a.g){for(var d=a.g[c],e=0;e<d.length;e++)Za(d[e]);delete a.g[c];a.h--}}this.I=null};C.prototype.N=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)};C.prototype.O=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};function qb(a,b,c,d){b=a.i.g[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var h=b[f];if(h&&!h.ca&&h.capture==c){var n=h.listener,u=h.ia||h.src;h.fa&&bb(a.i,h);e=!1!==n.call(u,d)&&e}}return e&&!d.defaultPrevented}var rb=l.JSON.stringify;function sb(){var a=tb;let b=null;a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null);return b}class ub{constructor(){this.h=this.g=null}add(a,b){const c=vb.get();c.set(a,b);this.h?this.h.next=c:this.g=c;this.h=c}}var vb=new class{constructor(a,b){this.i=a;this.j=b;this.h=0;this.g=null}get(){let a;0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i();return a}}((()=>new wb),(a=>a.reset()));class wb{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a;this.g=b;this.next=null}reset(){this.next=this.g=this.h=null}}function yb(a){l.setTimeout((()=>{throw a}),0)}function zb(a,b){Ab||Bb();Cb||(Ab(),Cb=!0);tb.add(a,b)}var Ab;function Bb(){var a=l.Promise.resolve(void 0);Ab=function(){a.then(Db)}}var Cb=!1,tb=new ub;function Db(){for(var a;a=sb();){try{a.h.call(a.g)}catch(c){yb(c)}var b=vb;b.j(a);100>b.h&&(b.h++,a.next=b.g,b.g=a)}Cb=!1}function Eb(a,b){C.call(this);this.h=a||1;this.g=b||l;this.j=q(this.kb,this);this.l=Date.now()}t(Eb,C);k=Eb.prototype;k.da=!1;k.S=null;k.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),D(this,"tick"),this.da&&(Fb(this),this.start()))}};k.start=function(){this.da=!0;this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Fb(a){a.da=!1;a.S&&(a.g.clearTimeout(a.S),a.S=null)}k.M=function(){Eb.Z.M.call(this);Fb(this);delete this.g};function Gb(a,b,c){if("function"===typeof a)c&&(a=q(a,c));else if(a&&"function"==typeof a.handleEvent)a=q(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Hb(a){a.g=Gb((()=>{a.g=null;a.i&&(a.i=!1,Hb(a))}),a.j);const b=a.h;a.h=null;a.m.apply(null,b)}class Ib extends v{constructor(a,b){super();this.m=a;this.j=b;this.h=null;this.i=!1;this.g=null}l(a){this.h=arguments;this.g?this.i=!0:Hb(this)}M(){super.M();this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function E(a){v.call(this);this.h=a;this.g={}}t(E,v);var Jb=[];function Kb(a,b,c,d){Array.isArray(c)||(c&&(Jb[0]=c.toString()),c=Jb);for(var e=0;e<c.length;e++){var f=fb(b,c[e],d||a.handleEvent,!1,a.h||a);if(!f)break;a.g[f.key]=f}}function Lb(a){xa(a.g,(function(b,c){this.g.hasOwnProperty(c)&&ob(b)}),a);a.g={}}E.prototype.M=function(){E.Z.M.call(this);Lb(this)};E.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Mb(){this.g=!0}Mb.prototype.Aa=function(){this.g=!1};function Nb(a,b,c,d,e,f){a.info((function(){if(a.g)if(f){var h="";for(var n=f.split("&"),u=0;u<n.length;u++){var m=n[u].split("=");if(1<m.length){var r=m[0];m=m[1];var G=r.split("_");h=2<=G.length&&"type"==G[1]?h+(r+"="+m+"&"):h+(r+"=redacted&")}}}else h=null;else h=f;return"XMLHTTP REQ ("+d+") [attempt "+e+"]: "+b+"\n"+c+"\n"+h}))}function Ob(a,b,c,d,e,f,h){a.info((function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+h}))}function F(a,b,c,d){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+Pb(a,c)+(d?" "+d:"")}))}function Qb(a,b){a.info((function(){return"TIMEOUT: "+b}))}Mb.prototype.info=function(){};function Pb(a,b){if(!a.g)return b;if(!b)return null;try{var c=JSON.parse(b);if(c)for(a=0;a<c.length;a++)if(Array.isArray(c[a])){var d=c[a];if(!(2>d.length)){var e=d[1];if(Array.isArray(e)&&!(1>e.length)){var f=e[0];if("noop"!=f&&"stop"!=f&&"close"!=f)for(var h=1;h<e.length;h++)e[h]=""}}}return rb(c)}catch(n){return b}}var H={},Rb=null;function Sb(){return Rb=Rb||new C}H.Ma="serverreachability";function Tb(a){z.call(this,H.Ma,a)}t(Tb,z);function I(a){const b=Sb();D(b,new Tb(b,a))}H.STAT_EVENT="statevent";function Ub(a,b){z.call(this,H.STAT_EVENT,a);this.stat=b}t(Ub,z);function J(a){const b=Sb();D(b,new Ub(b,a))}H.Na="timingevent";function Vb(a,b){z.call(this,H.Na,a);this.size=b}t(Vb,z);function K(a,b){if("function"!==typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}var Wb={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9};var Xb={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Yb(){}Yb.prototype.h=null;function Zb(a){return a.h||(a.h=a.i())}function $b(){}var L={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ac(){z.call(this,"d")}t(ac,z);function bc(){z.call(this,"c")}t(bc,z);var cc;function dc(){}t(dc,Yb);dc.prototype.g=function(){return new XMLHttpRequest};dc.prototype.i=function(){return{}};cc=new dc;function M(a,b,c,d){this.l=a;this.j=b;this.m=c;this.X=d||1;this.V=new E(this);this.P=ec;a=Ja?125:void 0;this.W=new Eb(a);this.H=null;this.i=!1;this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null;this.D=[];this.g=null;this.C=0;this.o=this.u=null;this.N=-1;this.I=!1;this.O=0;this.L=null;this.aa=this.J=this.$=this.U=!1;this.h=new fc}function fc(){this.i=null;this.g="";this.h=!1}var ec=45e3,gc={},hc={};k=M.prototype;k.setTimeout=function(a){this.P=a};function ic(a,b,c){a.K=1;a.v=jc(N(b));a.s=c;a.U=!0;kc(a,null)}function kc(a,b){a.F=Date.now();lc(a);a.A=N(a.v);var c=a.A,d=a.X;Array.isArray(d)||(d=[String(d)]);mc(c.h,"t",d);a.C=0;c=a.l.H;a.h=new fc;a.g=nc(a.l,c?b:null,!a.s);0<a.O&&(a.L=new Ib(q(a.Ia,a,a.g),a.O));Kb(a.V,a.g,"readystatechange",a.gb);b=a.H?ya(a.H):{};a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b));I(1);Nb(a.j,a.u,a.A,a.m,a.X,a.s)}k.gb=function(a){a=a.target;const b=this.L;b&&3==O(a)?b.l():this.Ia(a)};k.Ia=function(a){try{if(a==this.g)a:{const r=O(this.g);var b=this.g.Da();const G=this.g.ba();if(!(3>r)&&(3!=r||Ja||this.g&&(this.h.h||this.g.ga()||oc(this.g)))){this.I||4!=r||7==b||(8==b||0>=G?I(3):I(2));pc(this);var c=this.g.ba();this.N=c;b:if(qc(this)){var d=oc(this.g);a="";var e=d.length,f=4==O(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){P(this);rc(this);var h="";break b}this.h.i=new l.TextDecoder}for(b=0;b<e;b++)this.h.h=!0,a+=this.h.i.decode(d[b],{stream:f&&b==e-1});d.splice(0,e);this.h.g+=a;this.C=0;h=this.h.g}else h=this.g.ga();this.i=200==c;Ob(this.j,this.u,this.A,this.m,this.X,r,c);if(this.i){if(this.$&&!this.J){b:{if(this.g){var n,u=this.g;if((n=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!sa(n)){var m=n;break b}}m=null}if(c=m)F(this.j,this.m,c,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,sc(this,c);else{this.i=!1;this.o=3;J(12);P(this);rc(this);break a}}this.U?(tc(this,r,h),Ja&&this.i&&3==r&&(Kb(this.V,this.W,"tick",this.fb),this.W.start())):(F(this.j,this.m,h,null),sc(this,h));4==r&&P(this);this.i&&!this.I&&(4==r?uc(this.l,this):(this.i=!1,lc(this)))}else 400==c&&0<h.indexOf("Unknown SID")?(this.o=3,J(12)):(this.o=0,J(13)),P(this),rc(this)}}}catch(r){}finally{}};function qc(a){return a.g?"GET"==a.u&&2!=a.K&&a.l.Ba:!1}function tc(a,b,c){let d=!0,e;for(;!a.I&&a.C<c.length;)if(e=vc(a,c),e==hc){4==b&&(a.o=4,J(14),d=!1);F(a.j,a.m,null,"[Incomplete Response]");break}else if(e==gc){a.o=4;J(15);F(a.j,a.m,c,"[Invalid Chunk]");d=!1;break}else F(a.j,a.m,e,null),sc(a,e);qc(a)&&e!=hc&&e!=gc&&(a.h.g="",a.C=0);4!=b||0!=c.length||a.h.h||(a.o=1,J(16),d=!1);a.i=a.i&&d;d?0<c.length&&!a.aa&&(a.aa=!0,b=a.l,b.g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+c.length),wc(b),b.L=!0,J(11))):(F(a.j,a.m,c,"[Invalid Chunked Response]"),P(a),rc(a))}k.fb=function(){if(this.g){var a=O(this.g),b=this.g.ga();this.C<b.length&&(pc(this),tc(this,a,b),this.i&&4!=a&&lc(this))}};function vc(a,b){var c=a.C,d=b.indexOf("\n",c);if(-1==d)return hc;c=Number(b.substring(c,d));if(isNaN(c))return gc;d+=1;if(d+c>b.length)return hc;b=b.substr(d,c);a.C=d+c;return b}k.cancel=function(){this.I=!0;P(this)};function lc(a){a.Y=Date.now()+a.P;xc(a,a.P)}function xc(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=K(q(a.eb,a),b)}function pc(a){a.B&&(l.clearTimeout(a.B),a.B=null)}k.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(Qb(this.j,this.A),2!=this.K&&(I(3),J(17)),P(this),this.o=2,rc(this)):xc(this,this.Y-a)};function rc(a){0==a.l.G||a.I||uc(a.l,a)}function P(a){pc(a);var b=a.L;b&&"function"==typeof b.na&&b.na();a.L=null;Fb(a.W);Lb(a.V);a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function sc(a,b){try{var c=a.l;if(0!=c.G&&(c.g==a||yc(c.i,a)))if(c.I=a.N,!a.J&&yc(c.i,a)&&3==c.G){try{var d=c.Ca.g.parse(b)}catch(m){d=null}if(Array.isArray(d)&&3==d.length){var e=d;if(0==e[0])a:{if(!c.u){if(c.g)if(c.g.F+3e3<a.F)zc(c),Ac(c);else break a;Bc(c);J(18)}}else c.ta=e[1],0<c.ta-c.U&&37500>e[2]&&c.N&&0==c.A&&!c.v&&(c.v=K(q(c.ab,c),6e3));if(1>=Cc(c.i)&&c.ka){try{c.ka()}catch(m){}c.ka=void 0}}else Q(c,11)}else if((a.J||c.g==a)&&zc(c),!sa(b))for(e=c.Ca.g.parse(b),b=0;b<e.length;b++){let m=e[b];c.U=m[0];m=m[1];if(2==c.G)if("c"==m[0]){c.J=m[1];c.la=m[2];const r=m[3];null!=r&&(c.ma=r,c.h.info("VER="+c.ma));const G=m[4];null!=G&&(c.za=G,c.h.info("SVER="+c.za));const Da=m[5];null!=Da&&"number"===typeof Da&&0<Da&&(d=1.5*Da,c.K=d,c.h.info("backChannelRequestTimeoutMs_="+d));d=c;const ca=a.g;if(ca){const Ea=ca.g?ca.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ea){var f=d.i;!f.g&&(w(Ea,"spdy")||w(Ea,"quic")||w(Ea,"h2"))&&(f.j=f.l,f.g=new Set,f.h&&(Dc(f,f.h),f.h=null))}if(d.D){const xb=ca.g?ca.g.getResponseHeader("X-HTTP-Session-Id"):null;xb&&(d.sa=xb,R(d.F,d.D,xb))}}c.G=3;c.j&&c.j.xa();c.$&&(c.O=Date.now()-a.F,c.h.info("Handshake RTT: "+c.O+"ms"));d=c;var h=a;d.oa=Ec(d,d.H?d.la:null,d.W);if(h.J){Fc(d.i,h);var n=h,u=d.K;u&&n.setTimeout(u);n.B&&(pc(n),lc(n));d.g=h}else Gc(d);0<c.l.length&&Hc(c)}else"stop"!=m[0]&&"close"!=m[0]||Q(c,7);else 3==c.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?Q(c,7):Ic(c):"noop"!=m[0]&&c.j&&c.j.wa(m),c.A=0)}I(4)}catch(m){}}function Jc(a){if(a.R&&"function"==typeof a.R)return a.R();if("string"===typeof a)return a.split("");if(ba(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}b=[];c=0;for(d in a)b[c++]=a[d];return b}function Kc(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(ba(a)||"string"===typeof a)na(a,b,void 0);else{if(a.T&&"function"==typeof a.T)var c=a.T();else if(a.R&&"function"==typeof a.R)c=void 0;else if(ba(a)||"string"===typeof a){c=[];for(var d=a.length,e=0;e<d;e++)c.push(e)}else for(e in c=[],d=0,a)c[d++]=e;d=Jc(a);e=d.length;for(var f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}}function S(a,b){this.h={};this.g=[];this.i=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a)if(a instanceof S)for(c=a.T(),d=0;d<c.length;d++)this.set(c[d],a.get(c[d]));else for(d in a)this.set(d,a[d])}k=S.prototype;k.R=function(){Lc(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a};k.T=function(){Lc(this);return this.g.concat()};function Lc(a){if(a.i!=a.g.length){for(var b=0,c=0;b<a.g.length;){var d=a.g[b];T(a.h,d)&&(a.g[c++]=d);b++}a.g.length=c}if(a.i!=a.g.length){var e={};for(c=b=0;b<a.g.length;)d=a.g[b],T(e,d)||(a.g[c++]=d,e[d]=1),b++;a.g.length=c}}k.get=function(a,b){return T(this.h,a)?this.h[a]:b};k.set=function(a,b){T(this.h,a)||(this.i++,this.g.push(a));this.h[a]=b};k.forEach=function(a,b){for(var c=this.T(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};function T(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var Mc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Nc(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}}function U(a,b){this.i=this.s=this.j="";this.m=null;this.o=this.l="";this.g=!1;if(a instanceof U){this.g=void 0!==b?b:a.g;Oc(this,a.j);this.s=a.s;Pc(this,a.i);Qc(this,a.m);this.l=a.l;b=a.h;var c=new Rc;c.i=b.i;b.g&&(c.g=new S(b.g),c.h=b.h);Sc(this,c);this.o=a.o}else a&&(c=String(a).match(Mc))?(this.g=!!b,Oc(this,c[1]||"",!0),this.s=Tc(c[2]||""),Pc(this,c[3]||"",!0),Qc(this,c[4]),this.l=Tc(c[5]||"",!0),Sc(this,c[6]||"",!0),this.o=Tc(c[7]||"")):(this.g=!!b,this.h=new Rc(null,this.g))}U.prototype.toString=function(){var a=[],b=this.j;b&&a.push(Uc(b,Vc,!0),":");var c=this.i;if(c||"file"==b)a.push("//"),(b=this.s)&&a.push(Uc(b,Vc,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.m,null!=c&&a.push(":",String(c));if(c=this.l)this.i&&"/"!=c.charAt(0)&&a.push("/"),a.push(Uc(c,"/"==c.charAt(0)?Wc:Xc,!0));(c=this.h.toString())&&a.push("?",c);(c=this.o)&&a.push("#",Uc(c,Yc));return a.join("")};function N(a){return new U(a)}function Oc(a,b,c){a.j=c?Tc(b,!0):b;a.j&&(a.j=a.j.replace(/:$/,""))}function Pc(a,b,c){a.i=c?Tc(b,!0):b}function Qc(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Sc(a,b,c){b instanceof Rc?(a.h=b,Zc(a.h,a.g)):(c||(b=Uc(b,$c)),a.h=new Rc(b,a.g))}function R(a,b,c){a.h.set(b,c)}function jc(a){R(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36));return a}function ad(a){return a instanceof U?N(a):new U(a,void 0)}function bd(a,b,c,d){var e=new U(null,void 0);a&&Oc(e,a);b&&Pc(e,b);c&&Qc(e,c);d&&(e.l=d);return e}function Tc(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Uc(a,b,c){return"string"===typeof a?(a=encodeURI(a).replace(b,cd),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function cd(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Vc=/[#\/\?@]/g,Xc=/[#\?:]/g,Wc=/[#\?]/g,$c=/[#\?@]/g,Yc=/#/g;function Rc(a,b){this.h=this.g=null;this.i=a||null;this.j=!!b}function V(a){a.g||(a.g=new S,a.h=0,a.i&&Nc(a.i,(function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)})))}k=Rc.prototype;k.add=function(a,b){V(this);this.i=null;a=W(this,a);var c=this.g.get(a);c||this.g.set(a,c=[]);c.push(b);this.h+=1;return this};function dd(a,b){V(a);b=W(a,b);T(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,a=a.g,T(a.h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&Lc(a)))}function ed(a,b){V(a);b=W(a,b);return T(a.g.h,b)}k.forEach=function(a,b){V(this);this.g.forEach((function(c,d){na(c,(function(e){a.call(b,e,d,this)}),this)}),this)};k.T=function(){V(this);for(var a=this.g.R(),b=this.g.T(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};k.R=function(a){V(this);var b=[];if("string"===typeof a)ed(this,a)&&(b=qa(b,this.g.get(W(this,a))));else{a=this.g.R();for(var c=0;c<a.length;c++)b=qa(b,a[c])}return b};k.set=function(a,b){V(this);this.i=null;a=W(this,a);ed(this,a)&&(this.h-=this.g.get(a).length);this.g.set(a,[b]);this.h+=1;return this};k.get=function(a,b){if(!a)return b;a=this.R(a);return 0<a.length?String(a[0]):b};function mc(a,b,c){dd(a,b);0<c.length&&(a.i=null,a.g.set(W(a,b),ra(c)),a.h+=c.length)}k.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var a=[],b=this.g.T(),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.R(d);for(var f=0;f<d.length;f++){var h=e;""!==d[f]&&(h+="="+encodeURIComponent(String(d[f])));a.push(h)}}return this.i=a.join("&")};function W(a,b){b=String(b);a.j&&(b=b.toLowerCase());return b}function Zc(a,b){b&&!a.j&&(V(a),a.i=null,a.g.forEach((function(c,d){var e=d.toLowerCase();d!=e&&(dd(this,d),mc(this,e,c))}),a));a.j=b}var fd=class{constructor(a,b){this.h=a;this.g=b}};function gd(a){this.l=a||hd;l.PerformanceNavigationTiming?(a=l.performance.getEntriesByType("navigation"),a=0<a.length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol)):a=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb);this.j=a?this.l:1;this.g=null;1<this.j&&(this.g=new Set);this.h=null;this.i=[]}var hd=10;function id(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Cc(a){return a.h?1:a.g?a.g.size:0}function yc(a,b){return a.h?a.h==b:a.g?a.g.has(b):!1}function Dc(a,b){a.g?a.g.add(b):a.h=b}function Fc(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}gd.prototype.cancel=function(){this.i=jd(this);if(this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};function jd(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const c of a.g.values())b=b.concat(c.D);return b}return ra(a.i)}function kd(){}kd.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)};kd.prototype.parse=function(a){return l.JSON.parse(a,void 0)};function ld(){this.g=new kd}function md(a,b,c){const d=c||"";try{Kc(a,(function(e,f){let h=e;p(e)&&(h=rb(e));b.push(d+f+"="+encodeURIComponent(h))}))}catch(e){throw b.push(d+"type="+encodeURIComponent("_badmap")),e}}function nd(a,b){const c=new Mb;if(l.Image){const d=new Image;d.onload=ja(od,c,d,"TestLoadImage: loaded",!0,b);d.onerror=ja(od,c,d,"TestLoadImage: error",!1,b);d.onabort=ja(od,c,d,"TestLoadImage: abort",!1,b);d.ontimeout=ja(od,c,d,"TestLoadImage: timeout",!1,b);l.setTimeout((function(){if(d.ontimeout)d.ontimeout()}),1e4);d.src=a}else b(!1)}function od(a,b,c,d,e){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,e(d)}catch(f){}}function pd(a){this.l=a.$b||null;this.j=a.ib||!1}t(pd,Yb);pd.prototype.g=function(){return new qd(this.l,this.j)};pd.prototype.i=function(a){return function(){return a}}({});function qd(a,b){C.call(this);this.D=a;this.u=b;this.m=void 0;this.readyState=rd;this.status=0;this.responseType=this.responseText=this.response=this.statusText="";this.onreadystatechange=null;this.v=new Headers;this.h=null;this.C="GET";this.B="";this.g=!1;this.A=this.j=this.l=null}t(qd,C);var rd=0;k=qd.prototype;k.open=function(a,b){if(this.readyState!=rd)throw this.abort(),Error("Error reopening a connection");this.C=a;this.B=b;this.readyState=1;sd(this)};k.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a);(this.D||l).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))};k.abort=function(){this.response=this.responseText="";this.v=new Headers;this.status=0;this.j&&this.j.cancel("Request was aborted.");1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,td(this));this.readyState=rd};k.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,sd(this)),this.g&&(this.readyState=3,sd(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof l.ReadableStream&&"body"in a){this.j=a.body.getReader();if(this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ud(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))};function ud(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}k.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);if(b=this.A.decode(b,{stream:!a.done}))this.response=this.responseText+=b}a.done?td(this):sd(this);3==this.readyState&&ud(this)}};k.Ua=function(a){this.g&&(this.response=this.responseText=a,td(this))};k.Ta=function(a){this.g&&(this.response=a,td(this))};k.ha=function(){this.g&&td(this)};function td(a){a.readyState=4;a.l=null;a.j=null;a.A=null;sd(a)}k.setRequestHeader=function(a,b){this.v.append(a,b)};k.getResponseHeader=function(a){return this.h?this.h.get(a.toLowerCase())||"":""};k.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var c=b.next();!c.done;)c=c.value,a.push(c[0]+": "+c[1]),c=b.next();return a.join("\r\n")};function sd(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(qd.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var vd=l.JSON.parse;function X(a){C.call(this);this.headers=new S;this.u=a||null;this.h=!1;this.C=this.g=null;this.H="";this.m=0;this.j="";this.l=this.F=this.v=this.D=!1;this.B=0;this.A=null;this.J=wd;this.K=this.L=!1}t(X,C);var wd="",xd=/^https?$/i,yd=["POST","PUT"];k=X.prototype;k.ea=function(a,b,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET";this.H=a;this.j="";this.m=0;this.D=!1;this.h=!0;this.g=this.u?this.u.g():cc.g();this.C=this.u?Zb(this.u):Zb(cc);this.g.onreadystatechange=q(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(f){zd(this,f);return}a=c||"";const e=new S(this.headers);d&&Kc(d,(function(f,h){e.set(h,f)}));d=oa(e.T());c=l.FormData&&a instanceof l.FormData;!(0<=ma(yd,b))||d||c||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");e.forEach((function(f,h){this.g.setRequestHeader(h,f)}),this);this.J&&(this.g.responseType=this.J);"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ad(this),0<this.B&&((this.K=Bd(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.pa,this)):this.A=Gb(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(f){zd(this,f)}};function Bd(a){return y&&Ra()&&"number"===typeof a.timeout&&void 0!==a.ontimeout}function pa(a){return"content-type"==a.toLowerCase()}k.pa=function(){"undefined"!=typeof goog&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,D(this,"timeout"),this.abort(8))};function zd(a,b){a.h=!1;a.g&&(a.l=!0,a.g.abort(),a.l=!1);a.j=b;a.m=5;Cd(a);Dd(a)}function Cd(a){a.D||(a.D=!0,D(a,"complete"),D(a,"error"))}k.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,D(this,"complete"),D(this,"abort"),Dd(this))};k.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Dd(this,!0));X.Z.M.call(this)};k.Fa=function(){this.s||(this.F||this.v||this.l?Ed(this):this.cb())};k.cb=function(){Ed(this)};function Ed(a){if(a.h&&"undefined"!=typeof goog&&(!a.C[1]||4!=O(a)||2!=a.ba()))if(a.v&&4==O(a))Gb(a.Fa,0,a);else if(D(a,"readystatechange"),4==O(a)){a.h=!1;try{const n=a.ba();a:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break a;default:b=!1}var c;if(!(c=b)){var d;if(d=0===n){var e=String(a.H).match(Mc)[1]||null;if(!e&&l.self&&l.self.location){var f=l.self.location.protocol;e=f.substr(0,f.length-1)}d=!xd.test(e?e.toLowerCase():"")}c=d}if(c)D(a,"complete"),D(a,"success");else{a.m=6;try{var h=2<O(a)?a.g.statusText:""}catch(u){h=""}a.j=h+" ["+a.ba()+"]";Cd(a)}}finally{Dd(a)}}}function Dd(a,b){if(a.g){Ad(a);const c=a.g,d=a.C[0]?aa:null;a.g=null;a.C=null;b||D(a,"ready");try{c.onreadystatechange=d}catch(e){}}}function Ad(a){a.g&&a.K&&(a.g.ontimeout=null);a.A&&(l.clearTimeout(a.A),a.A=null)}function O(a){return a.g?a.g.readyState:0}k.ba=function(){try{return 2<O(this)?this.g.status:-1}catch(a){return-1}};k.ga=function(){try{return this.g?this.g.responseText:""}catch(a){return""}};k.Qa=function(a){if(this.g){var b=this.g.responseText;a&&0==b.indexOf(a)&&(b=b.substring(a.length));return vd(b)}};function oc(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case wd:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(b){return null}}k.Da=function(){return this.m};k.La=function(){return"string"===typeof this.j?this.j:String(this.j)};function Fd(a){let b="";xa(a,(function(c,d){b+=d;b+=":";b+=c;b+="\r\n"}));return b}function Gd(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}d||(c=Fd(c),"string"===typeof a?null!=c&&encodeURIComponent(String(c)):R(a,b,c))}function Hd(a,b,c){return c&&c.internalChannelParams?c.internalChannelParams[a]||b:b}function Id(a){this.za=0;this.l=[];this.h=new Mb;this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null;this.Za=this.V=0;this.Xa=Hd("failFast",!1,a);this.N=this.v=this.u=this.m=this.j=null;this.X=!0;this.I=this.ta=this.U=-1;this.Y=this.A=this.C=0;this.Pa=Hd("baseRetryDelayMs",5e3,a);this.$a=Hd("retryDelaySeedMs",1e4,a);this.Ya=Hd("forwardChannelMaxRetries",2,a);this.ra=Hd("forwardChannelRequestTimeoutMs",2e4,a);this.qa=a&&a.xmlHttpFactory||void 0;this.Ba=a&&a.Yb||!1;this.K=void 0;this.H=a&&a.supportsCrossDomainXhr||!1;this.J="";this.i=new gd(a&&a.concurrentRequestLimit);this.Ca=new ld;this.ja=a&&a.fastHandshake||!1;this.Ra=a&&a.Wb||!1;a&&a.Aa&&this.h.Aa();a&&a.forceLongPolling&&(this.X=!1);this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1;this.ka=void 0;this.O=0;this.L=!1;this.B=null;this.Wa=!a||!1!==a.Xb}k=Id.prototype;k.ma=8;k.G=1;function Ic(a){Jd(a);if(3==a.G){var b=a.V++,c=N(a.F);R(c,"SID",a.J);R(c,"RID",b);R(c,"TYPE","terminate");Kd(a,c);b=new M(a,a.h,b,void 0);b.K=2;b.v=jc(N(c));c=!1;l.navigator&&l.navigator.sendBeacon&&(c=l.navigator.sendBeacon(b.v.toString(),""));!c&&l.Image&&((new Image).src=b.v,c=!0);c||(b.g=nc(b.l,null),b.g.ea(b.v));b.F=Date.now();lc(b)}Ld(a)}k.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(b){}};function Ac(a){a.g&&(wc(a),a.g.cancel(),a.g=null)}function Jd(a){Ac(a);a.u&&(l.clearTimeout(a.u),a.u=null);zc(a);a.i.cancel();a.m&&("number"===typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Md(a,b){a.l.push(new fd(a.Za++,b));3==a.G&&Hc(a)}function Hc(a){id(a.i)||a.m||(a.m=!0,zb(a.Ha,a),a.C=0)}function Nd(a,b){if(Cc(a.i)>=a.i.j-(a.m?1:0))return!1;if(a.m)return a.l=b.D.concat(a.l),!0;if(1==a.G||2==a.G||a.C>=(a.Xa?0:a.Ya))return!1;a.m=K(q(a.Ha,a,b),Od(a,a.C));a.C++;return!0}k.Ha=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.V=Math.floor(1e5*Math.random());a=this.V++;const e=new M(this,this.h,a,void 0);let f=this.s;this.P&&(f?(f=ya(f),Aa(f,this.P)):f=this.P);null===this.o&&(e.H=f);if(this.ja)a:{var b=0;for(var c=0;c<this.l.length;c++){b:{var d=this.l[c];if("__data__"in d.g&&(d=d.g.__data__,"string"===typeof d)){d=d.length;break b}d=void 0}if(void 0===d)break;b+=d;if(4096<b){b=c;break a}if(4096===b||c===this.l.length-1){b=c+1;break a}}b=1e3}else b=1e3;b=Pd(this,e,b);c=N(this.F);R(c,"RID",a);R(c,"CVER",22);this.D&&R(c,"X-HTTP-Session-Id",this.D);Kd(this,c);this.o&&f&&Gd(c,this.o,f);Dc(this.i,e);this.Ra&&R(c,"TYPE","init");this.ja?(R(c,"$req",b),R(c,"SID","null"),e.$=!0,ic(e,c,null)):ic(e,c,b);this.G=2}}else 3==this.G&&(a?Qd(this,a):0==this.l.length||id(this.i)||Qd(this))};function Qd(a,b){var c;b?c=b.m:c=a.V++;const d=N(a.F);R(d,"SID",a.J);R(d,"RID",c);R(d,"AID",a.U);Kd(a,d);a.o&&a.s&&Gd(d,a.o,a.s);c=new M(a,a.h,c,a.C+1);null===a.o&&(c.H=a.s);b&&(a.l=b.D.concat(a.l));b=Pd(a,c,1e3);c.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random()));Dc(a.i,c);ic(c,d,b)}function Kd(a,b){a.j&&Kc({},(function(c,d){R(b,d,c)}))}function Pd(a,b,c){c=Math.min(a.l.length,c);var d=a.j?q(a.j.Oa,a.j,a):null;a:{var e=a.l;let f=-1;for(;;){const h=["count="+c];-1==f?0<c?(f=e[0].h,h.push("ofs="+f)):f=0:h.push("ofs="+f);let n=!0;for(let u=0;u<c;u++){let m=e[u].h;const r=e[u].g;m-=f;if(0>m)f=Math.max(0,e[u].h-100),n=!1;else try{md(r,h,"req"+m+"_")}catch(G){d&&d(r)}}if(n){d=h.join("&");break a}}}a=a.l.splice(0,c);b.D=a;return d}function Gc(a){a.g||a.u||(a.Y=1,zb(a.Ga,a),a.A=0)}function Bc(a){if(a.g||a.u||3<=a.A)return!1;a.Y++;a.u=K(q(a.Ga,a),Od(a,a.A));a.A++;return!0}k.Ga=function(){this.u=null;Rd(this);if(this.$&&!(this.L||null==this.g||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a);this.B=K(q(this.bb,this),a)}};k.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,J(10),Ac(this),Rd(this))};function wc(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Rd(a){a.g=new M(a,a.h,"rpc",a.Y);null===a.o&&(a.g.H=a.s);a.g.O=0;var b=N(a.oa);R(b,"RID","rpc");R(b,"SID",a.J);R(b,"CI",a.N?"0":"1");R(b,"AID",a.U);Kd(a,b);R(b,"TYPE","xmlhttp");a.o&&a.s&&Gd(b,a.o,a.s);a.K&&a.g.setTimeout(a.K);var c=a.g;a=a.la;c.K=1;c.v=jc(N(b));c.s=null;c.U=!0;kc(c,a)}k.ab=function(){null!=this.v&&(this.v=null,Ac(this),Bc(this),J(19))};function zc(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function uc(a,b){var c=null;if(a.g==b){zc(a);wc(a);a.g=null;var d=2}else if(yc(a.i,b))c=b.D,Fc(a.i,b),d=1;else return;a.I=b.N;if(0!=a.G)if(b.i)if(1==d){c=b.s?b.s.length:0;b=Date.now()-b.F;var e=a.C;d=Sb();D(d,new Vb(d,c,b,e));Hc(a)}else Gc(a);else if(e=b.o,3==e||0==e&&0<a.I||!(1==d&&Nd(a,b)||2==d&&Bc(a)))switch(c&&0<c.length&&(b=a.i,b.i=b.i.concat(c)),e){case 1:Q(a,5);break;case 4:Q(a,10);break;case 3:Q(a,6);break;default:Q(a,2)}}function Od(a,b){let c=a.Pa+Math.floor(Math.random()*a.$a);a.j||(c*=2);return c*b}function Q(a,b){a.h.info("Error code "+b);if(2==b){var c=null;a.j&&(c=null);var d=q(a.jb,a);c||(c=new U("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Oc(c,"https"),jc(c));nd(c.toString(),d)}else J(2);a.G=0;a.j&&a.j.va(b);Ld(a);Jd(a)}k.jb=function(a){a?(this.h.info("Successfully pinged google.com"),J(2)):(this.h.info("Failed to ping google.com"),J(1))};function Ld(a){a.G=0;a.I=-1;if(a.j){if(0!=jd(a.i).length||0!=a.l.length)a.i.i.length=0,ra(a.l),a.l.length=0;a.j.ua()}}function Ec(a,b,c){let d=ad(c);if(""!=d.i)b&&Pc(d,b+"."+d.i),Qc(d,d.m);else{const e=l.location;d=bd(e.protocol,b?b+"."+e.hostname:e.hostname,+e.port,c)}a.aa&&xa(a.aa,(function(e,f){R(d,f,e)}));b=a.D;c=a.sa;b&&c&&R(d,b,c);R(d,"VER",a.ma);Kd(a,d);return d}function nc(a,b,c){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");b=c&&a.Ba&&!a.qa?new X(new pd({ib:!0})):new X(a.qa);b.L=a.H;return b}function Sd(){}k=Sd.prototype;k.xa=function(){};k.wa=function(){};k.va=function(){};k.ua=function(){};k.Oa=function(){};function Td(){if(y&&!(10<=Number(Ua)))throw Error("Environmental error: no available transport.")}Td.prototype.g=function(a,b){return new Y(a,b)};function Y(a,b){C.call(this);this.g=new Id(b);this.l=a;this.h=b&&b.messageUrlParams||null;a=b&&b.messageHeaders||null;b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"});this.g.s=a;a=b&&b.initMessageHeaders||null;b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType});b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya});this.g.P=a;(a=b&&b.httpHeadersOverwriteParam)&&!sa(a)&&(this.g.o=a);this.A=b&&b.supportsCrossDomainXhr||!1;this.v=b&&b.sendRawJson||!1;(b=b&&b.httpSessionIdParam)&&!sa(b)&&(this.g.D=b,a=this.h,null!==a&&b in a&&(a=this.h,b in a&&delete a[b]));this.j=new Z(this)}t(Y,C);Y.prototype.m=function(){this.g.j=this.j;this.A&&(this.g.H=!0);var a=this.g,b=this.l,c=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),zb(q(a.hb,a,b)));J(0);a.W=b;a.aa=c||{};a.N=a.X;a.F=Ec(a,null,a.W);Hc(a)};Y.prototype.close=function(){Ic(this.g)};Y.prototype.u=function(a){if("string"===typeof a){var b={};b.__data__=a;Md(this.g,b)}else this.v?(b={},b.__data__=rb(a),Md(this.g,b)):Md(this.g,a)};Y.prototype.M=function(){this.g.j=null;delete this.j;Ic(this.g);delete this.g;Y.Z.M.call(this)};function Ud(a){ac.call(this);var b=a.__sm__;if(b){a:{for(const c in b){a=c;break a}a=void 0}if(this.i=a)a=this.i,b=null!==b&&a in b?b[a]:void 0;this.data=b}else this.data=a}t(Ud,ac);function Vd(){bc.call(this);this.status=1}t(Vd,bc);function Z(a){this.g=a}t(Z,Sd);Z.prototype.xa=function(){D(this.g,"a")};Z.prototype.wa=function(a){D(this.g,new Ud(a))};Z.prototype.va=function(a){D(this.g,new Vd(a))};Z.prototype.ua=function(){D(this.g,"b")};Td.prototype.createWebChannel=Td.prototype.g;Y.prototype.send=Y.prototype.u;Y.prototype.open=Y.prototype.m;Y.prototype.close=Y.prototype.close;Wb.NO_ERROR=0;Wb.TIMEOUT=8;Wb.HTTP_ERROR=6;Xb.COMPLETE="complete";$b.EventType=L;L.OPEN="a";L.CLOSE="b";L.ERROR="c";L.MESSAGE="d";C.prototype.listen=C.prototype.N;X.prototype.listenOnce=X.prototype.O;X.prototype.getLastError=X.prototype.La;X.prototype.getLastErrorCode=X.prototype.Da;X.prototype.getStatus=X.prototype.ba;X.prototype.getResponseJson=X.prototype.Qa;X.prototype.getResponseText=X.prototype.ga;X.prototype.send=X.prototype.ea;var createWebChannelTransport=esm.createWebChannelTransport=function(){return new Td};var getStatEventTarget=esm.getStatEventTarget=function(){return Sb()};var ErrorCode=esm.ErrorCode=Wb;var EventType=esm.EventType=Xb;var Event=esm.Event=H;var Stat=esm.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20};var FetchXmlHttpFactory=esm.FetchXmlHttpFactory=pd;var WebChannel=esm.WebChannel=$b;var XhrIo=esm.XhrIo=X;const index_esm2017_D="@firebase/firestore";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_C{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}index_esm2017_C.UNAUTHENTICATED=new index_esm2017_C(null),index_esm2017_C.GOOGLE_CREDENTIALS=new index_esm2017_C("google-credentials-uid"),index_esm2017_C.FIRST_PARTY=new index_esm2017_C("first-party-uid"),index_esm2017_C.MOCK_USER=new index_esm2017_C("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let index_esm2017_x="9.8.4";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const index_esm2017_N=new dist_esm_index_esm2017.Yd("@firebase/firestore");function index_esm2017_k(){return index_esm2017_N.logLevel}function index_esm2017_O(t){index_esm2017_N.setLogLevel(t)}function index_esm2017_M(t,...e){if(index_esm2017_N.logLevel<=dist_esm_index_esm2017["in"].DEBUG){const n=e.map(index_esm2017_B);index_esm2017_N.debug(`Firestore (${index_esm2017_x}): ${t}`,...n)}}function index_esm2017_F(t,...e){if(index_esm2017_N.logLevel<=dist_esm_index_esm2017["in"].ERROR){const n=e.map(index_esm2017_B);index_esm2017_N.error(`Firestore (${index_esm2017_x}): ${t}`,...n)}}function $(t,...e){if(index_esm2017_N.logLevel<=dist_esm_index_esm2017["in"].WARN){const n=e.map(index_esm2017_B);index_esm2017_N.warn(`Firestore (${index_esm2017_x}): ${t}`,...n)}}function index_esm2017_B(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function index_esm2017_L(t="Unexpected state"){const e=`FIRESTORE (${index_esm2017_x}) INTERNAL ASSERTION FAILED: `+t;throw index_esm2017_F(e),new Error(e)}function index_esm2017_U(t,e){t||index_esm2017_L()}function index_esm2017_q(t,e){t||index_esm2017_L()}function index_esm2017_K(t,e){return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class index_esm2017_Q extends dist_index_esm2017.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_W{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class index_esm2017_z{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(index_esm2017_C.UNAUTHENTICATED)))}shutdown(){}}class index_esm2017_H{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class index_esm2017_J{constructor(t){this.t=t,this.currentUser=index_esm2017_C.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new j;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new j,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{index_esm2017_M("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(index_esm2017_M("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new j)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(index_esm2017_M("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(index_esm2017_U("string"==typeof e.accessToken),new index_esm2017_W(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return index_esm2017_U(null===t||"string"==typeof t),new index_esm2017_C(t)}}class index_esm2017_Y{constructor(t,e,n){this.type="FirstParty",this.user=index_esm2017_C.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const s=t.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class index_esm2017_X{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new index_esm2017_Y(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(index_esm2017_C.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class index_esm2017_Z{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tt{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&index_esm2017_M("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,index_esm2017_M("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{index_esm2017_M("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?s(t):index_esm2017_M("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(index_esm2017_U("string"==typeof t.token),this.p=t.token,new index_esm2017_Z(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class et{getToken(){return Promise.resolve(new index_esm2017_Z(""))}invalidateToken(){}start(t,e){}shutdown(){}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nt(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=nt(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function it(t,e){return t<e?-1:t>e?1:0}function rt(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function ot(t){return t+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ut.fromMillis(Date.now())}static fromDate(t){return ut.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ut(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?it(this.nanoseconds,t.nanoseconds):it(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ct(t)}static min(){return new ct(new ut(0,0))}static max(){return new ct(new ut(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(t,e,n){void 0===e?e=0:e>t.length&&index_esm2017_L(),void 0===n?n=t.length-e:n>t.length-e&&index_esm2017_L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===at.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof at?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ht extends at{construct(t,e,n){return new ht(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ht(e)}static emptyPath(){return new ht([])}}const lt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ft extends at{construct(t,e,n){return new ft(t,e,n)}static isValidIdentifier(t){return lt.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ft.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ft(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ft(e)}static emptyPath(){return new ft([])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dt{constructor(t){this.path=t}static fromPath(t){return new dt(ht.fromString(t))}static fromName(t){return new dt(ht.fromString(t).popFirst(5))}static empty(){return new dt(ht.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ht.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ht.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new dt(new ht(t.slice()))}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function wt(t){return t.fields.find((t=>2===t.kind))}function mt(t){return t.fields.filter((t=>2!==t.kind))}_t.UNKNOWN_ID=-1;class gt{constructor(t,e){this.fieldPath=t,this.kind=e}}class yt{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new yt(0,Tt.min())}}function pt(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=ct.fromTimestamp(1e9===s?new ut(n+1,0):new ut(n,s));return new Tt(i,dt.empty(),e)}function It(t){return new Tt(t.readTime,t.key,-1)}class Tt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Tt(ct.min(),dt.empty(),-1)}static max(){return new Tt(ct.max(),dt.empty(),-1)}}function Et(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=dt.comparator(t.documentKey,e.documentKey),0!==n?n:it(t.largestBatchId,e.largestBatchId))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const At="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Rt{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bt(t){if(t.code!==G.FAILED_PRECONDITION||t.message!==At)throw t;index_esm2017_M("LocalStore","Unexpectedly lost primary lease")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&index_esm2017_L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Pt(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Pt?e:Pt.resolve(e)}catch(t){return Pt.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Pt.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Pt.reject(e)}static resolve(t){return new Pt(((e,n)=>{e(t)}))}static reject(t){return new Pt(((e,n)=>{n(t)}))}static waitFor(t){return new Pt(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=Pt.resolve(!1);for(const n of t)e=e.next((t=>t?Pt.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new Pt(((n,s)=>{const i=t.length,r=new Array(i);let o=0;for(let u=0;u<i;u++){const c=u;e(t[c]).next((t=>{r[c]=t,++o,o===i&&n(r)}),(t=>s(t)))}}))}static doWhile(t,e){return new Pt(((n,s)=>{const i=()=>{!0===t()?e().next((()=>{i()}),s):n()};i()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.T=new j,this.transaction.oncomplete=()=>{this.T.resolve()},this.transaction.onabort=()=>{e.error?this.T.reject(new Dt(t,e.error)):this.T.resolve()},this.transaction.onerror=e=>{const n=Ot(e.target.error);this.T.reject(new Dt(t,n))}}static open(t,e,n,s){try{return new vt(e,t.transaction(s,n))}catch(t){throw new Dt(e,t)}}get A(){return this.T.promise}abort(t){t&&this.T.reject(t),this.aborted||(index_esm2017_M("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}R(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new xt(e)}}class Vt{constructor(t,e,n){this.name=t,this.version=e,this.P=n;12.2===Vt.v(getUA())&&index_esm2017_F("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return index_esm2017_M("SimpleDb","Removing database:",t),Nt(window.indexedDB.deleteDatabase(t)).toPromise()}static V(){if(!isIndexedDBAvailable())return!1;if(Vt.S())return!0;const t=getUA(),e=Vt.v(t),n=0<e&&e<10,s=Vt.D(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static S(){var t;return"undefined"!=typeof process&&"YES"===(null===(t={NODE_ENV:"production",BASE_URL:"/"})||void 0===t?void 0:t.C)}static N(t,e){return t.store(e)}static v(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static D(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async k(t){return this.db||(index_esm2017_M("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new Dt(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new index_esm2017_Q(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new index_esm2017_Q(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new Dt(t,s))},s.onupgradeneeded=t=>{index_esm2017_M("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.P.O(e,s.transaction,t.oldVersion,this.version).next((()=>{index_esm2017_M("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.M&&(this.db.onversionchange=t=>this.M(t)),this.db}F(t){this.M=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.k(t);const e=vt.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).next((t=>(e.R(),t))).catch((t=>(e.abort(t),Pt.reject(t)))).toPromise();return r.catch((()=>{})),await e.A,r}catch(t){const e=t,n="FirebaseError"!==e.name&&r<3;if(index_esm2017_M("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class St{constructor(t){this.$=t,this.B=!1,this.L=null}get isDone(){return this.B}get U(){return this.L}set cursor(t){this.$=t}done(){this.B=!0}q(t){this.L=t}delete(){return Nt(this.$.delete())}}class Dt extends(null&&index_esm2017_Q){constructor(t,e){super(G.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Ct(t){return"IndexedDbTransactionError"===t.name}class xt{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(index_esm2017_M("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(index_esm2017_M("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Nt(n)}add(t){index_esm2017_M("SimpleDb","ADD",this.store.name,t,t);return Nt(this.store.add(t))}get(t){return Nt(this.store.get(t)).next((e=>(void 0===e&&(e=null),index_esm2017_M("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){index_esm2017_M("SimpleDb","DELETE",this.store.name,t);return Nt(this.store.delete(t))}count(){index_esm2017_M("SimpleDb","COUNT",this.store.name);return Nt(this.store.count())}K(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new Pt(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new Pt(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}W(t,e){index_esm2017_M("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.H=!1;const s=this.cursor(n);return this.G(s,((t,e,n)=>n.delete()))}J(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.G(s,e)}Y(t){const e=this.cursor({});return new Pt(((n,s)=>{e.onerror=t=>{const e=Ot(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}G(t,e){const n=[];return new Pt(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new St(i),o=e(i.primaryKey,i.value,r);if(o instanceof Pt){const t=o.catch((t=>(r.done(),Pt.reject(t))));n.push(t)}r.isDone?s():null===r.U?i.continue():i.continue(r.U)}})).next((()=>Pt.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Nt(t){return new Pt(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ot(t.target.error);n(e)}}))}let kt=null&&!1;function Ot(t){const e=Vt.v(getUA());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new index_esm2017_Q("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return kt||(kt=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Mt{constructor(t,e){this.asyncQueue=t,this.X=e,this.task=null}start(){}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}Z(t){index_esm2017_M("IndexBackiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{index_esm2017_M("IndexBackiller",`Documents written: ${await this.X.tt()}`)}catch(t){Ct(t)?index_esm2017_M("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await bt(t)}await this.Z(1)}))}}class Ft{constructor(t,e){this.localStore=t,this.persistence=e}async tt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.et(e,t)))}et(t,e){const n=new Set;let s=e,i=!0;return Pt.doWhile((()=>!0===i&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((e=>{if(null!==e&&!n.has(e))return index_esm2017_M("IndexBackiller",`Processing collection: ${e}`),this.nt(t,e,s).next((t=>{s-=t,n.add(e)}));i=!1})))).next((()=>e-s))}nt(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(t,i).next((()=>this.st(s,n))).next((n=>(index_esm2017_M("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(t,e,n)))).next((()=>i.size))}))))}st(t,e){let n=t;return e.changes.forEach(((t,e)=>{const s=It(e);Et(s,n)>0&&(n=s)})),new Tt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.it(t),this.rt=t=>e.writeSequenceNumber(t))}it(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.rt&&this.rt(t),t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Lt(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ut(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$t.ot=-1;class qt{constructor(t,e){this.comparator=t,this.root=e||Gt.EMPTY}insert(t,e){return new qt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Gt.BLACK,null,null))}remove(t){return new qt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Gt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Kt(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Kt(this.root,t,this.comparator,!1)}getReverseIterator(){return new Kt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Kt(this.root,t,this.comparator,!0)}}class Kt{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Gt{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:Gt.RED,this.left=null!=s?s:Gt.EMPTY,this.right=null!=i?i:Gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Gt(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Gt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Gt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw index_esm2017_L();if(this.right.isRed())throw index_esm2017_L();const t=this.left.check();if(t!==this.right.check())throw index_esm2017_L();return t+(this.isRed()?0:1)}}Gt.EMPTY=null,Gt.RED=!0,Gt.BLACK=!1;Gt.EMPTY=new class{constructor(){this.size=0}get key(){throw index_esm2017_L()}get value(){throw index_esm2017_L()}get color(){throw index_esm2017_L()}get left(){throw index_esm2017_L()}get right(){throw index_esm2017_L()}copy(t,e,n,s,i){return this}insert(t,e,n){return new Gt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(t){this.comparator=t,this.data=new qt(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new jt(this.data.getIterator())}getIteratorFrom(t){return new jt(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Qt))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Qt(this.comparator);return e.data=t,e}}class jt{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Wt(t){return t.hasNext()?t.getNext():void 0}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(t){this.fields=t,t.sort(ft.comparator)}static empty(){return new zt([])}unionWith(t){let e=new Qt(ft.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new zt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return rt(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(){return"undefined"!=typeof atob}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Jt(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Jt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return it(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Jt.EMPTY_BYTE_STRING=new Jt("");const Yt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Xt(t){if(index_esm2017_U(!!t),"string"==typeof t){let e=0;const n=Yt.exec(t);if(index_esm2017_U(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Zt(t.seconds),nanos:Zt(t.nanos)}}function Zt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function te(t){return"string"==typeof t?Jt.fromBase64String(t):Jt.fromUint8Array(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ee(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ne(t){const e=t.mapValue.fields.__previous_value__;return ee(e)?ne(e):e}function se(t){const e=Xt(t.mapValue.fields.__local_write_time__.timestampValue);return new ut(e.seconds,e.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(t,e,n,s,i,r,o,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=u}}class re{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new re("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof re&&t.projectId===this.projectId&&t.database===this.database}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oe(t){return null==t}function ue(t){return 0===t&&1/t==-1/0}function ce(t){return"number"==typeof t&&Number.isInteger(t)&&!ue(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ae={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},he={nullValue:"NULL_VALUE"};function le(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ee(t)?4:be(t)?9007199254740991:10:index_esm2017_L()}function fe(t,e){if(t===e)return!0;const n=le(t);if(n!==le(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return se(t).isEqual(se(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Xt(t.timestampValue),s=Xt(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return te(t.bytesValue).isEqual(te(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Zt(t.geoPointValue.latitude)===Zt(e.geoPointValue.latitude)&&Zt(t.geoPointValue.longitude)===Zt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Zt(t.integerValue)===Zt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Zt(t.doubleValue),s=Zt(e.doubleValue);return n===s?ue(n)===ue(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return rt(t.arrayValue.values||[],e.arrayValue.values||[],fe);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Bt(n)!==Bt(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!fe(n[t],s[t])))return!1;return!0}(t,e);default:return index_esm2017_L()}}function de(t,e){return void 0!==(t.values||[]).find((t=>fe(t,e)))}function _e(t,e){if(t===e)return 0;const n=le(t),s=le(e);if(n!==s)return it(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return it(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Zt(t.integerValue||t.doubleValue),s=Zt(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return we(t.timestampValue,e.timestampValue);case 4:return we(se(t),se(e));case 5:return it(t.stringValue,e.stringValue);case 6:return function(t,e){const n=te(t),s=te(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=it(n[t],s[t]);if(0!==e)return e}return it(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=it(Zt(t.latitude),Zt(e.latitude));if(0!==n)return n;return it(Zt(t.longitude),Zt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=_e(n[t],s[t]);if(e)return e}return it(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===ae.mapValue&&e===ae.mapValue)return 0;if(t===ae.mapValue)return 1;if(e===ae.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=it(s[t],r[t]);if(0!==e)return e;const o=_e(n[s[t]],i[r[t]]);if(0!==o)return o}return it(s.length,r.length)}(t.mapValue,e.mapValue);default:throw index_esm2017_L()}}function we(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return it(t,e);const n=Xt(t),s=Xt(e),i=it(n.seconds,s.seconds);return 0!==i?i:it(n.nanos,s.nanos)}function me(t){return ge(t)}function ge(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Xt(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?te(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,dt.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=ge(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${ge(t.fields[i])}`;return n+"}"}(t.mapValue):index_esm2017_L();var e,n}function ye(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function pe(t){return!!t&&"integerValue"in t}function Ie(t){return!!t&&"arrayValue"in t}function Te(t){return!!t&&"nullValue"in t}function Ee(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ae(t){return!!t&&"mapValue"in t}function Re(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Lt(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Re(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Re(t.arrayValue.values[n]);return e}return Object.assign({},t)}function be(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}function Pe(t){return"nullValue"in t?he:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?ye(re.empty(),dt.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?{mapValue:{}}:index_esm2017_L()}function ve(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?ye(re.empty(),dt.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?{mapValue:{}}:"mapValue"in t?ae:index_esm2017_L()}function Ve(t,e){const n=_e(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Se(t,e){const n=_e(t.value,e.value);return 0!==n?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(t){this.value=t}static empty(){return new De({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ae(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Re(e)}setAll(t){let e=ft.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=Re(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Ae(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return fe(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Ae(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Lt(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new De(Re(this.value))}}function Ce(t){const e=[];return Lt(t.fields,((t,n)=>{const s=new ft([t]);if(Ae(n)){const t=Ce(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new zt(e)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class xe{constructor(t,e,n,s,i,r){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.data=i,this.documentState=r}static newInvalidDocument(t){return new xe(t,0,ct.min(),ct.min(),De.empty(),0)}static newFoundDocument(t,e,n){return new xe(t,1,e,ct.min(),n,0)}static newNoDocument(t,e){return new xe(t,2,e,ct.min(),De.empty(),0)}static newUnknownDocument(t,e){return new xe(t,3,e,ct.min(),De.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=De.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=De.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ct.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof xe&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new xe(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ne{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.ut=null}}function ke(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Ne(t,e,n,s,i,r,o)}function Oe(t){const e=index_esm2017_K(t);if(null===e.ut){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+me(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),oe(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>me(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>me(t))).join(",")),e.ut=t}return e.ut}function Me(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${me(e.value)}`;var e})).join(", ")}]`),oe(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>me(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>me(t))).join(",")),`Target(${e})`}function Fe(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ze(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!fe(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&(!!t.path.isEqual(e.path)&&(!!en(t.startAt,e.startAt)&&en(t.endAt,e.endAt)))}function $e(t){return dt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Be(t,e){return t.filters.filter((t=>t instanceof qe&&t.field.isEqual(e)))}function Le(t,e,n){let s=he,i=!0;for(const n of Be(t,e)){let t=he,e=!0;switch(n.op){case"<":case"<=":t=Pe(n.value);break;case"==":case"in":case">=":t=n.value;break;case">":t=n.value,e=!1;break;case"!=":case"not-in":t=he}Ve({value:s,inclusive:i},{value:t,inclusive:e})<0&&(s=t,i=e)}if(null!==n)for(let r=0;r<t.orderBy.length;++r){if(t.orderBy[r].field.isEqual(e)){const t=n.position[r];Ve({value:s,inclusive:i},{value:t,inclusive:n.inclusive})<0&&(s=t,i=n.inclusive);break}}return{value:s,inclusive:i}}function Ue(t,e,n){let s=ae,i=!0;for(const n of Be(t,e)){let t=ae,e=!0;switch(n.op){case">=":case">":t=ve(n.value),e=!1;break;case"==":case"in":case"<=":t=n.value;break;case"<":t=n.value,e=!1;break;case"!=":case"not-in":t=ae}Se({value:s,inclusive:i},{value:t,inclusive:e})>0&&(s=t,i=e)}if(null!==n)for(let r=0;r<t.orderBy.length;++r){if(t.orderBy[r].field.isEqual(e)){const t=n.position[r];Se({value:s,inclusive:i},{value:t,inclusive:n.inclusive})>0&&(s=t,i=n.inclusive);break}}return{value:s,inclusive:i}}class qe extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.ct(t,e,n):new Ke(t,e,n):"array-contains"===e?new We(t,n):"in"===e?new ze(t,n):"not-in"===e?new He(t,n):"array-contains-any"===e?new Je(t,n):new qe(t,e,n)}static ct(t,e,n){return"in"===e?new Ge(t,n):new Qe(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.at(_e(e,this.value)):null!==e&&le(this.value)===le(e)&&this.at(_e(e,this.value))}at(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return index_esm2017_L()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ke extends qe{constructor(t,e,n){super(t,e,n),this.key=dt.fromName(n.referenceValue)}matches(t){const e=dt.comparator(t.key,this.key);return this.at(e)}}class Ge extends qe{constructor(t,e){super(t,"in",e),this.keys=je("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Qe extends qe{constructor(t,e){super(t,"not-in",e),this.keys=je("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function je(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>dt.fromName(t.referenceValue)))}class We extends qe{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ie(e)&&de(e.arrayValue,this.value)}}class ze extends qe{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&de(this.value.arrayValue,e)}}class He extends qe{constructor(t,e){super(t,"not-in",e)}matches(t){if(de(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!de(this.value.arrayValue,e)}}class Je extends qe{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ie(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>de(this.value.arrayValue,t)))}}class Ye{constructor(t,e){this.position=t,this.inclusive=e}}class Xe{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ze(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function tn(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(r.field.isKeyField())s=dt.comparator(dt.fromName(o.referenceValue),n.key);else{s=_e(o,n.data.field(r.field))}if("desc"===r.dir&&(s*=-1),0!==s)break}return s}function en(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++){if(!fe(t.position[n],e.position[n]))return!1}return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=u,this.lt=null,this.ft=null,this.startAt,this.endAt}}function sn(t,e,n,s,i,r,o,u){return new nn(t,e,n,s,i,r,o,u)}function rn(t){return new nn(t)}function on(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function un(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function cn(t){for(const e of t.filters)if(e.ht())return e.field;return null}function an(t){return null!==t.collectionGroup}function hn(t){const e=index_esm2017_K(t);if(null===e.lt){e.lt=[];const t=cn(e),n=un(e);if(null!==t&&null===n)t.isKeyField()||e.lt.push(new Xe(t)),e.lt.push(new Xe(ft.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.lt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new Xe(ft.keyField(),t))}}}return e.lt}function ln(t){const e=index_esm2017_K(t);if(!e.ft)if("F"===e.limitType)e.ft=ke(e.path,e.collectionGroup,hn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of hn(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Xe(n.field,e))}const n=e.endAt?new Ye(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new Ye(e.startAt.position,e.startAt.inclusive):null;e.ft=ke(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.ft}function fn(t,e,n){return new nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function dn(t,e){return Fe(ln(t),ln(e))&&t.limitType===e.limitType}function _n(t){return`${Oe(ln(t))}|lt:${t.limitType}`}function wn(t){return`Query(target=${Me(ln(t))}; limitType=${t.limitType})`}function mn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):dt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){if(t.startAt&&!function(t,e,n){const s=tn(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,hn(t),e))return!1;if(t.endAt&&!function(t,e,n){const s=tn(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,hn(t),e))return!1;return!0}(t,e)}function gn(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function yn(t){return(e,n)=>{let s=!1;for(const i of hn(t)){const t=pn(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function pn(t,e,n){const s=t.field.isKeyField()?dt.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?_e(s,i):index_esm2017_L()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return index_esm2017_L()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function In(t,e){if(t.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ue(e)?"-0":e}}function Tn(t){return{integerValue:""+t}}function En(t,e){return ce(e)?Tn(e):In(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(){this._=void 0}}function Rn(t,e,n){return t instanceof vn?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Vn?Sn(t,e):t instanceof Dn?Cn(t,e):function(t,e){const n=Pn(t,e),s=Nn(n)+Nn(t._t);return pe(n)&&pe(t._t)?Tn(s):In(t.wt,s)}(t,e)}function bn(t,e,n){return t instanceof Vn?Sn(t,e):t instanceof Dn?Cn(t,e):n}function Pn(t,e){return t instanceof xn?pe(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class vn extends An{}class Vn extends An{constructor(t){super(),this.elements=t}}function Sn(t,e){const n=kn(e);for(const e of t.elements)n.some((t=>fe(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Dn extends An{constructor(t){super(),this.elements=t}}function Cn(t,e){let n=kn(e);for(const e of t.elements)n=n.filter((t=>!fe(t,e)));return{arrayValue:{values:n}}}class xn extends An{constructor(t,e){super(),this.wt=t,this._t=e}}function Nn(t){return Zt(t.integerValue||t.doubleValue)}function kn(t){return Ie(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(t,e){this.field=t,this.transform=e}}function Mn(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Vn&&e instanceof Vn||t instanceof Dn&&e instanceof Dn?rt(t.elements,e.elements,fe):t instanceof xn&&e instanceof xn?fe(t._t,e._t):t instanceof vn&&e instanceof vn}(t.transform,e.transform)}class Fn{constructor(t,e){this.version=t,this.transformResults=e}}class $n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new $n}static exists(t){return new $n(void 0,t)}static updateTime(t){return new $n(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Bn(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ln{}function Un(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Yn(t.key,$n.none()):new jn(t.key,t.data,$n.none());{const n=t.data,s=De.empty();let i=new Qt(ft.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),i=i.add(t)}return new Wn(t.key,s,new zt(i.toArray()),$n.none())}}function qn(t,e,n){t instanceof jn?function(t,e,n){const s=t.value.clone(),i=Hn(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Wn?function(t,e,n){if(!Bn(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Hn(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(zn(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Kn(t,e,n,s){return t instanceof jn?function(t,e,n,s){if(!Bn(t.precondition,e))return n;const i=t.value.clone(),r=Jn(t.fieldTransforms,s,e);return i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,s):t instanceof Wn?function(t,e,n,s){if(!Bn(t.precondition,e))return n;const i=Jn(t.fieldTransforms,s,e),r=e.data;if(r.setAll(zn(t)),r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n)return null;return n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){if(Bn(t.precondition,e))return e.convertToNoDocument(e.version).setHasLocalMutations(),null;return n}(t,e,n)}function Gn(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=Pn(s.transform,t||null);null!=i&&(null===n&&(n=De.empty()),n.set(s.field,i))}return n||null}function Qn(t,e){return t.type===e.type&&(!!t.key.isEqual(e.key)&&(!!t.precondition.isEqual(e.precondition)&&(!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&rt(t,e,((t,e)=>Mn(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask)))))}class jn extends Ln{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Wn extends Ln{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function zn(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function Hn(t,e,n){const s=new Map;index_esm2017_U(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,u=e.data.field(r.field);s.set(r.field,bn(o,u,n[i]))}return s}function Jn(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,Rn(t,r,e))}return s}class Yn extends Ln{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xn extends Ln{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(t){this.count=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ts,es;function ns(t){switch(t){default:return index_esm2017_L();case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0}}function ss(t){if(void 0===t)return index_esm2017_F("GRPC error has no .code"),G.UNKNOWN;switch(t){case ts.OK:return G.OK;case ts.CANCELLED:return G.CANCELLED;case ts.UNKNOWN:return G.UNKNOWN;case ts.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case ts.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case ts.INTERNAL:return G.INTERNAL;case ts.UNAVAILABLE:return G.UNAVAILABLE;case ts.UNAUTHENTICATED:return G.UNAUTHENTICATED;case ts.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case ts.NOT_FOUND:return G.NOT_FOUND;case ts.ALREADY_EXISTS:return G.ALREADY_EXISTS;case ts.PERMISSION_DENIED:return G.PERMISSION_DENIED;case ts.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case ts.ABORTED:return G.ABORTED;case ts.OUT_OF_RANGE:return G.OUT_OF_RANGE;case ts.UNIMPLEMENTED:return G.UNIMPLEMENTED;case ts.DATA_LOSS:return G.DATA_LOSS;default:return index_esm2017_L()}}(es=ts||(ts={}))[es.OK=0]="OK",es[es.CANCELLED=1]="CANCELLED",es[es.UNKNOWN=2]="UNKNOWN",es[es.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",es[es.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",es[es.NOT_FOUND=5]="NOT_FOUND",es[es.ALREADY_EXISTS=6]="ALREADY_EXISTS",es[es.PERMISSION_DENIED=7]="PERMISSION_DENIED",es[es.UNAUTHENTICATED=16]="UNAUTHENTICATED",es[es.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",es[es.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",es[es.ABORTED=10]="ABORTED",es[es.OUT_OF_RANGE=11]="OUT_OF_RANGE",es[es.UNIMPLEMENTED=12]="UNIMPLEMENTED",es[es.INTERNAL=13]="INTERNAL",es[es.UNAVAILABLE=14]="UNAVAILABLE",es[es.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Lt(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return Ut(this.inner)}size(){return this.innerSize}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rs=new qt(dt.comparator);function os(){return rs}const us=new qt(dt.comparator);function cs(...t){let e=us;for(const n of t)e=e.insert(n.key,n);return e}function as(t){let e=us;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function hs(){return fs()}function ls(){return fs()}function fs(){return new is((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ds=new qt(dt.comparator);const _s=new Qt(dt.comparator);function ws(...t){let e=_s;for(const n of t)e=e.add(n);return e}const ms=new Qt(it);function gs(){return ms}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,ps.createSynthesizedTargetChangeForCurrentChange(t,e)),new ys(ct.min(),n,gs(),os(),ws())}}class ps{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new ps(Jt.EMPTY_BYTE_STRING,e,ws(),ws(),ws())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(t,e,n,s){this.gt=t,this.removedTargetIds=e,this.key=n,this.yt=s}}class Ts{constructor(t,e){this.targetId=t,this.It=e}}class Es{constructor(t,e,n=Jt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class As{constructor(){this.Tt=0,this.Et=Ps(),this.At=Jt.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(t){t.approximateByteSize()>0&&(this.bt=!0,this.At=t)}St(){let t=ws(),e=ws(),n=ws();return this.Et.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:index_esm2017_L()}})),new ps(this.At,this.Rt,t,e,n)}Dt(){this.bt=!1,this.Et=Ps()}Ct(t,e){this.bt=!0,this.Et=this.Et.insert(t,e)}xt(t){this.bt=!0,this.Et=this.Et.remove(t)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class Rs{constructor(t){this.Mt=t,this.Ft=new Map,this.$t=os(),this.Bt=bs(),this.Lt=new Qt(it)}Ut(t){for(const e of t.gt)t.yt&&t.yt.isFoundDocument()?this.qt(e,t.yt):this.Kt(e,t.key,t.yt);for(const e of t.removedTargetIds)this.Kt(e,t.key,t.yt)}Gt(t){this.forEachTarget(t,(e=>{const n=this.Qt(e);switch(t.state){case 0:this.jt(e)&&n.Vt(t.resumeToken);break;case 1:n.kt(),n.Pt||n.Dt(),n.Vt(t.resumeToken);break;case 2:n.kt(),n.Pt||this.removeTarget(e);break;case 3:this.jt(e)&&(n.Ot(),n.Vt(t.resumeToken));break;case 4:this.jt(e)&&(this.Wt(e),n.Vt(t.resumeToken));break;default:index_esm2017_L()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ft.forEach(((t,n)=>{this.jt(n)&&e(n)}))}zt(t){const e=t.targetId,n=t.It.count,s=this.Ht(e);if(s){const t=s.target;if($e(t))if(0===n){const n=new dt(t.path);this.Kt(e,n,xe.newNoDocument(n,ct.min()))}else index_esm2017_U(1===n);else{this.Jt(e)!==n&&(this.Wt(e),this.Lt=this.Lt.add(e))}}}Yt(t){const e=new Map;this.Ft.forEach(((n,s)=>{const i=this.Ht(s);if(i){if(n.current&&$e(i.target)){const e=new dt(i.target.path);null!==this.$t.get(e)||this.Xt(s,e)||this.Kt(s,e,xe.newNoDocument(e,t))}n.vt&&(e.set(s,n.St()),n.Dt())}}));let n=ws();this.Bt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.Ht(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.$t.forEach(((e,n)=>n.setReadTime(t)));const s=new ys(t,e,this.Lt,this.$t,n);return this.$t=os(),this.Bt=bs(),this.Lt=new Qt(it),s}qt(t,e){if(!this.jt(t))return;const n=this.Xt(t,e.key)?2:0;this.Qt(t).Ct(e.key,n),this.$t=this.$t.insert(e.key,e),this.Bt=this.Bt.insert(e.key,this.Zt(e.key).add(t))}Kt(t,e,n){if(!this.jt(t))return;const s=this.Qt(t);this.Xt(t,e)?s.Ct(e,1):s.xt(e),this.Bt=this.Bt.insert(e,this.Zt(e).delete(t)),n&&(this.$t=this.$t.insert(e,n))}removeTarget(t){this.Ft.delete(t)}Jt(t){const e=this.Qt(t).St();return this.Mt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Nt(t){this.Qt(t).Nt()}Qt(t){let e=this.Ft.get(t);return e||(e=new As,this.Ft.set(t,e)),e}Zt(t){let e=this.Bt.get(t);return e||(e=new Qt(it),this.Bt=this.Bt.insert(t,e)),e}jt(t){const e=null!==this.Ht(t);return e||index_esm2017_M("WatchChangeAggregator","Detected inactive target",t),e}Ht(t){const e=this.Ft.get(t);return e&&e.Pt?null:this.Mt.te(t)}Wt(t){this.Ft.set(t,new As);this.Mt.getRemoteKeysForTarget(t).forEach((e=>{this.Kt(t,e,null)}))}Xt(t,e){return this.Mt.getRemoteKeysForTarget(t).has(e)}}function bs(){return new qt(dt.comparator)}function Ps(){return new qt(dt.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vs=(()=>{const t={asc:"ASCENDING",desc:"DESCENDING"};return t})(),Vs=(()=>{const t={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};return t})();class Ss{constructor(t,e){this.databaseId=t,this.dt=e}}function Ds(t,e){if(t.dt){return`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`}return{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cs(t,e){return t.dt?e.toBase64():e.toUint8Array()}function xs(t,e){return Ds(t,e.toTimestamp())}function Ns(t){return index_esm2017_U(!!t),ct.fromTimestamp(function(t){const e=Xt(t);return new ut(e.seconds,e.nanos)}(t))}function ks(t,e){return function(t){return new ht(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Os(t){const e=ht.fromString(t);return index_esm2017_U(ui(e)),e}function Ms(t,e){return ks(t.databaseId,e.path)}function Fs(t,e){const n=Os(e);if(n.get(1)!==t.databaseId.projectId)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new dt(Us(n))}function $s(t,e){return ks(t.databaseId,e)}function Bs(t){const e=Os(t);return 4===e.length?ht.emptyPath():Us(e)}function Ls(t){return new ht(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Us(t){return index_esm2017_U(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function qs(t,e,n){return{name:Ms(t,e),fields:n.value.mapValue.fields}}function Ks(t,e,n){const s=Fs(t,e.name),i=Ns(e.updateTime),r=new De({mapValue:{fields:e.fields}}),o=xe.newFoundDocument(s,i,r);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Gs(t,e){return"found"in e?function(t,e){index_esm2017_U(!!e.found),e.found.name,e.found.updateTime;const n=Fs(t,e.found.name),s=Ns(e.found.updateTime),i=new De({mapValue:{fields:e.found.fields}});return xe.newFoundDocument(n,s,i)}(t,e):"missing"in e?function(t,e){index_esm2017_U(!!e.missing),index_esm2017_U(!!e.readTime);const n=Fs(t,e.missing),s=Ns(e.readTime);return xe.newNoDocument(n,s)}(t,e):index_esm2017_L()}function Qs(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:index_esm2017_L()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.dt?(index_esm2017_U(void 0===e||"string"==typeof e),Jt.fromBase64String(e||"")):(index_esm2017_U(void 0===e||e instanceof Uint8Array),Jt.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(t){const e=void 0===t.code?G.UNKNOWN:ss(t.code);return new index_esm2017_Q(e,t.message||"")}(o);n=new Es(s,i,r,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Fs(t,s.document.name),r=Ns(s.document.updateTime),o=new De({mapValue:{fields:s.document.fields}}),u=xe.newFoundDocument(i,r,o),c=s.targetIds||[],a=s.removedTargetIds||[];n=new Is(c,a,u.key,u)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Fs(t,s.document),r=s.readTime?Ns(s.readTime):ct.min(),o=xe.newNoDocument(i,r),u=s.removedTargetIds||[];n=new Is([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Fs(t,s.document),r=s.removedTargetIds||[];n=new Is([],r,i,null)}else{if(!("filter"in e))return index_esm2017_L();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new Zn(s),r=t.targetId;n=new Ts(r,i)}}return n}function js(t,e){let n;if(e instanceof jn)n={update:qs(t,e.key,e.value)};else if(e instanceof Yn)n={delete:Ms(t,e.key)};else if(e instanceof Wn)n={update:qs(t,e.key,e.data),updateMask:oi(e.fieldMask)};else{if(!(e instanceof Xn))return index_esm2017_L();n={verify:Ms(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof vn)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vn)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Dn)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xn)return{fieldPath:e.field.canonicalString(),increment:n._t};throw index_esm2017_L()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:xs(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:index_esm2017_L()}(t,e.precondition)),n}function Ws(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?$n.updateTime(Ns(t.updateTime)):void 0!==t.exists?$n.exists(t.exists):$n.none()}(e.currentDocument):$n.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)index_esm2017_U("REQUEST_TIME"===e.setToServerValue),n=new vn;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Vn(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Dn(t)}else"increment"in e?n=new xn(t,e.increment):index_esm2017_L();const s=ft.fromServerFormat(e.fieldPath);return new On(s,n)}(t,e))):[];if(e.update){e.update.name;const i=Fs(t,e.update.name),r=new De({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new zt(e.map((t=>ft.fromServerFormat(t))))}(e.updateMask);return new Wn(i,r,t,n,s)}return new jn(i,r,n,s)}if(e.delete){const s=Fs(t,e.delete);return new Yn(s,n)}if(e.verify){const s=Fs(t,e.verify);return new Xn(s,n)}return index_esm2017_L()}function zs(t,e){return t&&t.length>0?(index_esm2017_U(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ns(t.updateTime):Ns(e);return n.isEqual(ct.min())&&(n=Ns(e)),new Fn(n,t.transformResults||[])}(t,e)))):[]}function Hs(t,e){return{documents:[$s(t,e.path)]}}function Js(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=$s(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=$s(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Ee(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NAN"}};if(Te(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ee(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NAN"}};if(Te(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ni(t.field),op:ei(t.op),value:t.value}}}(t)));if(1===e.length)return e[0];return{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0===t.length)return;return t.map((t=>function(t){return{field:ni(t.field),direction:ti(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.dt||oe(e)?e:{value:e}}(t,e.limit);var u;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Ys(t){let e=Bs(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){index_esm2017_U(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=Zs(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Xe(si(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let u=null;n.limit&&(u=function(t){let e;return e="object"==typeof t?t.value:t,oe(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Ye(n,e)}(n.startAt));let a=null;return n.endAt&&(a=function(t){const e=!t.before,n=t.values||[];return new Ye(n,e)}(n.endAt)),sn(e,i,o,r,u,"F",c,a)}function Xs(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return index_esm2017_L()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}function Zs(t){return t?void 0!==t.unaryFilter?[ri(t)]:void 0!==t.fieldFilter?[ii(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Zs(t))).reduce(((t,e)=>t.concat(e))):index_esm2017_L():[]}function ti(t){return vs[t]}function ei(t){return Vs[t]}function ni(t){return{fieldPath:t.canonicalString()}}function si(t){return ft.fromServerFormat(t.fieldPath)}function ii(t){return qe.create(si(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return index_esm2017_L()}}(t.fieldFilter.op),t.fieldFilter.value)}function ri(t){switch(t.unaryFilter.op){case"IS_NAN":const e=si(t.unaryFilter.field);return qe.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=si(t.unaryFilter.field);return qe.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=si(t.unaryFilter.field);return qe.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=si(t.unaryFilter.field);return qe.create(i,"!=",{nullValue:"NULL_VALUE"});default:return index_esm2017_L()}}function oi(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ui(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=hi(e)),e=ai(t.get(n),e);return hi(e)}function ai(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function hi(t){return t+""}function li(t){const e=t.length;if(index_esm2017_U(e>=2),2===e)return index_esm2017_U(""===t.charAt(0)&&""===t.charAt(1)),ht.emptyPath();const n=e-2,s=[];let i="";for(let r=0;r<e;){const e=t.indexOf("",r);(e<0||e>n)&&index_esm2017_L();switch(t.charAt(e+1)){case"":const n=t.substring(r,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),s.push(o);break;case"":i+=t.substring(r,e),i+="\0";break;case"":i+=t.substring(r,e+1);break;default:index_esm2017_L()}r=e+2}return new ht(s)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fi=null&&["userId","batchId"];
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(t,e){return[t,ci(e)]}function _i(t,e,n){return[t,ci(e),n]}const wi={},mi=null&&["prefixPath","collectionGroup","readTime","documentId"],gi=null&&["prefixPath","collectionGroup","documentId"],yi=null&&["collectionGroup","readTime","prefixPath","documentId"],pi=null&&["canonicalId","targetId"],Ii=null&&["targetId","path"],Ti=null&&["path","targetId"],Ei=null&&["collectionId","parent"],Ai=null&&["indexId","uid"],Ri=null&&["uid","sequenceNumber"],bi=null&&["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Pi=null&&["indexId","uid","orderedDocumentKey"],vi=null&&["userId","collectionPath","documentId"],Vi=null&&["userId","collectionPath","largestBatchId"],Si=null&&["userId","collectionGroup","largestBatchId"],Di=[...[...[...[...["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"],"clientMetadata"],"remoteDocumentGlobal"],"collectionParents"],"bundles","namedQueries"],Ci=[...Di,"documentOverlays"],xi=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ni=xi,ki=[...Ni,"indexConfiguration","indexState","indexEntries"];
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi extends(null&&Rt){constructor(t,e){super(),this.ee=t,this.currentSequenceNumber=e}}function Mi(t,e){const n=index_esm2017_K(t);return Vt.N(n.ee,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];if(s.key.isEqual(t.key)){qn(s,t,n[e])}}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Kn(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Kn(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ls();return this.mutations.forEach((s=>{const i=t.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=e.has(s.key)?null:o;const u=Un(r,o);null!==u&&n.set(s.key,u),r.isValidDocument()||r.convertToNoDocument(ct.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ws())}isEqual(t){return this.batchId===t.batchId&&rt(this.mutations,t.mutations,((t,e)=>Qn(t,e)))&&rt(this.baseMutations,t.baseMutations,((t,e)=>Qn(t,e)))}}class $i{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){index_esm2017_U(t.mutations.length===n.length);let s=ds;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new $i(t,e,n,s)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(t,e,n,s,i=ct.min(),r=ct.min(),o=Jt.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Li(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Li(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Li(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(t){this.ne=t}}function qi(t,e){let n;if(e.document)n=Ks(t.ne,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=dt.fromSegments(e.noDocument.path),s=ji(e.noDocument.readTime);n=xe.newNoDocument(t,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return index_esm2017_L();{const t=dt.fromSegments(e.unknownDocument.path),s=ji(e.unknownDocument.version);n=xe.newUnknownDocument(t,s)}}return e.readTime&&n.setReadTime(function(t){const e=new ut(t[0],t[1]);return ct.fromTimestamp(e)}(e.readTime)),n}function Ki(t,e){const n=e.key,s={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Gi(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())s.document=function(t,e){return{name:Ms(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Ds(t,e.version.toTimestamp())}}(t.ne,e);else if(e.isNoDocument())s.noDocument={path:n.path.toArray(),readTime:Qi(e.version)};else{if(!e.isUnknownDocument())return index_esm2017_L();s.unknownDocument={path:n.path.toArray(),version:Qi(e.version)}}return s}function Gi(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Qi(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ji(t){const e=new ut(t.seconds,t.nanoseconds);return ct.fromTimestamp(e)}function Wi(t,e){const n=(e.baseMutations||[]).map((e=>Ws(t.ne,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>Ws(t.ne,e))),i=ut.fromMillis(e.localWriteTimeMs);return new Fi(e.batchId,i,n,s)}function zi(t){const e=ji(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ji(t.lastLimboFreeSnapshotVersion):ct.min();let s;var i;return void 0!==t.query.documents?(index_esm2017_U(1===(i=t.query).documents.length),s=ln(rn(Bs(i.documents[0])))):s=function(t){return ln(Ys(t))}(t.query),new Li(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Jt.fromBase64String(t.resumeToken))}function Hi(t,e){const n=Qi(e.snapshotVersion),s=Qi(e.lastLimboFreeSnapshotVersion);let i;i=$e(e.target)?Hs(t.ne,e.target):Js(t.ne,e.target);const r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Oe(e.target),readTime:n,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:i}}function Ji(t){const e=Ys({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?fn(e,e.limit,"L"):e}function Yi(t,e){return new Bi(e.largestBatchId,Ws(t.ne,e.overlayMutation))}function Xi(t,e){const n=e.path.lastSegment();return[t,ci(e.path.popLast()),n]}function Zi(t,e,n,s){return{indexId:t,uid:e.uid||"",sequenceNumber:n,readTime:Qi(s.readTime),documentKey:ci(s.documentKey.path),largestBatchId:s.largestBatchId}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{getBundleMetadata(t,e){return er(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:ji(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return er(t).put({bundleId:(n=e).id,createTime:Qi(Ns(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return nr(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Ji(e.bundledQuery),readTime:ji(e.readTime)};var e}))}saveNamedQuery(t,e){return nr(t).put(function(t){return{name:t.name,readTime:Qi(Ns(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function er(t){return Mi(t,"bundles")}function nr(t){return Mi(t,"namedQueries")}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(t,e){this.wt=t,this.userId=e}static se(t,e){const n=e.uid||"";return new sr(t,n)}getOverlay(t,e){return ir(t).get(Xi(this.userId,e)).next((t=>t?Yi(this.wt,t):null))}getOverlays(t,e){const n=hs();return Pt.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((n,i)=>{const r=new Bi(e,i);s.push(this.ie(t,r))})),Pt.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((t=>s.add(ci(t.getCollectionPath()))));const i=[];return s.forEach((e=>{const s=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);i.push(ir(t).W("collectionPathOverlayIndex",s))})),Pt.waitFor(i)}getOverlaysForCollection(t,e,n){const s=hs(),i=ci(e),r=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ir(t).K("collectionPathOverlayIndex",r).next((t=>{for(const e of t){const t=Yi(this.wt,e);s.set(t.getKey(),t)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=hs();let r;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ir(t).J({index:"collectionGroupOverlayIndex",range:o},((t,e,n)=>{const o=Yi(this.wt,e);i.size()<s||o.largestBatchId===r?(i.set(o.getKey(),o),r=o.largestBatchId):n.done()})).next((()=>i))}ie(t,e){return ir(t).put(function(t,e,n){const[s,i,r]=Xi(e,n.mutation.key);return{userId:e,collectionPath:i,documentId:r,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:js(t.ne,n.mutation)}}(this.wt,this.userId,e))}}function ir(t){return Mi(t,"documentOverlays")}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(){}re(t,e){this.oe(t,e),e.ue()}oe(t,e){if("nullValue"in t)this.ce(e,5);else if("booleanValue"in t)this.ce(e,10),e.ae(t.booleanValue?1:0);else if("integerValue"in t)this.ce(e,15),e.ae(Zt(t.integerValue));else if("doubleValue"in t){const n=Zt(t.doubleValue);isNaN(n)?this.ce(e,13):(this.ce(e,15),ue(n)?e.ae(0):e.ae(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ce(e,20),"string"==typeof n?e.he(n):(e.he(`${n.seconds||""}`),e.ae(n.nanos||0))}else if("stringValue"in t)this.le(t.stringValue,e),this.fe(e);else if("bytesValue"in t)this.ce(e,30),e.de(te(t.bytesValue)),this.fe(e);else if("referenceValue"in t)this._e(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ce(e,45),e.ae(n.latitude||0),e.ae(n.longitude||0)}else"mapValue"in t?be(t)?this.ce(e,Number.MAX_SAFE_INTEGER):(this.we(t.mapValue,e),this.fe(e)):"arrayValue"in t?(this.me(t.arrayValue,e),this.fe(e)):index_esm2017_L()}le(t,e){this.ce(e,25),this.ge(t,e)}ge(t,e){e.he(t)}we(t,e){const n=t.fields||{};this.ce(e,55);for(const t of Object.keys(n))this.le(t,e),this.oe(n[t],e)}me(t,e){const n=t.values||[];this.ce(e,50);for(const t of n)this.oe(t,e)}_e(t,e){this.ce(e,37);dt.fromName(t).path.forEach((t=>{this.ce(e,60),this.ge(t,e)}))}ce(t,e){t.ae(e)}fe(t){t.ae(2)}}rr.ye=new rr;function or(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function ur(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const s=or(255&t[n]);if(e+=s,8!==s)break}return e}(t);return Math.ceil(e/8)}class cr{constructor(){this.buffer=new Uint8Array(1024),this.position=0}pe(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ie(n.value),n=e.next();this.Te()}Ee(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Ae(n.value),n=e.next();this.Re()}be(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ie(t);else if(t<2048)this.Ie(960|t>>>6),this.Ie(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ie(480|t>>>12),this.Ie(128|63&t>>>6),this.Ie(128|63&t);else{const t=e.codePointAt(0);this.Ie(240|t>>>18),this.Ie(128|63&t>>>12),this.Ie(128|63&t>>>6),this.Ie(128|63&t)}}this.Te()}Pe(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.Ae(t);else if(t<2048)this.Ae(960|t>>>6),this.Ae(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.Ae(480|t>>>12),this.Ae(128|63&t>>>6),this.Ae(128|63&t);else{const t=e.codePointAt(0);this.Ae(240|t>>>18),this.Ae(128|63&t>>>12),this.Ae(128|63&t>>>6),this.Ae(128|63&t)}}this.Re()}ve(t){const e=this.Ve(t),n=ur(e);this.Se(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}De(t){const e=this.Ve(t),n=ur(e);this.Se(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}Ce(){this.xe(255),this.xe(255)}Ne(){this.ke(255),this.ke(255)}reset(){this.position=0}seed(t){this.Se(t.length),this.buffer.set(t,this.position),this.position+=t.length}Oe(){return this.buffer.slice(0,this.position)}Ve(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}Ie(t){const e=255&t;0===e?(this.xe(0),this.xe(255)):255===e?(this.xe(255),this.xe(0)):this.xe(e)}Ae(t){const e=255&t;0===e?(this.ke(0),this.ke(255)):255===e?(this.ke(255),this.ke(0)):this.ke(t)}Te(){this.xe(0),this.xe(1)}Re(){this.ke(0),this.ke(1)}xe(t){this.Se(1),this.buffer[this.position++]=t}ke(t){this.Se(1),this.buffer[this.position++]=~t}Se(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class ar{constructor(t){this.Me=t}de(t){this.Me.pe(t)}he(t){this.Me.be(t)}ae(t){this.Me.ve(t)}ue(){this.Me.Ce()}}class hr{constructor(t){this.Me=t}de(t){this.Me.Ee(t)}he(t){this.Me.Pe(t)}ae(t){this.Me.De(t)}ue(){this.Me.Ne()}}class lr{constructor(){this.Me=new cr,this.Fe=new ar(this.Me),this.$e=new hr(this.Me)}seed(t){this.Me.seed(t)}Be(t){return 0===t?this.Fe:this.$e}Oe(){return this.Me.Oe()}reset(){this.Me.reset()}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}Le(){const t=this.directionalValue.length,e=0===t||255===this.directionalValue[t-1]?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new fr(this.indexId,this.documentKey,this.arrayValue,n)}}function dr(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=_r(t.arrayValue,e.arrayValue),0!==n?n:(n=_r(t.directionalValue,e.directionalValue),0!==n?n:dt.comparator(t.documentKey,e.documentKey)))}function _r(t,e){for(let n=0;n<t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(t){this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ue=t.orderBy,this.qe=[];for(const e of t.filters){const t=e;t.ht()?this.Ke=t:this.qe.push(t)}}Ge(t){const e=wt(t);if(void 0!==e&&!this.Qe(e))return!1;const n=mt(t);let s=0,i=0;for(;s<n.length&&this.Qe(n[s]);++s);if(s===n.length)return!0;if(void 0!==this.Ke){const t=n[s];if(!this.je(this.Ke,t)||!this.We(this.Ue[i++],t))return!1;++s}for(;s<n.length;++s){const t=n[s];if(i>=this.Ue.length||!this.We(this.Ue[i++],t))return!1}return!0}Qe(t){for(const e of this.qe)if(this.je(e,t))return!0;return!1}je(t,e){if(void 0===t||!t.field.isEqual(e.fieldPath))return!1;const n="array-contains"===t.op||"array-contains-any"===t.op;return 2===e.kind===n}We(t,e){return!!t.field.isEqual(e.fieldPath)&&(0===e.kind&&"asc"===t.dir||1===e.kind&&"desc"===t.dir)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(){this.ze=new gr}addToCollectionParentIndex(t,e){return this.ze.add(e),Pt.resolve()}getCollectionParents(t,e){return Pt.resolve(this.ze.getEntries(e))}addFieldIndex(t,e){return Pt.resolve()}deleteFieldIndex(t,e){return Pt.resolve()}getDocumentsMatchingTarget(t,e){return Pt.resolve(null)}getIndexType(t,e){return Pt.resolve(0)}getFieldIndexes(t,e){return Pt.resolve([])}getNextCollectionGroupToUpdate(t){return Pt.resolve(null)}getMinOffset(t,e){return Pt.resolve(Tt.min())}getMinOffsetFromCollectionGroup(t,e){return Pt.resolve(Tt.min())}updateCollectionGroup(t,e,n){return Pt.resolve()}updateIndexEntries(t,e){return Pt.resolve()}}class gr{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Qt(ht.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Qt(ht.comparator)).toArray()}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yr=new Uint8Array(0);class pr{constructor(t,e){this.user=t,this.databaseId=e,this.He=new gr,this.Je=new is((t=>Oe(t)),((t,e)=>Fe(t,e))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.He.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.He.add(e)}));const i={collectionId:n,parent:ci(s)};return Ir(t).put(i)}return Pt.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[ot(e),""],!1,!0);return Ir(t).K(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(li(s.parent))}return n}))}addFieldIndex(t,e){const n=Er(t),s=function(t){return{indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind]))}}(e);delete s.indexId;const i=n.add(s);if(e.indexState){const n=Ar(t);return i.next((t=>{n.put(Zi(t,this.user,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=Er(t),s=Ar(t),i=Tr(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e){const n=Tr(t);let s=!0;const i=new Map;return Pt.forEach(this.Ye(e),(e=>this.Xe(t,e).next((t=>{s&&(s=!!t),i.set(e,t)})))).next((()=>{if(s){let t=ws();const s=[];return Pt.forEach(i,((i,r)=>{var o;index_esm2017_M("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((t=>`${t.fieldPath}:${t.kind}`)).join(",")}`} to execute ${Oe(e)}`);const u=function(t,e){const n=wt(e);if(void 0===n)return null;for(const e of Be(t,n.fieldPath))switch(e.op){case"array-contains-any":return e.value.arrayValue.values||[];case"array-contains":return[e.value]}return null}(r,i),c=function(t,e){const n=new Map;for(const s of mt(e))for(const e of Be(t,s.fieldPath))switch(e.op){case"==":case"in":n.set(s.fieldPath.canonicalString(),e.value);break;case"not-in":case"!=":return n.set(s.fieldPath.canonicalString(),e.value),Array.from(n.values())}return null}(r,i),a=function(t,e){const n=[];let s=!0;for(const i of mt(e)){const e=0===i.kind?Le(t,i.fieldPath,t.startAt):Ue(t,i.fieldPath,t.startAt);n.push(e.value),s&&(s=e.inclusive)}return new Ye(n,s)}(r,i),h=function(t,e){const n=[];let s=!0;for(const i of mt(e)){const e=0===i.kind?Ue(t,i.fieldPath,t.endAt):Le(t,i.fieldPath,t.endAt);n.push(e.value),s&&(s=e.inclusive)}return new Ye(n,s)}(r,i),l=this.Ze(i,r,a),f=this.Ze(i,r,h),d=this.tn(i,r,c),_=this.en(i.indexId,u,l,a.inclusive,f,h.inclusive,d);return Pt.forEach(_,(i=>n.j(i,e.limit).next((e=>{e.forEach((e=>{const n=dt.fromSegments(e.documentKey);t.has(n)||(t=t.add(n),s.push(n))}))}))))})).next((()=>s))}return Pt.resolve(null)}))}Ye(t){let e=this.Je.get(t);return e||(e=[t],this.Je.set(t,e),e)}en(t,e,n,s,i,r,o){const u=(null!=e?e.length:1)*Math.max(n.length,i.length),c=u/(null!=e?e.length:1),a=[];for(let h=0;h<u;++h){const u=e?this.nn(e[h/c]):yr,l=this.sn(t,u,n[h%c],s),f=this.rn(t,u,i[h%c],r),d=o.map((e=>this.sn(t,u,e,!0)));a.push(...this.createRange(l,f,d))}return a}sn(t,e,n,s){const i=new fr(t,dt.empty(),e,n);return s?i:i.Le()}rn(t,e,n,s){const i=new fr(t,dt.empty(),e,n);return s?i.Le():i}Xe(t,e){const n=new wr(e),s=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((t=>{let e=null;for(const s of t){n.Ge(s)&&(!e||s.fields.length>e.fields.length)&&(e=s)}return e}))}getIndexType(t,e){let n=2;return Pt.forEach(this.Ye(e),(e=>this.Xe(t,e).next((t=>{t?0!==n&&t.fields.length<function(t){let e=new Qt(ft.comparator),n=!1;for(const s of t.filters){const t=s;t.field.isKeyField()||("array-contains"===t.op||"array-contains-any"===t.op?n=!0:e=e.add(t.field))}for(const n of t.orderBy)n.field.isKeyField()||(e=e.add(n.field));return e.size+(n?1:0)}(e)&&(n=1):n=0})))).next((()=>n))}on(t,e){const n=new lr;for(const s of mt(t)){const t=e.data.field(s.fieldPath);if(null==t)return null;const i=n.Be(s.kind);rr.ye.re(t,i)}return n.Oe()}nn(t){const e=new lr;return rr.ye.re(t,e.Be(0)),e.Oe()}un(t,e){const n=new lr;return rr.ye.re(ye(this.databaseId,e),n.Be(function(t){const e=mt(t);return 0===e.length?0:e[e.length-1].kind}(t))),n.Oe()}tn(t,e,n){if(null===n)return[];let s=[];s.push(new lr);let i=0;for(const r of mt(t)){const t=n[i++];for(const n of s)if(this.cn(e,r.fieldPath)&&Ie(t))s=this.an(s,r,t);else{const e=n.Be(r.kind);rr.ye.re(t,e)}}return this.hn(s)}Ze(t,e,n){return this.tn(t,e,n.position)}hn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Oe();return e}an(t,e,n){const s=[...t],i=[];for(const t of n.arrayValue.values||[])for(const n of s){const s=new lr;s.seed(n.Oe()),rr.ye.re(t,s.Be(e.kind)),i.push(s)}return i}cn(t,e){return!!t.filters.find((t=>t instanceof qe&&t.field.isEqual(e)&&("in"===t.op||"not-in"===t.op)))}getFieldIndexes(t,e){const n=Er(t),s=Ar(t);return(e?n.K("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.K()).next((t=>{const e=[];return Pt.forEach(t,(t=>s.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new yt(e.sequenceNumber,new Tt(ji(e.readTime),new dt(li(e.documentKey)),e.largestBatchId)):yt.empty(),s=t.fields.map((([t,e])=>new gt(ft.fromServerFormat(t),e)));return new _t(t.indexId,t.collectionGroup,s,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>{const n=t.indexState.sequenceNumber-e.indexState.sequenceNumber;return 0!==n?n:it(t.collectionGroup,e.collectionGroup)})),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Er(t),i=Ar(t);return this.ln(t).next((t=>s.K("collectionGroupIndex",IDBKeyRange.bound(e,e)).next((e=>Pt.forEach(e,(e=>i.put(Zi(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return Pt.forEach(e,((e,s)=>{const i=n.get(e.collectionGroup);return(i?Pt.resolve(i):this.getFieldIndexes(t,e.collectionGroup)).next((i=>(n.set(e.collectionGroup,i),Pt.forEach(i,(n=>this.fn(t,e,n).next((e=>{const i=this.dn(s,n);return e.isEqual(i)?Pt.resolve():this._n(t,s,n,e,i)})))))))}))}wn(t,e,n,s){return Tr(t).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.un(n,e.key),documentKey:e.key.path.toArray()})}mn(t,e,n,s){return Tr(t).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.un(n,e.key),e.key.path.toArray()])}fn(t,e,n){const s=Tr(t);let i=new Qt(dr);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.un(n,e)])},((t,s)=>{i=i.add(new fr(n.indexId,e,s.arrayValue,s.directionalValue))})).next((()=>i))}dn(t,e){let n=new Qt(dr);const s=this.on(e,t);if(null==s)return n;const i=wt(e);if(null!=i){const r=t.data.field(i.fieldPath);if(Ie(r))for(const i of r.arrayValue.values||[])n=n.add(new fr(e.indexId,t.key,this.nn(i),s))}else n=n.add(new fr(e.indexId,t.key,yr,s));return n}_n(t,e,n,s,i){index_esm2017_M("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const r=[];return function(t,e,n,s,i){const r=t.getIterator(),o=e.getIterator();let u=Wt(r),c=Wt(o);for(;u||c;){let t=!1,e=!1;if(u&&c){const s=n(u,c);s<0?e=!0:s>0&&(t=!0)}else null!=u?e=!0:t=!0;t?(s(c),c=Wt(o)):e?(i(u),u=Wt(r)):(u=Wt(r),c=Wt(o))}}(s,i,dr,(s=>{r.push(this.wn(t,e,n,s))}),(s=>{r.push(this.mn(t,e,n,s))})),Pt.waitFor(r)}ln(t){let e=1;return Ar(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,s)=>{s.done(),e=n.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((t,e)=>dr(t,e))).filter(((t,e,n)=>!e||0!==dr(t,n[e-1])));const s=[];s.push(t);for(const i of n){const n=dr(i,t),r=dr(i,e);if(0===n)s[0]=t.Le();else if(n>0&&r<0)s.push(i),s.push(i.Le());else if(r>0)break}s.push(e);const i=[];for(let t=0;t<s.length;t+=2)i.push(IDBKeyRange.bound([s[t].indexId,this.uid,s[t].arrayValue,s[t].directionalValue,yr,[]],[s[t+1].indexId,this.uid,s[t+1].arrayValue,s[t+1].directionalValue,yr,[]]));return i}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Rr)}getMinOffset(t,e){return Pt.mapArray(this.Ye(e),(e=>this.Xe(t,e).next((t=>t||index_esm2017_L())))).next(Rr)}}function Ir(t){return Mi(t,"collectionParents")}function Tr(t){return Mi(t,"indexEntries")}function Er(t){return Mi(t,"indexConfiguration")}function Ar(t){return Mi(t,"indexState")}function Rr(t){index_esm2017_U(0!==t.length);let e=t[0].indexState.offset,n=e.largestBatchId;for(let s=1;s<t.length;s++){const i=t[s].indexState.offset;Et(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Tt(e.readTime,e.documentKey,n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const br={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Pr{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Pr(t,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vr(t,e,n){const s=t.store("mutations"),i=t.store("documentMutations"),r=[],o=IDBKeyRange.only(n.batchId);let u=0;const c=s.J({range:o},((t,e,n)=>(u++,n.delete())));r.push(c.next((()=>{index_esm2017_U(1===u)})));const a=[];for(const t of n.mutations){const s=_i(e,t.key.path,n.batchId);r.push(i.delete(s)),a.push(t.key)}return Pt.waitFor(r).next((()=>a))}function Vr(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw index_esm2017_L();e=t.noDocument}return JSON.stringify(e).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pr.DEFAULT_COLLECTION_PERCENTILE=10,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pr.DEFAULT=new Pr(41943040,Pr.DEFAULT_COLLECTION_PERCENTILE,Pr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pr.DISABLED=new Pr(-1,0,0);class Sr{constructor(t,e,n,s){this.userId=t,this.wt=e,this.indexManager=n,this.referenceDelegate=s,this.gn={}}static se(t,e,n,s){index_esm2017_U(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new Sr(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Cr(t).J({index:"userMutationsIndex",range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=xr(t),r=Cr(t);return r.add({}).next((o=>{index_esm2017_U("number"==typeof o);const u=new Fi(o,e,n,s),c=function(t,e,n){const s=n.baseMutations.map((e=>js(t.ne,e))),i=n.mutations.map((e=>js(t.ne,e)));return{userId:e,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:s,mutations:i}}(this.wt,this.userId,u),a=[];let h=new Qt(((t,e)=>it(t.canonicalString(),e.canonicalString())));for(const t of s){const e=_i(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),a.push(r.put(c)),a.push(i.put(e,wi))}return h.forEach((e=>{a.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.gn[o]=u.keys()})),Pt.waitFor(a).next((()=>u))}))}lookupMutationBatch(t,e){return Cr(t).get(e).next((t=>t?(index_esm2017_U(t.userId===this.userId),Wi(this.wt,t)):null))}yn(t,e){return this.gn[e]?Pt.resolve(this.gn[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.gn[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Cr(t).J({index:"userMutationsIndex",range:s},((t,e,s)=>{e.userId===this.userId&&(index_esm2017_U(e.batchId>=n),i=Wi(this.wt,e)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Cr(t).J({index:"userMutationsIndex",range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Cr(t).K("userMutationsIndex",e).next((t=>t.map((t=>Wi(this.wt,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=di(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return xr(t).J({range:s},((n,s,r)=>{const[o,u,c]=n,a=li(u);if(o===this.userId&&e.path.isEqual(a))return Cr(t).get(c).next((t=>{if(!t)throw index_esm2017_L();index_esm2017_U(t.userId===this.userId),i.push(Wi(this.wt,t))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Qt(it);const s=[];return e.forEach((e=>{const i=di(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=xr(t).J({range:r},((t,s,i)=>{const[r,o,u]=t,c=li(o);r===this.userId&&e.path.isEqual(c)?n=n.add(u):i.done()}));s.push(o)})),Pt.waitFor(s).next((()=>this.pn(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=di(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new Qt(it);return xr(t).J({range:r},((t,e,i)=>{const[r,u,c]=t,a=li(u);r===this.userId&&n.isPrefixOf(a)?a.length===s&&(o=o.add(c)):i.done()})).next((()=>this.pn(t,o)))}pn(t,e){const n=[],s=[];return e.forEach((e=>{s.push(Cr(t).get(e).next((t=>{if(null===t)throw index_esm2017_L();index_esm2017_U(t.userId===this.userId),n.push(Wi(this.wt,t))})))})),Pt.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return vr(t.ee,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.In(e.batchId)})),Pt.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}In(t){delete this.gn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Pt.resolve();const n=IDBKeyRange.lowerBound([this.userId]);const s=[];return xr(t).J({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=li(t[1]);s.push(e)}else n.done()})).next((()=>{index_esm2017_U(0===s.length)}))}))}containsKey(t,e){return Dr(t,this.userId,e)}Tn(t){return Nr(t).get(this.userId).next((t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Dr(t,e,n){const s=di(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return xr(t).J({range:r,H:!0},((t,n,s)=>{const[r,u,c]=t;r===e&&u===i&&(o=!0),s.done()})).next((()=>o))}function Cr(t){return Mi(t,"mutations")}function xr(t){return Mi(t,"documentMutations")}function Nr(t){return Mi(t,"mutationQueues")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(t){this.En=t}next(){return this.En+=2,this.En}static An(){return new kr(0)}static Rn(){return new kr(-1)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(t,e){this.referenceDelegate=t,this.wt=e}allocateTargetId(t){return this.bn(t).next((e=>{const n=new kr(e.highestTargetId);return e.highestTargetId=n.next(),this.Pn(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.bn(t).next((t=>ct.fromTimestamp(new ut(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.bn(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.bn(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Pn(t,s))))}addTargetData(t,e){return this.vn(t,e).next((()=>this.bn(t).next((n=>(n.targetCount+=1,this.Vn(e,n),this.Pn(t,n))))))}updateTargetData(t,e){return this.vn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Mr(t).delete(e.targetId))).next((()=>this.bn(t))).next((e=>(index_esm2017_U(e.targetCount>0),e.targetCount-=1,this.Pn(t,e))))}removeTargets(t,e,n){let s=0;const i=[];return Mr(t).J(((r,o)=>{const u=zi(o);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(s++,i.push(this.removeTargetData(t,u)))})).next((()=>Pt.waitFor(i))).next((()=>s))}forEachTarget(t,e){return Mr(t).J(((t,n)=>{const s=zi(n);e(s)}))}bn(t){return Fr(t).get("targetGlobalKey").next((t=>(index_esm2017_U(null!==t),t)))}Pn(t,e){return Fr(t).put("targetGlobalKey",e)}vn(t,e){return Mr(t).put(Hi(this.wt,e))}Vn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.bn(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Oe(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Mr(t).J({range:s,index:"queryTargetsIndex"},((t,n,s)=>{const r=zi(n);Fe(e,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=$r(t);return e.forEach((e=>{const r=ci(e.path);s.push(i.put({targetId:n,path:r})),s.push(this.referenceDelegate.addReference(t,n,e))})),Pt.waitFor(s)}removeMatchingKeys(t,e,n){const s=$r(t);return Pt.forEach(e,(e=>{const i=ci(e.path);return Pt.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=$r(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=$r(t);let i=ws();return s.J({range:n,H:!0},((t,e,n)=>{const s=li(t[1]),r=new dt(s);i=i.add(r)})).next((()=>i))}containsKey(t,e){const n=ci(e.path),s=IDBKeyRange.bound([n],[ot(n)],!1,!0);let i=0;return $r(t).J({index:"documentTargetsIndex",H:!0,range:s},(([t,e],n,s)=>{0!==t&&(i++,s.done())})).next((()=>i>0))}te(t,e){return Mr(t).get(e).next((t=>t?zi(t):null))}}function Mr(t){return Mi(t,"targets")}function Fr(t){return Mi(t,"targetGlobal")}function $r(t){return Mi(t,"targetDocuments")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Br([t,e],[n,s]){const i=it(t,n);return 0===i?it(e,s):i}class Lr{constructor(t){this.Sn=t,this.buffer=new Qt(Br),this.Dn=0}Cn(){return++this.Dn}xn(t){const e=[t,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Br(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Ur{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Nn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}stop(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}get started(){return null!==this.Nn}kn(t){index_esm2017_M("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Nn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ct(t)?index_esm2017_M("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await bt(t)}await this.kn(3e5)}))}}class qr{constructor(t,e){this.On=t,this.params=e}calculateTargetCount(t,e){return this.On.Mn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Pt.resolve($t.ot);const n=new Lr(e);return this.On.forEachTarget(t,(t=>n.xn(t.sequenceNumber))).next((()=>this.On.Fn(t,(t=>n.xn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.On.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.On.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(index_esm2017_M("LruGarbageCollector","Garbage collection skipped; disabled"),Pt.resolve(br)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(index_esm2017_M("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),br):this.$n(t,e)))}getCacheSize(t){return this.On.getCacheSize(t)}$n(t,e){let n,s,i,r,o,c,a;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(index_esm2017_M("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,r=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>{if(a=Date.now(),index_esm2017_k()<=LogLevel.DEBUG){index_esm2017_M("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${t} documents in `+(a-c)+"ms\n"+`Total Duration: ${a-h}ms`)}return Pt.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t})}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new qr(t,e)}(this,e)}Mn(t){const e=this.Bn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Bn(t){let e=0;return this.Fn(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Fn(t,e){return this.Ln(t,((t,n)=>e(n)))}addReference(t,e,n){return Gr(t,n)}removeReference(t,e,n){return Gr(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Gr(t,e)}Un(t,e){return function(t,e){let n=!1;return Nr(t).Y((s=>Dr(t,s,e).next((t=>(t&&(n=!0),Pt.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ln(t,((r,o)=>{if(o<=e){const e=this.Un(t,r).next((e=>{if(!e)return i++,n.getEntry(t,r).next((()=>(n.removeEntry(r,ct.min()),$r(t).delete([0,ci(r.path)]))))}));s.push(e)}})).next((()=>Pt.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Gr(t,e)}Ln(t,e){const n=$r(t);let s,i=$t.ot;return n.J({index:"documentTargetsIndex"},(([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==$t.ot&&e(new dt(li(s)),i),i=o,s=r):i=$t.ot})).next((()=>{i!==$t.ot&&e(new dt(li(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Gr(t,e){return $r(t).put(function(t,e){return{targetId:0,path:ci(t.path),sequenceNumber:e}}(e,t.currentSequenceNumber))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(){this.changes=new is((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,xe.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Pt.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(t){this.wt=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Jr(t).put(n)}removeEntry(t,e,n){return Jr(t).delete(function(t,e){const n=t.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Gi(e),n[n.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.qn(t,n))))}getEntry(t,e){let n=xe.newInvalidDocument(e);return Jr(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Yr(e))},((t,s)=>{n=this.Kn(e,s)})).next((()=>n))}Gn(t,e){let n={size:0,document:xe.newInvalidDocument(e)};return Jr(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Yr(e))},((t,s)=>{n={document:this.Kn(e,s),size:Vr(s)}})).next((()=>n))}getEntries(t,e){let n=os();return this.Qn(t,e,((t,e)=>{const s=this.Kn(t,e);n=n.insert(t,s)})).next((()=>n))}jn(t,e){let n=os(),s=new qt(dt.comparator);return this.Qn(t,e,((t,e)=>{const i=this.Kn(t,e);n=n.insert(t,i),s=s.insert(t,Vr(e))})).next((()=>({documents:n,Wn:s})))}Qn(t,e,n){if(e.isEmpty())return Pt.resolve();let s=new Qt(Zr);e.forEach((t=>s=s.add(t)));const i=IDBKeyRange.bound(Yr(s.first()),Yr(s.last())),r=s.getIterator();let o=r.getNext();return Jr(t).J({index:"documentKeyIndex",range:i},((t,e,s)=>{const i=dt.fromSegments([...e.prefixPath,e.collectionGroup,e.documentId]);for(;o&&Zr(o,i)<0;)n(o,null),o=r.getNext();o&&o.isEqual(i)&&(n(o,e),o=r.hasNext()?r.getNext():null),o?s.q(Yr(o)):s.done()})).next((()=>{for(;o;)n(o,null),o=r.hasNext()?r.getNext():null}))}getAllFromCollection(t,e,n){const s=[e.popLast().toArray(),e.lastSegment(),Gi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[e.popLast().toArray(),e.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Jr(t).K(IDBKeyRange.bound(s,i,!0)).next((t=>{let e=os();for(const n of t){const t=this.Kn(dt.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e=e.insert(t.key,t)}return e}))}getAllFromCollectionGroup(t,e,n,s){let i=os();const r=Xr(e,n),o=Xr(e,Tt.max());return Jr(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,o,!0)},((t,e,n)=>{const r=this.Kn(dt.fromSegments(e.prefixPath.concat(e.collectionGroup,e.documentId)),e);i=i.insert(r.key,r),i.size===s&&n.done()})).next((()=>i))}newChangeBuffer(t){return new zr(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Hr(t).get("remoteDocumentGlobalKey").next((t=>(index_esm2017_U(!!t),t)))}qn(t,e){return Hr(t).put("remoteDocumentGlobalKey",e)}Kn(t,e){if(e){const t=qi(this.wt,e);if(!(t.isNoDocument()&&t.version.isEqual(ct.min())))return t}return xe.newInvalidDocument(t)}}function Wr(t){return new jr(t)}class zr extends(null&&Qr){constructor(t,e){super(),this.zn=t,this.trackRemovals=e,this.Hn=new is((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new Qt(((t,e)=>it(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.Hn.get(i);if(e.push(this.zn.removeEntry(t,i,o.readTime)),r.isValidDocument()){const u=Ki(this.zn.wt,r);s=s.add(i.path.popLast());const c=Vr(u);n+=c-o.size,e.push(this.zn.addEntry(t,i,u))}else if(n-=o.size,this.trackRemovals){const n=Ki(this.zn.wt,r.convertToNoDocument(ct.min()));e.push(this.zn.addEntry(t,i,n))}})),s.forEach((n=>{e.push(this.zn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.zn.updateMetadata(t,n)),Pt.waitFor(e)}getFromCache(t,e){return this.zn.Gn(t,e).next((t=>(this.Hn.set(e,{size:t.size,readTime:t.document.readTime}),t.document)))}getAllFromCache(t,e){return this.zn.jn(t,e).next((({documents:t,Wn:e})=>(e.forEach(((e,n)=>{this.Hn.set(e,{size:n,readTime:t.get(e).readTime})})),t)))}}function Hr(t){return Mi(t,"remoteDocumentGlobal")}function Jr(t){return Mi(t,"remoteDocumentsV14")}function Yr(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Xr(t,e){const n=e.documentKey.path.toArray();return[t,Gi(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Zr(t,e){const n=t.path.toArray(),s=e.path.toArray();let i=0;for(let t=0;t<n.length-2&&t<s.length-2;++t)if(i=it(n[t],s[t]),i)return i;return i=it(n.length,s.length),i||(i=it(n[n.length-2],s[s.length-2]),i||it(n[n.length-1],s[s.length-1]))
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class to{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&Kn(n.mutation,t,zt.empty(),ut.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ws()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ws()){const s=hs();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=cs();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=hs();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ws())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let i=os();const r=fs(),o=fs();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof Wn)?i=i.insert(e.key,e):void 0!==o&&(r.set(e.key,o.mutation.getFieldMask()),Kn(o.mutation,e,o.mutation.getFieldMask(),ut.now()))})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new to(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=fs();let s=new qt(((t,e)=>t-e)),i=ws();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||zt.empty();o=i.applyToLocalView(r,o),n.set(t,o);const u=(s.get(i.batchId)||ws()).add(t);s=s.insert(i.batchId,u)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),u=s.key,c=s.value,a=ls();c.forEach((t=>{if(!i.has(t)){const s=Un(e.get(t),n.get(t));null!==s&&a.set(t,s),i=i.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,u,a))}return Pt.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return dt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):an(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):Pt.resolve(hs());let o=-1,u=i;return r.next((e=>Pt.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Pt.resolve():this.getBaseDocument(t,e,n).next((t=>{u=u.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,u,e,ws()))).next((t=>({batchId:o,changes:as(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new dt(e)).next((t=>{let e=cs();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const s=e.collectionGroup;let i=cs();return this.indexManager.getCollectionParents(t,s).next((r=>Pt.forEach(r,(r=>{const o=function(t,e){return new nn(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n){let s;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((i=>(s=i,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===s.get(n)&&(s=s.insert(n,xe.newInvalidDocument(n)))}));let n=cs();return s.forEach(((s,i)=>{const r=t.get(s);void 0!==r&&Kn(r.mutation,i,zt.empty(),ut.now()),mn(e,i)&&(n=n.insert(s,i))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):Pt.resolve(xe.newInvalidDocument(e))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(t){this.wt=t,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(t,e){return Pt.resolve(this.Jn.get(e))}saveBundleMetadata(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ns(n.createTime)}),Pt.resolve()}getNamedQuery(t,e){return Pt.resolve(this.Yn.get(e))}saveNamedQuery(t,e){return this.Yn.set(e.name,function(t){return{name:t.name,query:Ji(t.bundledQuery),readTime:Ns(t.readTime)}}(e)),Pt.resolve()}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(){this.overlays=new qt(dt.comparator),this.Xn=new Map}getOverlay(t,e){return Pt.resolve(this.overlays.get(e))}getOverlays(t,e){const n=hs();return Pt.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.ie(t,e,s)})),Pt.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Xn.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.Xn.delete(n)),Pt.resolve()}getOverlaysForCollection(t,e,n){const s=hs(),i=e.length+1,r=new dt(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&(t.largestBatchId>n&&s.set(t.getKey(),t))}return Pt.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new qt(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=hs(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=hs(),u=i.getIterator();for(;u.hasNext();){if(u.getNext().value.forEach(((t,e)=>o.set(t,e))),o.size()>=s)break}return Pt.resolve(o)}ie(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.Xn.get(s.largestBatchId).delete(n.key);this.Xn.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Bi(e,n));let i=this.Xn.get(e);void 0===i&&(i=ws(),this.Xn.set(e,i)),this.Xn.set(e,i.add(n.key))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(){this.Zn=new Qt(ro.ts),this.es=new Qt(ro.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new ro(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.rs(new ro(t,e))}os(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new dt(new ht([])),n=new ro(e,t),s=new ro(e,t+1),i=[];return this.es.forEachInRange([n,s],(t=>{this.rs(t),i.push(t.key)})),i}cs(){this.Zn.forEach((t=>this.rs(t)))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new dt(new ht([])),n=new ro(e,t),s=new ro(e,t+1);let i=ws();return this.es.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new ro(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ro{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return dt.comparator(t.key,e.key)||it(t.ls,e.ls)}static ns(t,e){return it(t.ls,e.ls)||dt.comparator(t.key,e.key)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.fs=1,this.ds=new Qt(ro.ts)}checkEmpty(t){return Pt.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const i=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Fi(i,e,n,s);this.mutationQueue.push(r);for(const e of s)this.ds=this.ds.add(new ro(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Pt.resolve(r)}lookupMutationBatch(t,e){return Pt.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ws(n),i=s<0?0:s;return Pt.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Pt.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(t){return Pt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ro(e,0),s=new ro(e,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,s],(t=>{const e=this._s(t.ls);i.push(e)})),Pt.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Qt(it);return e.forEach((t=>{const e=new ro(t,0),s=new ro(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,s],(t=>{n=n.add(t.ls)}))})),Pt.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;dt.isDocumentKey(i)||(i=i.child(""));const r=new ro(new dt(i),0);let o=new Qt(it);return this.ds.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.ls)),!0)}),r),Pt.resolve(this.gs(o))}gs(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){index_esm2017_U(0===this.ys(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ds;return Pt.forEach(e.mutations,(s=>{const i=new ro(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ds=n}))}In(t){}containsKey(t,e){const n=new ro(e,0),s=this.ds.firstAfterOrEqual(n);return Pt.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,Pt.resolve()}ys(t,e){return this.ws(t)}ws(t){if(0===this.mutationQueue.length)return 0;return t-this.mutationQueue[0].batchId}_s(t){const e=this.ws(t);if(e<0||e>=this.mutationQueue.length)return null;return this.mutationQueue[e]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uo{constructor(t){this.ps=t,this.docs=new qt(dt.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.ps(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Pt.resolve(n?n.document.mutableCopy():xe.newInvalidDocument(e))}getEntries(t,e){let n=os();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():xe.newInvalidDocument(t))})),Pt.resolve(n)}getAllFromCollection(t,e,n){let s=os();const i=new dt(e.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||(Et(It(i),n)<=0||(s=s.insert(i.key,i.mutableCopy())))}return Pt.resolve(s)}getAllFromCollectionGroup(t,e,n,s){index_esm2017_L()}Is(t,e){return Pt.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new co(this)}getSize(t){return Pt.resolve(this.size)}}class co extends Qr{constructor(t){super(),this.zn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.zn.addEntry(t,s)):this.zn.removeEntry(n)})),Pt.waitFor(e)}getFromCache(t,e){return this.zn.getEntry(t,e)}getAllFromCache(t,e){return this.zn.getEntries(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(t){this.persistence=t,this.Ts=new is((t=>Oe(t)),Fe),this.lastRemoteSnapshotVersion=ct.min(),this.highestTargetId=0,this.Es=0,this.As=new io,this.targetCount=0,this.Rs=kr.An()}forEachTarget(t,e){return this.Ts.forEach(((t,n)=>e(n))),Pt.resolve()}getLastRemoteSnapshotVersion(t){return Pt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Pt.resolve(this.Es)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),Pt.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Es&&(this.Es=e),Pt.resolve()}vn(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new kr(e),this.highestTargetId=e),t.sequenceNumber>this.Es&&(this.Es=t.sequenceNumber)}addTargetData(t,e){return this.vn(e),this.targetCount+=1,Pt.resolve()}updateTargetData(t,e){return this.vn(e),Pt.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.us(e.targetId),this.targetCount-=1,Pt.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Ts.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Ts.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Pt.waitFor(i).next((()=>s))}getTargetCount(t){return Pt.resolve(this.targetCount)}getTargetData(t,e){const n=this.Ts.get(e)||null;return Pt.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),Pt.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),Pt.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.As.us(e),Pt.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return Pt.resolve(n)}containsKey(t,e){return Pt.resolve(this.As.containsKey(e))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(t,e){this.bs={},this.overlays={},this.Ps=new $t(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new ao(this);this.indexManager=new mr,this.remoteDocumentCache=function(t){return new uo(t)}((t=>this.referenceDelegate.Ss(t))),this.wt=new Ui(e),this.Ds=new no(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new so,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.bs[t.toKey()];return n||(n=new oo(e,this.referenceDelegate),this.bs[t.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(t,e,n){index_esm2017_M("MemoryPersistence","Starting transaction:",t);const s=new lo(this.Ps.next());return this.referenceDelegate.Cs(),n(s).next((t=>this.referenceDelegate.xs(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Ns(t,e){return Pt.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class lo extends Rt{constructor(t){super(),this.currentSequenceNumber=t}}class fo{constructor(t){this.persistence=t,this.ks=new io,this.Os=null}static Ms(t){return new fo(t)}get Fs(){if(this.Os)return this.Os;throw index_esm2017_L()}addReference(t,e,n){return this.ks.addReference(n,e),this.Fs.delete(n.toString()),Pt.resolve()}removeReference(t,e,n){return this.ks.removeReference(n,e),this.Fs.add(n.toString()),Pt.resolve()}markPotentiallyOrphaned(t,e){return this.Fs.add(e.toString()),Pt.resolve()}removeTarget(t,e){this.ks.us(e.targetId).forEach((t=>this.Fs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Fs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Cs(){this.Os=new Set}xs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pt.forEach(this.Fs,(n=>{const s=dt.fromPath(n);return this.$s(t,s).next((t=>{t||e.removeEntry(s,ct.min())}))})).next((()=>(this.Os=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.Fs.delete(e.toString()):this.Fs.add(e.toString())}))}Ss(t){return 0}$s(t,e){return Pt.or([()=>Pt.resolve(this.ks.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ns(t,e)])}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(t){this.wt=t}O(t,e,n,s){const i=new vt("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore("owner")}(t),function(t){t.createObjectStore("mutationQueues",{keyPath:"userId"});t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",fi,{unique:!0}),t.createObjectStore("documentMutations")}(t),wo(t),function(t){t.createObjectStore("remoteDocuments")}(t));let r=Pt.resolve();return n<3&&s>=3&&(0!==n&&(!function(t){t.deleteObjectStore("targetDocuments"),t.deleteObjectStore("targets"),t.deleteObjectStore("targetGlobal")}(t),wo(t)),r=r.next((()=>function(t){const e=t.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ct.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(t,e){return e.store("mutations").K().next((n=>{t.deleteObjectStore("mutations");t.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",fi,{unique:!0});const s=e.store("mutations"),i=n.map((t=>s.put(t)));return Pt.waitFor(i)}))}(t,i)))),r=r.next((()=>{!function(t){t.createObjectStore("clientMetadata",{keyPath:"clientId"})}(t)}))),n<5&&s>=5&&(r=r.next((()=>this.Bs(i)))),n<6&&s>=6&&(r=r.next((()=>(function(t){t.createObjectStore("remoteDocumentGlobal")}(t),this.Ls(i))))),n<7&&s>=7&&(r=r.next((()=>this.Us(i)))),n<8&&s>=8&&(r=r.next((()=>this.qs(t,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t)}))),n<10&&s>=10&&(r=r.next((()=>this.Ks(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(t){t.createObjectStore("bundles",{keyPath:"bundleId"})}(t),function(t){t.createObjectStore("namedQueries",{keyPath:"name"})}(t)}))),n<12&&s>=12&&(r=r.next((()=>{!function(t){const e=t.createObjectStore("documentOverlays",{keyPath:vi});e.createIndex("collectionPathOverlayIndex",Vi,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",Si,{unique:!1})}(t)}))),n<13&&s>=13&&(r=r.next((()=>function(t){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:mi});e.createIndex("documentKeyIndex",gi),e.createIndex("collectionGroupIndex",yi)}(t))).next((()=>this.Gs(t,i))).next((()=>t.deleteObjectStore("remoteDocuments")))),n<14&&s>=14&&(r=r.next((()=>this.Qs(t,i)))),n<15&&s>=15&&(r=r.next((()=>function(t){t.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1});t.createObjectStore("indexState",{keyPath:Ai}).createIndex("sequenceNumberIndex",Ri,{unique:!1});t.createObjectStore("indexEntries",{keyPath:bi}).createIndex("documentKeyIndex",Pi,{unique:!1})}(t)))),r}Ls(t){let e=0;return t.store("remoteDocuments").J(((t,n)=>{e+=Vr(n)})).next((()=>{const n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Bs(t){const e=t.store("mutationQueues"),n=t.store("mutations");return e.K().next((e=>Pt.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.K("userMutationsIndex",s).next((n=>Pt.forEach(n,(n=>{index_esm2017_U(n.userId===e.userId);const s=Wi(this.wt,n);return vr(t,e.userId,s).next((()=>{}))}))))}))))}Us(t){const e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next((t=>{const s=[];return n.J(((n,i)=>{const r=new ht(n),o=function(t){return[0,ci(t)]}(r);s.push(e.get(o).next((n=>n?Pt.resolve():(n=>e.put({targetId:0,path:ci(n),sequenceNumber:t.highestListenSequenceNumber}))(r))))})).next((()=>Pt.waitFor(s)))}))}qs(t,e){t.createObjectStore("collectionParents",{keyPath:Ei});const n=e.store("collectionParents"),s=new gr,i=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:ci(s)})}};return e.store("remoteDocuments").J({H:!0},((t,e)=>{const n=new ht(t);return i(n.popLast())})).next((()=>e.store("documentMutations").J({H:!0},(([t,e,n],s)=>{const r=li(e);return i(r.popLast())}))))}Ks(t){const e=t.store("targets");return e.J(((t,n)=>{const s=zi(n),i=Hi(this.wt,s);return e.put(i)}))}Gs(t,e){const n=e.store("remoteDocuments"),s=[];return n.J(((t,n)=>{const i=e.store("remoteDocumentsV14"),r=(o=n,o.document?new dt(ht.fromString(o.document.name).popFirst(5)):o.noDocument?dt.fromSegments(o.noDocument.path):o.unknownDocument?dt.fromSegments(o.unknownDocument.path):index_esm2017_L()).path.toArray();var o;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};s.push(i.put(u))})).next((()=>Pt.waitFor(s)))}Qs(t,e){const n=e.store("mutations"),s=Wr(this.wt),i=new ho(fo.Ms,this.wt.ne);return n.K().next((t=>{const n=new Map;return t.forEach((t=>{var e;let s=null!==(e=n.get(t.userId))&&void 0!==e?e:ws();Wi(this.wt,t).keys().forEach((t=>s=s.add(t))),n.set(t.userId,s)})),Pt.forEach(n,((t,n)=>{const r=new index_esm2017_C(n),o=sr.se(this.wt,r),u=i.getIndexManager(r),c=Sr.se(r,this.wt,u,i.referenceDelegate);return new eo(s,c,o,u).recalculateAndSaveOverlaysForDocumentKeys(new Oi(e,$t.ot),t).next()}))}))}}function wo(t){t.createObjectStore("targetDocuments",{keyPath:Ii}).createIndex("documentTargetsIndex",Ti,{unique:!0});t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",pi,{unique:!0}),t.createObjectStore("targetGlobal")}const mo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class go{constructor(t,e,n,s,i,r,o,u,c,a,h=14){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.js=i,this.window=r,this.document=o,this.Ws=c,this.zs=a,this.Hs=h,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=t=>Promise.resolve(),!go.V())throw new index_esm2017_Q(G.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Kr(this,s),this.ei=e+"main",this.wt=new Ui(u),this.ni=new Vt(this.ei,this.Hs,new _o(this.wt)),this.Vs=new Or(this.referenceDelegate,this.wt),this.remoteDocumentCache=Wr(this.wt),this.Ds=new tr,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===a&&index_esm2017_F("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ii().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new index_esm2017_Q(G.FAILED_PRECONDITION,mo);return this.ri(),this.oi(),this.ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Vs.getHighestSequenceNumber(t)))})).then((t=>{this.Ps=new $t(t,this.Ws)})).then((()=>{this.vs=!0})).catch((t=>(this.ni&&this.ni.close(),Promise.reject(t))))}ci(t){return this.ti=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ni.F((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.js.enqueueAndForget((async()=>{this.started&&await this.ii()})))}ii(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>po(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.ai(t).next((t=>{t||(this.isPrimary=!1,this.js.enqueueRetryable((()=>this.ti(!1))))}))})).next((()=>this.hi(t))).next((e=>this.isPrimary&&!e?this.li(t).next((()=>!1)):!!e&&this.fi(t).next((()=>!0)))))).catch((t=>{if(Ct(t))return index_esm2017_M("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return index_esm2017_M("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.js.enqueueRetryable((()=>this.ti(t))),this.isPrimary=t}))}ai(t){return yo(t).get("owner").next((t=>Pt.resolve(this.di(t))))}_i(t){return po(t).delete(this.clientId)}async wi(){if(this.isPrimary&&!this.mi(this.Zs,18e5)){this.Zs=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=Mi(t,"clientMetadata");return e.K().next((t=>{const n=this.gi(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return Pt.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.si)for(const e of t)this.si.removeItem(this.yi(e.clientId))}}ui(){this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ii().then((()=>this.wi())).then((()=>this.ui()))))}di(t){return!!t&&t.ownerId===this.clientId}hi(t){if(this.zs)return Pt.resolve(!0);return yo(t).get("owner").next((e=>{if(null!==e&&this.mi(e.leaseTimestampMs,5e3)&&!this.pi(e.ownerId)){if(this.di(e)&&this.networkEnabled)return!0;if(!this.di(e)){if(!e.allowTabSynchronization)throw new index_esm2017_Q(G.FAILED_PRECONDITION,mo);return!1}}return!(!this.networkEnabled||!this.inForeground)||po(t).K().next((t=>void 0===this.gi(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&index_esm2017_M("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.vs=!1,this.Ii(),this.Xs&&(this.Xs.cancel(),this.Xs=null),this.Ti(),this.Ei(),await this.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(t=>{const e=new Oi(t,$t.ot);return this.li(e).next((()=>this._i(e)))})),this.ni.close(),this.Ai()}gi(t,e){return t.filter((t=>this.mi(t.updateTimeMs,e)&&!this.pi(t.clientId)))}Ri(){return this.runTransaction("getActiveClients","readonly",(t=>po(t).K().next((t=>this.gi(t,18e5).map((t=>t.clientId))))))}get started(){return this.vs}getMutationQueue(t,e){return Sr.se(t,this.wt,e,this.referenceDelegate)}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new pr(t,this.wt.ne.databaseId)}getDocumentOverlayCache(t){return sr.se(this.wt,t)}getBundleCache(){return this.Ds}runTransaction(t,e,n){index_esm2017_M("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite",i=15===(r=this.Hs)?ki:14===r?Ni:13===r?xi:12===r?Ci:11===r?Di:void index_esm2017_L();var r;let o;return this.ni.runTransaction(t,s,i,(s=>(o=new Oi(s,this.Ps?this.Ps.next():$t.ot),"readwrite-primary"===e?this.ai(o).next((t=>!!t||this.hi(o))).next((e=>{if(!e)throw index_esm2017_F(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.js.enqueueRetryable((()=>this.ti(!1))),new index_esm2017_Q(G.FAILED_PRECONDITION,At);return n(o)})).next((t=>this.fi(o).next((()=>t)))):this.bi(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}bi(t){return yo(t).get("owner").next((t=>{if(null!==t&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)&&!this.di(t)&&!(this.zs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new index_esm2017_Q(G.FAILED_PRECONDITION,mo)}))}fi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return yo(t).put("owner",e)}static V(){return Vt.V()}li(t){const e=yo(t);return e.get("owner").next((t=>this.di(t)?(index_esm2017_M("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):Pt.resolve()))}mi(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(index_esm2017_F(`Detected an update time that is in the future: ${t} > ${n}`),!1))}ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=()=>{this.js.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ii())))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}Ti(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}oi(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Js=()=>{this.Ii(),isSafari()&&navigator.appVersion.match(/Version\/1[45]/)&&this.js.enterRestrictedMode(!0),this.js.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Js))}Ei(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}pi(t){var e;try{const n=null!==(null===(e=this.si)||void 0===e?void 0:e.getItem(this.yi(t)));return index_esm2017_M("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return index_esm2017_F("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}Ii(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(t){index_esm2017_F("Failed to set zombie client id.",t)}}Ai(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch(t){}}yi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function yo(t){return Mi(t,"owner")}function po(t){return Mi(t,"clientMetadata")}function Io(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class To{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Pi=n,this.vi=s}static Vi(t,e){let n=ws(),s=ws();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new To(t,e.fromCache,n,s)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(){this.Si=!1}initialize(t,e){this.Di=t,this.indexManager=e,this.Si=!0}getDocumentsMatchingQuery(t,e,n,s){return this.Ci(t,e).next((i=>i||this.xi(t,e,s,n))).next((n=>n||this.Ni(t,e)))}Ci(t,e){return Pt.resolve(null)}xi(t,e,n,s){return on(e)||s.isEqual(ct.min())?this.Ni(t,e):this.Di.getDocuments(t,n).next((i=>{const r=this.ki(e,i);return this.Oi(e,r,n,s)?this.Ni(t,e):(index_esm2017_k()<=dist_esm_index_esm2017["in"].DEBUG&&index_esm2017_M("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),wn(e)),this.Mi(t,r,e,pt(s,-1)))}))}ki(t,e){let n=new Qt(yn(t));return e.forEach(((e,s)=>{mn(t,s)&&(n=n.add(s))})),n}Oi(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ni(t,e){return index_esm2017_k()<=dist_esm_index_esm2017["in"].DEBUG&&index_esm2017_M("QueryEngine","Using full collection scan to execute query:",wn(e)),this.Di.getDocumentsMatchingQuery(t,e,Tt.min())}Mi(t,e,n,s){return this.Di.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(t,e,n,s){this.persistence=t,this.Fi=e,this.wt=s,this.$i=new qt(it),this.Bi=new is((t=>Oe(t)),Fe),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(n)}qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new eo(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.$i)))}}function Ro(t,e,n,s){return new Ao(t,e,n,s)}async function bo(t,e){const n=index_esm2017_K(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((i=>(s=i,n.qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=ws();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ki:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function Po(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.Ui.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Pt.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);index_esm2017_U(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ws();for(let n=0;n<t.mutationResults.length;++n){t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key))}return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}function vo(t){const e=index_esm2017_K(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Vs.getLastRemoteSnapshotVersion(t)))}function Vo(t,e){const n=index_esm2017_K(t),s=e.snapshotVersion;let i=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Ui.newChangeBuffer({trackRemovals:!0});i=n.$i;const o=[];e.targetChanges.forEach(((r,u)=>{const c=i.get(u);if(!c)return;o.push(n.Vs.removeMatchingKeys(t,r.removedDocuments,u).next((()=>n.Vs.addMatchingKeys(t,r.addedDocuments,u))));let a=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(u)?a=a.withResumeToken(Jt.EMPTY_BYTE_STRING,ct.min()).withLastLimboFreeSnapshotVersion(ct.min()):r.resumeToken.approximateByteSize()>0&&(a=a.withResumeToken(r.resumeToken,s)),i=i.insert(u,a),function(t,e,n){if(0===t.resumeToken.approximateByteSize())return!0;if(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,a,r)&&o.push(n.Vs.updateTargetData(t,a))}));let u=os(),c=ws();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(So(t,r,e.documentUpdates).next((t=>{u=t.Gi,c=t.Qi}))),!s.isEqual(ct.min())){const e=n.Vs.getLastRemoteSnapshotVersion(t).next((e=>n.Vs.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Pt.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,u,c))).next((()=>u))})).then((t=>(n.$i=i,t)))}function So(t,e,n){let s=ws(),i=ws();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=os();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(ct.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):index_esm2017_M("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Gi:s,Qi:i}}))}function Do(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function Co(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Vs.getTargetData(t,e).next((i=>i?(s=i,Pt.resolve(s)):n.Vs.allocateTargetId(t).next((i=>(s=new Li(e,i,0,t.currentSequenceNumber),n.Vs.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.$i.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.$i=n.$i.insert(t.targetId,t),n.Bi.set(e,t.targetId)),t}))}async function xo(t,e,n){const s=index_esm2017_K(t),i=s.$i.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Ct(t))throw t;index_esm2017_M("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.$i=s.$i.remove(e),s.Bi.delete(i.target)}function No(t,e,n){const s=index_esm2017_K(t);let i=ct.min(),r=ws();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=index_esm2017_K(t),i=s.Bi.get(n);return void 0!==i?Pt.resolve(s.$i.get(i)):s.Vs.getTargetData(e,n)}(s,t,ln(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Vs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Fi.getDocumentsMatchingQuery(t,e,n?i:ct.min(),n?r:ws()))).next((t=>(Mo(s,gn(e),t),{documents:t,ji:r})))))}function ko(t,e){const n=index_esm2017_K(t),s=index_esm2017_K(n.Vs),i=n.$i.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.te(t,e).next((t=>t?t.target:null))))}function Oo(t,e){const n=index_esm2017_K(t),s=n.Li.get(e)||ct.min();return n.persistence.runTransaction("Get new document changes","readonly",(t=>n.Ui.getAllFromCollectionGroup(t,e,pt(s,-1),Number.MAX_SAFE_INTEGER))).then((t=>(Mo(n,e,t),t)))}function Mo(t,e,n){let s=ct.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.Li.set(e,s)}async function Fo(t,e,n,s){const i=index_esm2017_K(t);let r=ws(),o=os();for(const t of n){const n=e.Wi(t.metadata.name);t.document&&(r=r.add(n));const s=e.zi(t);s.setReadTime(e.Hi(t.metadata.readTime)),o=o.insert(n,s)}const u=i.Ui.newChangeBuffer({trackRemovals:!0}),c=await Co(i,function(t){return ln(rn(ht.fromString(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>So(t,u,o).next((e=>(u.apply(t),e))).next((e=>i.Vs.removeMatchingKeysForTargetId(t,c.targetId).next((()=>i.Vs.addMatchingKeys(t,r,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(t,e.Gi,e.Qi))).next((()=>e.Gi))))))}async function $o(t,e,n=ws()){const s=await Co(t,ln(Ji(e.bundledQuery))),i=index_esm2017_K(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const r=Ns(e.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i.Ds.saveNamedQuery(t,e);const o=s.withResumeToken(Jt.EMPTY_BYTE_STRING,r);return i.$i=i.$i.insert(o.targetId,o),i.Vs.updateTargetData(t,o).next((()=>i.Vs.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>i.Vs.addMatchingKeys(t,n,s.targetId))).next((()=>i.Ds.saveNamedQuery(t,e)))}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bo(t,e){return`firestore_clients_${t}_${e}`}function Lo(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function Uo(t,e){return`firestore_targets_${t}_${e}`}class qo{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ji(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new index_esm2017_Q(s.error.code,s.error.message))),r?new qo(t,e,s.state,i):(index_esm2017_F("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Yi(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Ko{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ji(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new index_esm2017_Q(n.error.code,n.error.message))),i?new Ko(t,n.state,s):(index_esm2017_F("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Yi(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Go{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ji(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=gs();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=ce(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Go(t,i):(index_esm2017_F("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Qo{constructor(t,e){this.clientId=t,this.onlineState=e}static Ji(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Qo(e.clientId,e.onlineState):(index_esm2017_F("SharedClientState",`Failed to parse online state: ${t}`),null)}}class jo{constructor(){this.activeTargetIds=gs()}Xi(t){this.activeTargetIds=this.activeTargetIds.add(t)}Zi(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Yi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Wo{constructor(t,e,n,s,i){this.window=t,this.js=e,this.persistenceKey=n,this.tr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new qt(it),this.started=!1,this.ir=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.rr=Bo(this.persistenceKey,this.tr),this.ur=function(t){return`firestore_sequence_number_${t}`}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.persistenceKey),this.sr=this.sr.insert(this.tr,new jo),this.cr=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.ar=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.hr=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.lr=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.dr=function(t){return`firestore_bundle_loaded_v2_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.er)}static V(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.Ri();for(const e of t){if(e===this.tr)continue;const t=this.getItem(Bo(this.persistenceKey,e));if(t){const n=Go.Ji(e,t);n&&(this.sr=this.sr.insert(n.clientId,n))}}this._r();const e=this.storage.getItem(this.lr);if(e){const t=this.wr(e);t&&this.mr(t)}for(const t of this.ir)this.nr(t);this.ir=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.ur,JSON.stringify(t))}getAllActiveQueryTargets(){return this.gr(this.sr)}isActiveQueryTarget(t){let e=!1;return this.sr.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.yr(t,"pending")}updateMutationState(t,e,n){this.yr(t,e,n),this.pr(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(Uo(this.persistenceKey,t));if(n){const s=Ko.Ji(t,n);s&&(e=s.state)}}return this.Ir.Xi(t),this._r(),e}removeLocalQueryTarget(t){this.Ir.Zi(t),this._r()}isLocalQueryTarget(t){return this.Ir.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(Uo(this.persistenceKey,t))}updateQueryState(t,e,n){this.Tr(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.pr(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Er(t)}notifyBundleLoaded(t){this.Ar(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return index_esm2017_M("SharedClientState","READ",t,e),e}setItem(t,e){index_esm2017_M("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){index_esm2017_M("SharedClientState","REMOVE",t),this.storage.removeItem(t)}nr(t){const e=t;if(e.storageArea===this.storage){if(index_esm2017_M("SharedClientState","EVENT",e.key,e.newValue),e.key===this.rr)return void index_esm2017_F("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.cr.test(e.key)){if(null==e.newValue){const t=this.Rr(e.key);return this.br(t,null)}{const t=this.Pr(e.key,e.newValue);if(t)return this.br(t.clientId,t)}}else if(this.ar.test(e.key)){if(null!==e.newValue){const t=this.vr(e.key,e.newValue);if(t)return this.Vr(t)}}else if(this.hr.test(e.key)){if(null!==e.newValue){const t=this.Sr(e.key,e.newValue);if(t)return this.Dr(t)}}else if(e.key===this.lr){if(null!==e.newValue){const t=this.wr(e.newValue);if(t)return this.mr(t)}}else if(e.key===this.ur){const t=function(t){let e=$t.ot;if(null!=t)try{const n=JSON.parse(t);index_esm2017_U("number"==typeof n),e=n}catch(t){index_esm2017_F("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==$t.ot&&this.sequenceNumberHandler(t)}else if(e.key===this.dr){const t=this.Cr(e.newValue);await Promise.all(t.map((t=>this.syncEngine.Nr(t))))}}else this.ir.push(e)}))}}get Ir(){return this.sr.get(this.tr)}_r(){this.setItem(this.rr,this.Ir.Yi())}yr(t,e,n){const s=new qo(this.currentUser,t,e,n),i=Lo(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Yi())}pr(t){const e=Lo(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Er(t){const e={clientId:this.tr,onlineState:t};this.storage.setItem(this.lr,JSON.stringify(e))}Tr(t,e,n){const s=Uo(this.persistenceKey,t),i=new Ko(t,e,n);this.setItem(s,i.Yi())}Ar(t){const e=JSON.stringify(Array.from(t));this.setItem(this.dr,e)}Rr(t){const e=this.cr.exec(t);return e?e[1]:null}Pr(t,e){const n=this.Rr(t);return Go.Ji(n,e)}vr(t,e){const n=this.ar.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return qo.Ji(new index_esm2017_C(i),s,e)}Sr(t,e){const n=this.hr.exec(t),s=Number(n[1]);return Ko.Ji(s,e)}wr(t){return Qo.Ji(t)}Cr(t){return JSON.parse(t)}async Vr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.kr(t.batchId,t.state,t.error);index_esm2017_M("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}Dr(t){return this.syncEngine.Or(t.targetId,t.state,t.error)}br(t,e){const n=e?this.sr.insert(t,e):this.sr.remove(t),s=this.gr(this.sr),i=this.gr(n),r=[],o=[];return i.forEach((t=>{s.has(t)||r.push(t)})),s.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.Mr(r,o).then((()=>{this.sr=n}))}mr(t){this.sr.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}gr(t){let e=gs();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class zo{constructor(){this.Fr=new jo,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Fr.Xi(t),this.$r[t]||"not-current"}updateQueryState(t,e,n){this.$r[t]=e}removeLocalQueryTarget(t){this.Fr.Zi(t)}isLocalQueryTarget(t){return this.Fr.activeTargetIds.has(t)}clearQueryState(t){delete this.$r[t]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(t){return this.Fr.activeTargetIds.has(t)}start(){return this.Fr=new jo,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{Br(t){}shutdown(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(t){this.Gr.push(t)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){index_esm2017_M("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Gr)t(0)}Kr(){index_esm2017_M("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Gr)t(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(t){this.jr=t.jr,this.Wr=t.Wr}zr(t){this.Hr=t}Jr(t){this.Yr=t}onMessage(t){this.Xr=t}close(){this.Wr()}send(t){this.jr(t)}Zr(){this.Hr()}eo(t){this.Yr(t)}no(t){this.Xr(t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.so=e+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(t,e,n,s,i){const r=this.oo(t,e);index_esm2017_M("RestConnection","Sending: ",r,n);const o={};return this.uo(o,s,i),this.co(t,r,o,n).then((t=>(index_esm2017_M("RestConnection","Received: ",t),t)),(e=>{throw $("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}ao(t,e,n,s,i,r){return this.ro(t,e,n,s,i)}uo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+index_esm2017_x,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}oo(t,e){const n=Yo[t];return`${this.so}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}co(t,e,n,s){return new Promise(((i,r)=>{const o=new XhrIo;o.listenOnce(EventType.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case ErrorCode.NO_ERROR:const e=o.getResponseJson();index_esm2017_M("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ErrorCode.TIMEOUT:index_esm2017_M("Connection",'RPC "'+t+'" timed out'),r(new index_esm2017_Q(G.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode.HTTP_ERROR:const n=o.getStatus();if(index_esm2017_M("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(e)>=0?e:G.UNKNOWN}(t.status);r(new index_esm2017_Q(e,t.message))}else r(new index_esm2017_Q(G.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new index_esm2017_Q(G.UNAVAILABLE,"Connection failed."));break;default:index_esm2017_L()}}finally{index_esm2017_M("Connection",'RPC "'+t+'" completed.')}}));const u=JSON.stringify(s);o.send(e,"POST",u,n,15)}))}ho(t,e,n){const s=[this.so,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=createWebChannelTransport(),r=getStatEventTarget(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new FetchXmlHttpFactory({})),this.uo(o.initMessageHeaders,e,n),(0,dist_index_esm2017.uI)()||(0,dist_index_esm2017.b$)()||(0,dist_index_esm2017.d)()||(0,dist_index_esm2017.w1)()||(0,dist_index_esm2017.Mn)()||(0,dist_index_esm2017.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const u=s.join("");index_esm2017_M("Connection","Creating WebChannel: "+u,o);const c=i.createWebChannel(u,o);let a=!1,h=!1;const l=new Xo({jr:t=>{h?index_esm2017_M("Connection","Not sending because WebChannel is closed:",t):(a||(index_esm2017_M("Connection","Opening WebChannel transport."),c.open(),a=!0),index_esm2017_M("Connection","WebChannel sending:",t),c.send(t))},Wr:()=>c.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(c,WebChannel.EventType.OPEN,(()=>{h||index_esm2017_M("Connection","WebChannel transport opened.")})),y(c,WebChannel.EventType.CLOSE,(()=>{h||(h=!0,index_esm2017_M("Connection","WebChannel transport closed"),l.eo())})),y(c,WebChannel.EventType.ERROR,(t=>{h||(h=!0,$("Connection","WebChannel transport errored:",t),l.eo(new index_esm2017_Q(G.UNAVAILABLE,"The operation could not be completed")))})),y(c,WebChannel.EventType.MESSAGE,(t=>{var e;if(!h){const n=t.data[0];index_esm2017_U(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){index_esm2017_M("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=ts[t];if(void 0!==e)return ss(e)}(t),n=i.message;void 0===e&&(e=G.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),h=!0,l.eo(new index_esm2017_Q(e,n)),c.close()}else index_esm2017_M("Connection","WebChannel received:",n),l.no(n)}})),y(r,Event.STAT_EVENT,(t=>{t.stat===Stat.PROXY?index_esm2017_M("Connection","Detected buffering proxy"):t.stat===Stat.NOPROXY&&index_esm2017_M("Connection","Detected no buffering proxy")})),setTimeout((()=>{l.Zr()}),0),l}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tu(){return"undefined"!=typeof window?window:null}function eu(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nu(t){return new Ss(t,!0)}class su{constructor(t,e,n=1e3,s=1.5,i=6e4){this.js=t,this.timerId=e,this.lo=n,this.fo=s,this._o=i,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(t){this.cancel();const e=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),s=Math.max(0,e-n);s>0&&index_esm2017_M("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.wo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,s,(()=>(this.yo=Date.now(),t()))),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(t,e,n,s,i,r,o,u){this.js=t,this.Ao=n,this.Ro=s,this.bo=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new su(t,e)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,(()=>this.Oo())))}Mo(t){this.Fo(),this.stream.send(t)}async Oo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(t,e){this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==t?this.So.reset():e&&e.code===G.RESOURCE_EXHAUSTED?(index_esm2017_F(e.toString()),index_esm2017_F("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):e&&e.code===G.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Jr(e)}Bo(){}auth(){this.state=1;const t=this.Lo(this.Po),e=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Po===e&&this.Uo(t,n)}),(e=>{t((()=>{const t=new index_esm2017_Q(G.UNKNOWN,"Fetching auth token failed: "+e.message);return this.qo(t)}))}))}Uo(t,e){const n=this.Lo(this.Po);this.stream=this.Ko(t,e),this.stream.zr((()=>{n((()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,(()=>(this.Co()&&(this.state=3),Promise.resolve()))),this.listener.zr())))})),this.stream.Jr((t=>{n((()=>this.qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}xo(){this.state=5,this.So.Io((async()=>{this.state=0,this.start()}))}qo(t){return index_esm2017_M("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Lo(t){return e=>{this.js.enqueueAndForget((()=>this.Po===t?e():(index_esm2017_M("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ru extends iu{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.wt=i}Ko(t,e){return this.bo.ho("Listen",t,e)}onMessage(t){this.So.reset();const e=Qs(this.wt,t),n=function(t){if(!("targetChange"in t))return ct.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ct.min():e.readTime?Ns(e.readTime):ct.min()}(t);return this.listener.Go(e,n)}Qo(t){const e={};e.database=Ls(this.wt),e.addTarget=function(t,e){let n;const s=e.target;return n=$e(s)?{documents:Hs(t,s)}:{query:Js(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Cs(t,e.resumeToken):e.snapshotVersion.compareTo(ct.min())>0&&(n.readTime=Ds(t,e.snapshotVersion.toTimestamp())),n}(this.wt,t);const n=Xs(this.wt,t);n&&(e.labels=n),this.Mo(e)}jo(t){const e={};e.database=Ls(this.wt),e.removeTarget=t,this.Mo(e)}}class ou extends iu{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.wt=i,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(t,e){return this.bo.ho("Write",t,e)}onMessage(t){if(index_esm2017_U(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Wo){this.So.reset();const e=zs(t.writeResults,t.commitTime),n=Ns(t.commitTime);return this.listener.Jo(n,e)}return index_esm2017_U(!t.writeResults||0===t.writeResults.length),this.Wo=!0,this.listener.Yo()}Xo(){const t={};t.database=Ls(this.wt),this.Mo(t)}Ho(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>js(this.wt,t)))};this.Mo(e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.bo=n,this.wt=s,this.Zo=!1}tu(){if(this.Zo)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"The client has already been terminated.")}ro(t,e,n){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.bo.ro(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new index_esm2017_Q(G.UNKNOWN,t.toString())}))}ao(t,e,n,s){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.bo.ao(t,e,n,i,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new index_esm2017_Q(G.UNKNOWN,t.toString())}))}terminate(){this.Zo=!0}}class cu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve()))))}uu(t){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ru("Offline")))}set(t){this.cu(),this.eu=0,"Online"===t&&(this.su=!1),this.ru(t)}ru(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ou(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(index_esm2017_F(e),this.su=!1):index_esm2017_M("OnlineStateTracker",e)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=i,this.du.Br((t=>{n.enqueueAndForget((async()=>{yu(this)&&(index_esm2017_M("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=index_esm2017_K(t);e.lu.add(4),await lu(e),e._u.set("Unknown"),e.lu.delete(4),await hu(e)}(this))}))})),this._u=new cu(n,s)}}async function hu(t){if(yu(t))for(const e of t.fu)await e(!0)}async function lu(t){for(const e of t.fu)await e(!1)}function fu(t,e){const n=index_esm2017_K(t);n.hu.has(e.targetId)||(n.hu.set(e.targetId,e),gu(n)?mu(n):Mu(n).Co()&&_u(n,e))}function du(t,e){const n=index_esm2017_K(t),s=Mu(n);n.hu.delete(e),s.Co()&&wu(n,e),0===n.hu.size&&(s.Co()?s.ko():yu(n)&&n._u.set("Unknown"))}function _u(t,e){t.wu.Nt(e.targetId),Mu(t).Qo(e)}function wu(t,e){t.wu.Nt(e),Mu(t).jo(e)}function mu(t){t.wu=new Rs({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),te:e=>t.hu.get(e)||null}),Mu(t).start(),t._u.iu()}function gu(t){return yu(t)&&!Mu(t).Do()&&t.hu.size>0}function yu(t){return 0===index_esm2017_K(t).lu.size}function pu(t){t.wu=void 0}async function Iu(t){t.hu.forEach(((e,n)=>{_u(t,e)}))}async function Tu(t,e){pu(t),gu(t)?(t._u.uu(e),mu(t)):t._u.set("Unknown")}async function Eu(t,e,n){if(t._u.set("Online"),e instanceof Es&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.hu.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.hu.delete(s),t.wu.removeTarget(s))}(t,e)}catch(n){index_esm2017_M("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Au(t,n)}else if(e instanceof Is?t.wu.Ut(e):e instanceof Ts?t.wu.zt(e):t.wu.Gt(e),!n.isEqual(ct.min()))try{const e=await vo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.wu.Yt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.hu.get(s);i&&t.hu.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.hu.get(e);if(!n)return;t.hu.set(e,n.withResumeToken(Jt.EMPTY_BYTE_STRING,n.snapshotVersion)),wu(t,e);const s=new Li(n.target,e,1,n.sequenceNumber);_u(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){index_esm2017_M("RemoteStore","Failed to raise snapshot:",e),await Au(t,e)}}async function Au(t,e,n){if(!Ct(e))throw e;t.lu.add(1),await lu(t),t._u.set("Offline"),n||(n=()=>vo(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{index_esm2017_M("RemoteStore","Retrying IndexedDB access"),await n(),t.lu.delete(1),await hu(t)}))}function Ru(t,e){return e().catch((n=>Au(t,n,e)))}async function bu(t){const e=index_esm2017_K(t),n=Fu(e);let s=e.au.length>0?e.au[e.au.length-1].batchId:-1;for(;Pu(e);)try{const t=await Do(e.localStore,s);if(null===t){0===e.au.length&&n.ko();break}s=t.batchId,vu(e,t)}catch(t){await Au(e,t)}Vu(e)&&Su(e)}function Pu(t){return yu(t)&&t.au.length<10}function vu(t,e){t.au.push(e);const n=Fu(t);n.Co()&&n.zo&&n.Ho(e.mutations)}function Vu(t){return yu(t)&&!Fu(t).Do()&&t.au.length>0}function Su(t){Fu(t).start()}async function Du(t){Fu(t).Xo()}async function Cu(t){const e=Fu(t);for(const n of t.au)e.Ho(n.mutations)}async function xu(t,e,n){const s=t.au.shift(),i=$i.from(s,e,n);await Ru(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await bu(t)}async function Nu(t,e){e&&Fu(t).zo&&await async function(t,e){if(n=e.code,ns(n)&&n!==G.ABORTED){const n=t.au.shift();Fu(t).No(),await Ru(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await bu(t)}var n}(t,e),Vu(t)&&Su(t)}async function ku(t,e){const n=index_esm2017_K(t);n.asyncQueue.verifyOperationInProgress(),index_esm2017_M("RemoteStore","RemoteStore received new credentials");const s=yu(n);n.lu.add(3),await lu(n),s&&n._u.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.lu.delete(3),await hu(n)}async function Ou(t,e){const n=index_esm2017_K(t);e?(n.lu.delete(2),await hu(n)):e||(n.lu.add(2),await lu(n),n._u.set("Unknown"))}function Mu(t){return t.mu||(t.mu=function(t,e,n){const s=index_esm2017_K(t);return s.tu(),new ru(e,s.bo,s.authCredentials,s.appCheckCredentials,s.wt,n)
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}(t.datastore,t.asyncQueue,{zr:Iu.bind(null,t),Jr:Tu.bind(null,t),Go:Eu.bind(null,t)}),t.fu.push((async e=>{e?(t.mu.No(),gu(t)?mu(t):t._u.set("Unknown")):(await t.mu.stop(),pu(t))}))),t.mu}function Fu(t){return t.gu||(t.gu=function(t,e,n){const s=index_esm2017_K(t);return s.tu(),new ou(e,s.bo,s.authCredentials,s.appCheckCredentials,s.wt,n)}(t.datastore,t.asyncQueue,{zr:Du.bind(null,t),Jr:Nu.bind(null,t),Yo:Cu.bind(null,t),Jo:xu.bind(null,t)}),t.fu.push((async e=>{e?(t.gu.No(),await bu(t)):(await t.gu.stop(),t.au.length>0&&(index_esm2017_M("RemoteStore",`Stopping write stream with ${t.au.length} pending writes`),t.au=[]))}))),t.gu
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class $u{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new j,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new $u(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new index_esm2017_Q(G.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Bu(t,e){if(index_esm2017_F("AsyncQueue",`${e}: ${t}`),Ct(t))return new index_esm2017_Q(G.UNAVAILABLE,`${e}: ${t}`);throw t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||dt.comparator(e.key,n.key):(t,e)=>dt.comparator(t.key,e.key),this.keyedMap=cs(),this.sortedSet=new qt(this.comparator)}static emptySet(t){return new Lu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Lu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Lu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(){this.yu=new qt(dt.comparator)}track(t){const e=t.doc.key,n=this.yu.get(e);n?0!==t.type&&3===n.type?this.yu=this.yu.insert(e,t):3===t.type&&1!==n.type?this.yu=this.yu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.yu=this.yu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.yu=this.yu.remove(e):1===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):index_esm2017_L():this.yu=this.yu.insert(e,t)}pu(){const t=[];return this.yu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class qu{constructor(t,e,n,s,i,r,o,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=u}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new qu(t,e,Lu.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&dn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(){this.Iu=void 0,this.listeners=[]}}class Gu{constructor(){this.queries=new is((t=>_n(t)),dn),this.onlineState="Unknown",this.Tu=new Set}}async function Qu(t,e){const n=index_esm2017_K(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new Ku),i)try{r.Iu=await n.onListen(s)}catch(t){const n=Bu(t,`Initialization of query '${wn(e.query)}' failed`);return void e.onError(n)}if(n.queries.set(s,r),r.listeners.push(e),e.Eu(n.onlineState),r.Iu){e.Au(r.Iu)&&Hu(n)}}async function ju(t,e){const n=index_esm2017_K(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function Wu(t,e){const n=index_esm2017_K(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.Au(t)&&(s=!0);i.Iu=t}}s&&Hu(n)}function zu(t,e,n){const s=index_esm2017_K(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function Hu(t){t.Tu.forEach((t=>{t.next()}))}class Ju{constructor(t,e,n){this.query=t,this.Ru=e,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new qu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.bu?this.vu(t)&&(this.Ru.next(t),e=!0):this.Vu(t,this.onlineState)&&(this.Su(t),e=!0),this.Pu=t,e}onError(t){this.Ru.error(t)}Eu(t){this.onlineState=t;let e=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,t)&&(this.Su(this.Pu),e=!0),e}Vu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Du||!n)&&(!t.docs.isEmpty()||"Offline"===e)}vu(t){if(t.docChanges.length>0)return!0;const e=this.Pu&&this.Pu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Su(t){t=qu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Ru.next(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu{constructor(t,e){this.payload=t,this.byteLength=e}Cu(){return"metadata"in this.payload}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{constructor(t){this.wt=t}Wi(t){return Fs(this.wt,t)}zi(t){return t.metadata.exists?Ks(this.wt,t.document,!1):xe.newNoDocument(this.Wi(t.metadata.name),this.Hi(t.metadata.readTime))}Hi(t){return Ns(t)}}class Zu{constructor(t,e,n){this.xu=t,this.localStore=e,this.wt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=index_esm2017_tc(t)}Nu(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.payload.namedQuery)this.queries.push(t.payload.namedQuery);else if(t.payload.documentMetadata){this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e;const n=ht.fromString(t.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ku(t){const e=new Map,n=new Xu(this.wt);for(const s of t)if(s.metadata.queries){const t=n.Wi(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||ws()).add(t);e.set(n,s)}}return e}async complete(){const t=await Fo(this.localStore,new Xu(this.wt),this.documents,this.xu.id),e=this.ku(this.documents);for(const t of this.queries)await $o(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ou:this.collectionGroups,Mu:t}}}function index_esm2017_tc(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_ec{constructor(t){this.key=t}}class index_esm2017_nc{constructor(t){this.key=t}}class index_esm2017_sc{constructor(t,e){this.query=t,this.Fu=e,this.$u=null,this.current=!1,this.Bu=ws(),this.mutatedKeys=ws(),this.Lu=yn(t),this.Uu=new Lu(this.Lu)}get qu(){return this.Fu}Ku(t,e){const n=e?e.Gu:new Uu,s=e?e.Uu:this.Uu;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const a=s.get(t),h=mn(this.query,e)?e:null,l=!!a&&this.mutatedKeys.has(a.key),f=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let d=!1;if(a&&h){a.data.isEqual(h.data)?l!==f&&(n.track({type:3,doc:h}),d=!0):this.Qu(a,h)||(n.track({type:2,doc:h}),d=!0,(u&&this.Lu(h,u)>0||c&&this.Lu(h,c)<0)&&(o=!0))}else!a&&h?(n.track({type:0,doc:h}),d=!0):a&&!h&&(n.track({type:1,doc:a}),d=!0,(u||c)&&(o=!0));d&&(h?(r=r.add(h),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Uu:r,Gu:n,Oi:o,mutatedKeys:i}}Qu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.Uu;this.Uu=t.Uu,this.mutatedKeys=t.mutatedKeys;const i=t.Gu.pu();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return index_esm2017_L()}};return n(t)-n(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t.type,e.type)||this.Lu(t.doc,e.doc))),this.ju(n);const r=e?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,u=o!==this.$u;if(this.$u=o,0!==i.length||u){return{snapshot:new qu(this.query,t.Uu,s,i,t.mutatedKeys,0===o,u,!1),zu:r}}return{zu:r}}Eu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new Uu,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(t){return!this.Fu.has(t)&&(!!this.Uu.has(t)&&!this.Uu.get(t).hasLocalMutations)}ju(t){t&&(t.addedDocuments.forEach((t=>this.Fu=this.Fu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Fu=this.Fu.delete(t))),this.current=t.current)}Wu(){if(!this.current)return[];const t=this.Bu;this.Bu=ws(),this.Uu.forEach((t=>{this.Hu(t.key)&&(this.Bu=this.Bu.add(t.key))}));const e=[];return t.forEach((t=>{this.Bu.has(t)||e.push(new index_esm2017_nc(t))})),this.Bu.forEach((n=>{t.has(n)||e.push(new index_esm2017_ec(n))})),e}Ju(t){this.Fu=t.ji,this.Bu=ws();const e=this.Ku(t.documents);return this.applyChanges(e,!0)}Yu(){return qu.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class index_esm2017_ic{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class index_esm2017_rc{constructor(t){this.key=t,this.Xu=!1}}class index_esm2017_oc{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.Zu={},this.tc=new is((t=>_n(t)),dn),this.ec=new Map,this.nc=new Set,this.sc=new qt(dt.comparator),this.ic=new Map,this.rc=new io,this.oc={},this.uc=new Map,this.cc=kr.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}async function index_esm2017_uc(t,e){const n=index_esm2017_Mc(t);let s,i;const r=n.tc.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.Yu();else{const t=await Co(n.localStore,ln(e));n.isPrimaryClient&&fu(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await index_esm2017_cc(n,e,s,"current"===r)}return i}async function index_esm2017_cc(t,e,n,s){t.hc=(e,n,s)=>async function(t,e,n,s){let i=e.view.Ku(n);i.Oi&&(i=await No(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ku(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return index_esm2017_Tc(t,e.targetId,o.zu),o.snapshot}(t,e,n,s);const i=await No(t.localStore,e,!0),r=new index_esm2017_sc(e,i.ji),o=r.Ku(i.documents),u=ps.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,u);index_esm2017_Tc(t,n,c.zu);const a=new index_esm2017_ic(e,n,r);return t.tc.set(e,a),t.ec.has(n)?t.ec.get(n).push(e):t.ec.set(n,[e]),c.snapshot}async function index_esm2017_ac(t,e){const n=index_esm2017_K(t),s=n.tc.get(e),i=n.ec.get(s.targetId);if(i.length>1)return n.ec.set(s.targetId,i.filter((t=>!dn(t,e)))),void n.tc.delete(e);if(n.isPrimaryClient){n.sharedClientState.removeLocalQueryTarget(s.targetId);n.sharedClientState.isActiveQueryTarget(s.targetId)||await xo(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),du(n.remoteStore,s.targetId),index_esm2017_pc(n,s.targetId)})).catch(bt)}else index_esm2017_pc(n,s.targetId),await xo(n.localStore,s.targetId,!0)}async function index_esm2017_hc(t,e,n){const s=index_esm2017_Fc(t);try{const t=await function(t,e){const n=index_esm2017_K(t),s=ut.now(),i=e.reduce(((t,e)=>t.add(e.key)),ws());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let u=os(),c=ws();return n.Ui.getEntries(t,i).next((t=>{u=t,u.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,u))).next((i=>{r=i;const o=[];for(const t of e){const e=Gn(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new Wn(t.key,e,Ce(e.value.mapValue),$n.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:as(r)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.oc[t.currentUser.toKey()];s||(s=new qt(it));s=s.insert(e,n),t.oc[t.currentUser.toKey()]=s}(s,t.batchId,n),await index_esm2017_Rc(s,t.changes),await bu(s.remoteStore)}catch(t){const e=Bu(t,"Failed to persist write");n.reject(e)}}async function index_esm2017_lc(t,e){const n=index_esm2017_K(t);try{const t=await Vo(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.ic.get(e);s&&(index_esm2017_U(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.Xu=!0:t.modifiedDocuments.size>0?index_esm2017_U(s.Xu):t.removedDocuments.size>0&&(index_esm2017_U(s.Xu),s.Xu=!1))})),await index_esm2017_Rc(n,t,e)}catch(t){await bt(t)}}function index_esm2017_fc(t,e,n){const s=index_esm2017_K(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.tc.forEach(((n,s)=>{const i=s.view.Eu(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=index_esm2017_K(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Eu(e)&&(s=!0)})),s&&Hu(n)}(s.eventManager,e),t.length&&s.Zu.Go(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function index_esm2017_dc(t,e,n){const s=index_esm2017_K(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.ic.get(e),r=i&&i.key;if(r){let t=new qt(dt.comparator);t=t.insert(r,xe.newNoDocument(r,ct.min()));const n=ws().add(r),i=new ys(ct.min(),new Map,new Qt(it),t,n);await index_esm2017_lc(s,i),s.sc=s.sc.remove(r),s.ic.delete(e),index_esm2017_Ac(s)}else await xo(s.localStore,e,!1).then((()=>index_esm2017_pc(s,e,n))).catch(bt)}async function _c(t,e){const n=index_esm2017_K(t),s=e.batch.batchId;try{const t=await Po(n.localStore,e);index_esm2017_yc(n,s,null),index_esm2017_gc(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await index_esm2017_Rc(n,t)}catch(t){await bt(t)}}async function index_esm2017_wc(t,e,n){const s=index_esm2017_K(t);try{const t=await function(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(index_esm2017_U(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);index_esm2017_yc(s,e,n),index_esm2017_gc(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await index_esm2017_Rc(s,t)}catch(n){await bt(n)}}async function index_esm2017_mc(t,e){const n=index_esm2017_K(t);yu(n.remoteStore)||index_esm2017_M("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=index_esm2017_K(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.uc.get(t)||[];s.push(e),n.uc.set(t,s)}catch(t){const n=Bu(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}function index_esm2017_gc(t,e){(t.uc.get(e)||[]).forEach((t=>{t.resolve()})),t.uc.delete(e)}function index_esm2017_yc(t,e,n){const s=index_esm2017_K(t);let i=s.oc[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.oc[s.currentUser.toKey()]=i}}function index_esm2017_pc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.ec.get(e))t.tc.delete(s),n&&t.Zu.lc(s,n);if(t.ec.delete(e),t.isPrimaryClient){t.rc.us(e).forEach((e=>{t.rc.containsKey(e)||index_esm2017_Ic(t,e)}))}}function index_esm2017_Ic(t,e){t.nc.delete(e.path.canonicalString());const n=t.sc.get(e);null!==n&&(du(t.remoteStore,n),t.sc=t.sc.remove(e),t.ic.delete(n),index_esm2017_Ac(t))}function index_esm2017_Tc(t,e,n){for(const s of n)if(s instanceof index_esm2017_ec)t.rc.addReference(s.key,e),index_esm2017_Ec(t,s);else if(s instanceof index_esm2017_nc){index_esm2017_M("SyncEngine","Document no longer in limbo: "+s.key),t.rc.removeReference(s.key,e);t.rc.containsKey(s.key)||index_esm2017_Ic(t,s.key)}else index_esm2017_L()}function index_esm2017_Ec(t,e){const n=e.key,s=n.path.canonicalString();t.sc.get(n)||t.nc.has(s)||(index_esm2017_M("SyncEngine","New document in limbo: "+n),t.nc.add(s),index_esm2017_Ac(t))}function index_esm2017_Ac(t){for(;t.nc.size>0&&t.sc.size<t.maxConcurrentLimboResolutions;){const e=t.nc.values().next().value;t.nc.delete(e);const n=new dt(ht.fromString(e)),s=t.cc.next();t.ic.set(s,new index_esm2017_rc(n)),t.sc=t.sc.insert(n,s),fu(t.remoteStore,new Li(ln(rn(n.path)),s,2,$t.ot))}}async function index_esm2017_Rc(t,e,n){const s=index_esm2017_K(t),i=[],r=[],o=[];s.tc.isEmpty()||(s.tc.forEach(((t,u)=>{o.push(s.hc(u,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(u.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=To.Vi(u.targetId,t);r.push(e)}})))})),await Promise.all(o),s.Zu.Go(i),await async function(t,e){const n=index_esm2017_K(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Pt.forEach(e,(e=>Pt.forEach(e.Pi,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Pt.forEach(e.vi,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!Ct(t))throw t;index_esm2017_M("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.$i.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.$i=n.$i.insert(e,i)}}}(s.localStore,r))}async function index_esm2017_bc(t,e){const n=index_esm2017_K(t);if(!n.currentUser.isEqual(e)){index_esm2017_M("SyncEngine","User change. New user:",e.toKey());const t=await bo(n.localStore,e);n.currentUser=e,function(t,e){t.uc.forEach((t=>{t.forEach((t=>{t.reject(new index_esm2017_Q(G.CANCELLED,e))}))})),t.uc.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await index_esm2017_Rc(n,t.Ki)}}function index_esm2017_Pc(t,e){const n=index_esm2017_K(t),s=n.ic.get(e);if(s&&s.Xu)return ws().add(s.key);{let t=ws();const s=n.ec.get(e);if(!s)return t;for(const e of s){const s=n.tc.get(e);t=t.unionWith(s.view.qu)}return t}}async function index_esm2017_vc(t,e){const n=index_esm2017_K(t),s=await No(n.localStore,e.query,!0),i=e.view.Ju(s);return n.isPrimaryClient&&index_esm2017_Tc(n,e.targetId,i.zu),i}async function index_esm2017_Vc(t,e){const n=index_esm2017_K(t);return Oo(n.localStore,e).then((t=>index_esm2017_Rc(n,t)))}async function index_esm2017_Sc(t,e,n,s){const i=index_esm2017_K(t),r=await function(t,e){const n=index_esm2017_K(t),s=index_esm2017_K(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.yn(t,e).next((e=>e?n.localDocuments.getDocuments(t,e):Pt.resolve(null)))))}(i.localStore,e);null!==r?("pending"===n?await bu(i.remoteStore):"acknowledged"===n||"rejected"===n?(index_esm2017_yc(i,e,s||null),index_esm2017_gc(i,e),function(t,e){index_esm2017_K(index_esm2017_K(t).mutationQueue).In(e)}(i.localStore,e)):index_esm2017_L(),await index_esm2017_Rc(i,r)):index_esm2017_M("SyncEngine","Cannot apply mutation batch with id: "+e)}async function index_esm2017_Dc(t,e){const n=index_esm2017_K(t);if(index_esm2017_Mc(n),index_esm2017_Fc(n),!0===e&&!0!==n.ac){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await index_esm2017_Cc(n,t.toArray());n.ac=!0,await Ou(n.remoteStore,!0);for(const t of e)fu(n.remoteStore,t)}else if(!1===e&&!1!==n.ac){const t=[];let e=Promise.resolve();n.ec.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>(index_esm2017_pc(n,i),xo(n.localStore,i,!0)))),du(n.remoteStore,i)})),await e,await index_esm2017_Cc(n,t),function(t){const e=index_esm2017_K(t);e.ic.forEach(((t,n)=>{du(e.remoteStore,n)})),e.rc.cs(),e.ic=new Map,e.sc=new qt(dt.comparator)}(n),n.ac=!1,await Ou(n.remoteStore,!1)}}async function index_esm2017_Cc(t,e,n){const s=index_esm2017_K(t),i=[],r=[];for(const t of e){let e;const n=s.ec.get(t);if(n&&0!==n.length){e=await Co(s.localStore,ln(n[0]));for(const t of n){const e=s.tc.get(t),n=await index_esm2017_vc(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await ko(s.localStore,t);e=await Co(s.localStore,n),await index_esm2017_cc(s,index_esm2017_xc(n),t,!1)}i.push(e)}return s.Zu.Go(r),i}function index_esm2017_xc(t){return sn(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function index_esm2017_Nc(t){const e=index_esm2017_K(t);return index_esm2017_K(index_esm2017_K(e.localStore).persistence).Ri()}async function index_esm2017_kc(t,e,n,s){const i=index_esm2017_K(t);if(i.ac)return void index_esm2017_M("SyncEngine","Ignoring unexpected query state notification.");const r=i.ec.get(e);if(r&&r.length>0)switch(n){case"current":case"not-current":{const t=await Oo(i.localStore,gn(r[0])),s=ys.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await index_esm2017_Rc(i,t,s);break}case"rejected":await xo(i.localStore,e,!0),index_esm2017_pc(i,e,s);break;default:index_esm2017_L()}}async function index_esm2017_Oc(t,e,n){const s=index_esm2017_Mc(t);if(s.ac){for(const t of e){if(s.ec.has(t)){index_esm2017_M("SyncEngine","Adding an already active target "+t);continue}const e=await ko(s.localStore,t),n=await Co(s.localStore,e);await index_esm2017_cc(s,index_esm2017_xc(e),n.targetId,!1),fu(s.remoteStore,n)}for(const t of n)s.ec.has(t)&&await xo(s.localStore,t,!1).then((()=>{du(s.remoteStore,t),index_esm2017_pc(s,t)})).catch(bt)}}function index_esm2017_Mc(t){const e=index_esm2017_K(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=index_esm2017_lc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=index_esm2017_Pc.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=index_esm2017_dc.bind(null,e),e.Zu.Go=Wu.bind(null,e.eventManager),e.Zu.lc=zu.bind(null,e.eventManager),e}function index_esm2017_Fc(t){const e=index_esm2017_K(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_c.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=index_esm2017_wc.bind(null,e),e}function index_esm2017_$c(t,e,n){const s=index_esm2017_K(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=index_esm2017_K(t),s=Ns(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Ds.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s)),Promise.resolve(new Set);n._updateProgress(index_esm2017_tc(s));const i=new Zu(s,t.localStore,e.wt);let r=await e.fc();for(;r;){const t=await i.Nu(r);t&&n._updateProgress(t),r=await e.fc()}const o=await i.complete();return await index_esm2017_Rc(t,o.Mu,void 0),await function(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Ds.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress),Promise.resolve(o.Ou)}catch(t){return $("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t),Promise.resolve(new Set)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)(s,e,n).then((t=>{s.sharedClientState.notifyBundleLoaded(t)}))}class index_esm2017_Bc{constructor(){this.synchronizeTabs=!1}async initialize(t){this.wt=nu(t.databaseInfo.databaseId),this.sharedClientState=this.dc(t),this.persistence=this._c(t),await this.persistence.start(),this.localStore=this.wc(t),this.gcScheduler=this.mc(t,this.localStore),this.indexBackfillerScheduler=this.gc(t,this.localStore)}mc(t,e){return null}gc(t,e){return null}wc(t){return Ro(this.persistence,new Eo,t.initialUser,this.wt)}_c(t){return new ho(fo.Ms,this.wt)}dc(t){return new zo}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class index_esm2017_Lc extends(null&&index_esm2017_Bc){constructor(t,e,n){super(),this.yc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.yc.initialize(this,t),await index_esm2017_Fc(this.yc.syncEngine),await bu(this.yc.remoteStore),await this.persistence.ci((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}wc(t){return Ro(this.persistence,new Eo,t.initialUser,this.wt)}mc(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new Ur(n,t.asyncQueue,e)}gc(t,e){const n=new Ft(e,this.persistence);return new Mt(t.asyncQueue,n)}_c(t){const e=Io(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Pr.withCacheSize(this.cacheSizeBytes):Pr.DEFAULT;return new go(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,tu(),eu(),this.wt,this.sharedClientState,!!this.forceOwnership)}dc(t){return new zo}}class index_esm2017_Uc extends(null&&index_esm2017_Lc){constructor(t,e){super(t,e,!1),this.yc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.yc.syncEngine;this.sharedClientState instanceof Wo&&(this.sharedClientState.syncEngine={kr:index_esm2017_Sc.bind(null,e),Or:index_esm2017_kc.bind(null,e),Mr:index_esm2017_Oc.bind(null,e),Ri:index_esm2017_Nc.bind(null,e),Nr:index_esm2017_Vc.bind(null,e)},await this.sharedClientState.start()),await this.persistence.ci((async t=>{await index_esm2017_Dc(this.yc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start():t||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(t&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():t||this.indexBackfillerScheduler.stop())}))}dc(t){const e=tu();if(!Wo.V(e))throw new index_esm2017_Q(G.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Io(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Wo(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class index_esm2017_qc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>index_esm2017_fc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=index_esm2017_bc.bind(null,this.syncEngine),await Ou(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Gu}createDatastore(t){const e=nu(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Zo(s));var s;return function(t,e,n,s){return new uu(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>index_esm2017_fc(this.syncEngine,t,0),r=Jo.V()?new Jo:new Ho,new au(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const u=new index_esm2017_oc(t,e,n,s,i,r);return o&&(u.ac=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=index_esm2017_K(t);index_esm2017_M("RemoteStore","RemoteStore shutting down."),e.lu.add(5),await lu(e),e.du.shutdown(),e._u.set("Unknown")}(this.remoteStore)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function index_esm2017_Kc(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_Gc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ic(this.observer.next,t)}error(t){this.observer.error?this.Ic(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Tc(){this.muted=!0}Ic(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_Qc{constructor(t,e){this.Ec=t,this.wt=e,this.metadata=new j,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then((t=>{t&&t.Cu()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Ec.cancel()}async getMetadata(){return this.metadata.promise}async fc(){return await this.getMetadata(),this.Rc()}async Rc(){const t=await this.bc();if(null===t)return null;const e=this.Ac.decode(t),n=Number(e);isNaN(n)&&this.Pc(`length string (${e}) is not valid number`);const s=await this.vc(n);return new Yu(JSON.parse(s),t.length+n)}Vc(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async bc(){for(;this.Vc()<0;){if(await this.Sc())break}if(0===this.buffer.length)return null;const t=this.Vc();t<0&&this.Pc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async vc(t){for(;this.buffer.length<t;){await this.Sc()&&this.Pc("Reached the end of bundle when more is expected.")}const e=this.Ac.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}Pc(t){throw this.Ec.cancel(),new Error(`Invalid bundle format: ${t}`)}async Sc(){const t=await this.Ec.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_jc{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=index_esm2017_K(t),s=Ls(n.wt)+"/documents",i={documents:e.map((t=>Ms(n.wt,t)))},r=await n.ao("BatchGetDocuments",s,i,e.length),o=new Map;r.forEach((t=>{const e=Gs(n.wt,t);o.set(e.key.toString(),e)}));const u=[];return e.forEach((t=>{const e=o.get(t.toString());index_esm2017_U(!!e),u.push(e)})),u}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Yn(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=dt.fromPath(e);this.mutations.push(new Xn(n,this.precondition(n)))})),await async function(t,e){const n=index_esm2017_K(t),s=Ls(n.wt)+"/documents",i={writes:e.map((t=>js(n.wt,t)))};await n.ro("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw index_esm2017_L();e=ct.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new index_esm2017_Q(G.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?$n.updateTime(e):$n.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ct.min()))throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $n.updateTime(e)}return $n.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_Wc{constructor(t,e,n,s,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=s,this.deferred=i,this.Dc=n.maxAttempts,this.So=new su(this.asyncQueue,"transaction_retry")}run(){this.Dc-=1,this.Cc()}Cc(){this.So.Io((async()=>{const t=new index_esm2017_jc(this.datastore),e=this.xc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Nc(t)}))))})).catch((t=>{this.Nc(t)}))}))}xc(t){try{const e=this.updateFunction(t);return!oe(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Nc(t){this.Dc>0&&this.kc(t)?(this.Dc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Cc(),Promise.resolve())))):this.deferred.reject(t)}kc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!ns(e)}return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_zc{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=index_esm2017_C.UNAUTHENTICATED,this.clientId=st.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{index_esm2017_M("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(index_esm2017_M("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new j;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Bu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function index_esm2017_Hc(t,e){t.asyncQueue.verifyOperationInProgress(),index_esm2017_M("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await bo(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function index_esm2017_Jc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await index_esm2017_Yc(t);index_esm2017_M("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>ku(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>ku(e.remoteStore,n))),t.onlineComponents=e}async function index_esm2017_Yc(t){return t.offlineComponents||(index_esm2017_M("FirestoreClient","Using default OfflineComponentProvider"),await index_esm2017_Hc(t,new index_esm2017_Bc)),t.offlineComponents}async function index_esm2017_Xc(t){return t.onlineComponents||(index_esm2017_M("FirestoreClient","Using default OnlineComponentProvider"),await index_esm2017_Jc(t,new index_esm2017_qc)),t.onlineComponents}function index_esm2017_Zc(t){return index_esm2017_Yc(t).then((t=>t.persistence))}function index_esm2017_ta(t){return index_esm2017_Yc(t).then((t=>t.localStore))}function index_esm2017_ea(t){return index_esm2017_Xc(t).then((t=>t.remoteStore))}function index_esm2017_na(t){return index_esm2017_Xc(t).then((t=>t.syncEngine))}async function index_esm2017_sa(t){const e=await index_esm2017_Xc(t),n=e.eventManager;return n.onListen=index_esm2017_uc.bind(null,e.syncEngine),n.onUnlisten=index_esm2017_ac.bind(null,e.syncEngine),n}function index_esm2017_ia(t){return t.asyncQueue.enqueue((async()=>{const e=await index_esm2017_Zc(t),n=await index_esm2017_ea(t);return e.setNetworkEnabled(!0),function(t){const e=index_esm2017_K(t);return e.lu.delete(0),hu(e)}(n)}))}function index_esm2017_ra(t){return t.asyncQueue.enqueue((async()=>{const e=await index_esm2017_Zc(t),n=await index_esm2017_ea(t);return e.setNetworkEnabled(!1),async function(t){const e=index_esm2017_K(t);e.lu.add(0),await lu(e),e._u.set("Offline")}(n)}))}function index_esm2017_oa(t,e){const n=new j;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("read document","readonly",(t=>n.localDocuments.getDocument(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new index_esm2017_Q(G.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=Bu(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await index_esm2017_ta(t),e,n))),n.promise}function index_esm2017_ua(t,e,n={}){const s=new j;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new index_esm2017_Gc({next:r=>{e.enqueueAndForget((()=>ju(t,o)));const u=r.docs.has(n);!u&&r.fromCache?i.reject(new index_esm2017_Q(G.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&r.fromCache&&s&&"server"===s.source?i.reject(new index_esm2017_Q(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Ju(rn(n.path),r,{includeMetadataChanges:!0,Du:!0});return Qu(t,o)}(await index_esm2017_sa(t),t.asyncQueue,e,n,s))),s.promise}function ca(t,e){const n=new j;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await No(t,e,!0),i=new index_esm2017_sc(e,s.ji),r=i.Ku(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){const s=Bu(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await index_esm2017_ta(t),e,n))),n.promise}function index_esm2017_aa(t,e,n={}){const s=new j;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new index_esm2017_Gc({next:n=>{e.enqueueAndForget((()=>ju(t,o))),n.fromCache&&"server"===s.source?i.reject(new index_esm2017_Q(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Ju(n,r,{includeMetadataChanges:!0,Du:!0});return Qu(t,o)}(await index_esm2017_sa(t),t.asyncQueue,e,n,s))),s.promise}function index_esm2017_ha(t,e){const n=new index_esm2017_Gc(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){index_esm2017_K(t).Tu.add(e),e.next()}(await index_esm2017_sa(t),n))),()=>{n.Tc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){index_esm2017_K(t).Tu.delete(e)}(await index_esm2017_sa(t),n)))}}function index_esm2017_la(t,e,n){const s=new j;return t.asyncQueue.enqueueAndForget((async()=>{const i=await function(t){return index_esm2017_Xc(t).then((t=>t.datastore))}(t);new index_esm2017_Wc(t.asyncQueue,i,n,e,s).run()})),s.promise}function index_esm2017_fa(t,e,n,s){const i=function(t,e){let n;n="string"==typeof t?(new TextEncoder).encode(t):t;return function(t,e){return new index_esm2017_Qc(t,e)}(function(t,e){if(t instanceof Uint8Array)return index_esm2017_Kc(t,e);if(t instanceof ArrayBuffer)return index_esm2017_Kc(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(n,nu(e));t.asyncQueue.enqueueAndForget((async()=>{index_esm2017_$c(await index_esm2017_na(t),i,s)}))}function index_esm2017_da(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=index_esm2017_K(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Ds.getNamedQuery(t,e)))}(await index_esm2017_ta(t),e)))}const _a=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function index_esm2017_wa(t,e,n){if(!n)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function index_esm2017_ma(t,e,n,s){if(!0===e&&!0===s)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function ga(t){if(!dt.isDocumentKey(t))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function index_esm2017_ya(t){if(dt.isDocumentKey(t))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function index_esm2017_pa(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor)return t.constructor.name;return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":index_esm2017_L()}function index_esm2017_Ia(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=index_esm2017_pa(t);throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function index_esm2017_Ta(t,e){if(e<=0)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=true}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,index_esm2017_ma("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_Aa{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ea({}),this._settingsFrozen=!1,t instanceof re?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new index_esm2017_Q(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new re(t.options.projectId)}(t))}get app(){if(!this._app)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ea(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new index_esm2017_z;switch(t.type){case"gapi":const e=t.client;return index_esm2017_U(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new index_esm2017_X(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new index_esm2017_Q(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=_a.get(t);e&&(index_esm2017_M("ComponentProvider","Removing Datastore"),_a.delete(t),e.terminate())}(this),Promise.resolve()}}function index_esm2017_Ra(t,e,n,s={}){var i;const r=(t=index_esm2017_Ia(t,index_esm2017_Aa))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&$("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=index_esm2017_C.MOCK_USER;else{e=createMockUserToken(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new index_esm2017_C(r)}t._authCredentials=new index_esm2017_H(new index_esm2017_W(e,n))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_ba{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new index_esm2017_va(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new index_esm2017_ba(this.firestore,t,this._key)}}class index_esm2017_Pa{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new index_esm2017_Pa(this.firestore,t,this._query)}}class index_esm2017_va extends index_esm2017_Pa{constructor(t,e,n){super(t,e,rn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new index_esm2017_ba(this.firestore,null,new dt(t))}withConverter(t){return new index_esm2017_va(this.firestore,t,this._path)}}function index_esm2017_Va(t,e,...n){if(t=(0,dist_index_esm2017.m9)(t),index_esm2017_wa("collection","path",e),t instanceof index_esm2017_Aa){const s=ht.fromString(e,...n);return index_esm2017_ya(s),new index_esm2017_va(t,null,s)}{if(!(t instanceof index_esm2017_ba||t instanceof index_esm2017_va))throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(ht.fromString(e,...n));return index_esm2017_ya(s),new index_esm2017_va(t.firestore,null,s)}}function index_esm2017_Sa(t,e){if(t=index_esm2017_Ia(t,index_esm2017_Aa),index_esm2017_wa("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new index_esm2017_Pa(t,null,function(t){return new nn(ht.emptyPath(),t)}(e))}function Da(t,e,...n){if(t=(0,dist_index_esm2017.m9)(t),1===arguments.length&&(e=st.I()),index_esm2017_wa("doc","path",e),t instanceof index_esm2017_Aa){const s=ht.fromString(e,...n);return ga(s),new index_esm2017_ba(t,null,new dt(s))}{if(!(t instanceof index_esm2017_ba||t instanceof index_esm2017_va))throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(ht.fromString(e,...n));return ga(s),new index_esm2017_ba(t.firestore,t instanceof index_esm2017_va?t.converter:null,new dt(s))}}function index_esm2017_Ca(t,e){return t=getModularInstance(t),e=getModularInstance(e),(t instanceof index_esm2017_ba||t instanceof index_esm2017_va)&&(e instanceof index_esm2017_ba||e instanceof index_esm2017_va)&&(t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter)}function index_esm2017_xa(t,e){return t=getModularInstance(t),e=getModularInstance(e),t instanceof index_esm2017_Pa&&e instanceof index_esm2017_Pa&&(t.firestore===e.firestore&&dn(t._query,e._query)&&t.converter===e.converter)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class index_esm2017_Na{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new su(this,"async_queue_retry"),this.Kc=()=>{const t=eu();t&&index_esm2017_M("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const t=eu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Gc(),this.Qc(t)}enterRestrictedMode(t){if(!this.Fc){this.Fc=!0,this.Uc=t||!1;const e=eu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Kc)}}enqueue(t){if(this.Gc(),this.Fc)return new Promise((()=>{}));const e=new j;return this.Qc((()=>this.Fc&&this.Uc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Mc.push(t),this.jc())))}async jc(){if(0!==this.Mc.length){try{await this.Mc[0](),this.Mc.shift(),this.So.reset()}catch(t){if(!Ct(t))throw t;index_esm2017_M("AsyncQueue","Operation failed with retryable error: "+t)}this.Mc.length>0&&this.So.Io((()=>this.jc()))}}Qc(t){const e=this.Oc.then((()=>(this.Lc=!0,t().catch((t=>{this.Bc=t,this.Lc=!1;const e=function(t){let e=t.message||"";t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack);return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t);throw index_esm2017_F("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Lc=!1,t))))));return this.Oc=e,e}enqueueAfterDelay(t,e,n){this.Gc(),this.qc.indexOf(t)>-1&&(e=0);const s=$u.createAndSchedule(this,t,e,n,(t=>this.Wc(t)));return this.$c.push(s),s}Gc(){this.Bc&&index_esm2017_L()}verifyOperationInProgress(){}async zc(){let t;do{t=this.Oc,await t}while(t!==this.Oc)}Hc(t){for(const e of this.$c)if(e.timerId===t)return!0;return!1}Jc(t){return this.zc().then((()=>{this.$c.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()}))}Yc(t){this.qc.push(t)}Wc(t){const e=this.$c.indexOf(t);this.$c.splice(e,1)}}function index_esm2017_ka(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,["next","error","complete"])}class index_esm2017_Oa{constructor(){this._progressObserver={},this._taskCompletionResolver=new j,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const index_esm2017_Ma=null&&-1;class index_esm2017_Fa extends index_esm2017_Aa{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new index_esm2017_Na,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||index_esm2017_Ua(this),this._firestoreClient.terminate()}}function index_esm2017_$a(t,e){const n=_getProvider(t,"firestore");if(n.isInitialized()){const t=n.getImmediate(),s=n.getOptions();if(deepEqual(s,e))return t;throw new index_esm2017_Q(G.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e})}function Ba(e=(0,index_esm2017.Mq)()){return(0,index_esm2017.qX)(e,"firestore").getImmediate()}function index_esm2017_La(t){return t._firestoreClient||index_esm2017_Ua(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function index_esm2017_Ua(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new ie(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new index_esm2017_zc(t._authCredentials,t._appCheckCredentials,t._queue,s)}function index_esm2017_qa(t,e){index_esm2017_Xa(t=index_esm2017_Ia(t,index_esm2017_Fa));const n=index_esm2017_La(t),s=t._freezeSettings(),i=new index_esm2017_qc;return index_esm2017_Ga(n,i,new index_esm2017_Lc(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function index_esm2017_Ka(t){index_esm2017_Xa(t=index_esm2017_Ia(t,index_esm2017_Fa));const e=index_esm2017_La(t),n=t._freezeSettings(),s=new index_esm2017_qc;return index_esm2017_Ga(e,s,new index_esm2017_Uc(s,n.cacheSizeBytes))}function index_esm2017_Ga(t,e,n){const s=new j;return t.asyncQueue.enqueue((async()=>{try{await index_esm2017_Hc(t,n),await index_esm2017_Jc(t,e),s.resolve()}catch(t){const e=t;if(!function(t){if("FirebaseError"===t.name)return t.code===G.FAILED_PRECONDITION||t.code===G.UNIMPLEMENTED;if("undefined"!=typeof DOMException&&t instanceof DOMException)return 22===t.code||20===t.code||11===t.code;return!0}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e)}})).then((()=>s.promise))}function index_esm2017_Qa(t){if(t._initialized&&!t._terminated)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new j;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Vt.V())return Promise.resolve();const e=t+"main";await Vt.delete(e)}(Io(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function index_esm2017_ja(t){return function(t){const e=new j;return t.asyncQueue.enqueueAndForget((async()=>index_esm2017_mc(await index_esm2017_na(t),e))),e.promise}(index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)))}function index_esm2017_Wa(t){return index_esm2017_ia(index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)))}function index_esm2017_za(t){return index_esm2017_ra(index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)))}function index_esm2017_Ha(t){return _removeServiceInstance(t.app,"firestore"),t._delete()}function index_esm2017_Ja(t,e){const n=index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)),s=new index_esm2017_Oa;return index_esm2017_fa(n,t._databaseId,e,s),s}function index_esm2017_Ya(t,e){return index_esm2017_da(index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)),e).then((e=>e?new index_esm2017_Pa(t,null,e.query):null))}function index_esm2017_Xa(t){if(t._initialized||t._terminated)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class index_esm2017_Za{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ft(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function th(){return new index_esm2017_Za("__name__")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh{constructor(t){this._byteString=t}static fromBase64String(t){try{return new eh(Jt.fromBase64String(t))}catch(t){throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new eh(Jt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(t){this._methodName=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sh{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return it(this._lat,t._lat)||it(this._long,t._long)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ih=/^__.*__$/;class rh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Wn(t,this.data,this.fieldMask,e,this.fieldTransforms):new jn(t,this.data,e,this.fieldTransforms)}}class oh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Wn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function uh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw index_esm2017_L()}}class ch{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.wt=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Xc(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(t){return new ch(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.ta({path:n,na:!1});return s.sa(t),s}ia(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.ta({path:n,na:!1});return s.Xc(),s}ra(t){return this.ta({path:void 0,na:!0})}oa(t){return Vh(t,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.sa(this.path.get(t))}sa(t){if(0===t.length)throw this.oa("Document fields must not be empty");if(uh(this.Zc)&&ih.test(t))throw this.oa('Document fields cannot begin and end with "__"')}}class ah{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.wt=n||nu(t)}aa(t,e,n,s=!1){return new ch({Zc:t,methodName:e,ca:n,path:ft.emptyPath(),na:!1,ua:s},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function hh(t){const e=t._freezeSettings(),n=nu(t._databaseId);return new ah(t._databaseId,!!e.ignoreUndefinedProperties,n)}function lh(t,e,n,s,i,r={}){const o=t.aa(r.merge||r.mergeFields?2:0,e,n,i);Rh("Data must be an object, but it was:",o,s);const u=Eh(s,o);let c,a;if(r.merge)c=new zt(o.fieldMask),a=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=bh(e,s,n);if(!o.contains(i))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Sh(t,i)||t.push(i)}c=new zt(t),a=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,a=o.fieldTransforms;return new rh(new De(u),c,a)}class fh extends nh{_toFieldTransform(t){if(2!==t.Zc)throw 1===t.Zc?t.oa(`${this._methodName}() can only appear at the top level of your update data`):t.oa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof fh}}function dh(t,e,n){return new ch({Zc:3,ca:e.settings.ca,methodName:t._methodName,na:n},e.databaseId,e.wt,e.ignoreUndefinedProperties)}class _h extends(null&&nh){_toFieldTransform(t){return new On(t.path,new vn)}isEqual(t){return t instanceof _h}}class wh extends(null&&nh){constructor(t,e){super(t),this.ha=e}_toFieldTransform(t){const e=dh(this,t,!0),n=this.ha.map((t=>Th(t,e))),s=new Vn(n);return new On(t.path,s)}isEqual(t){return this===t}}class mh extends(null&&nh){constructor(t,e){super(t),this.ha=e}_toFieldTransform(t){const e=dh(this,t,!0),n=this.ha.map((t=>Th(t,e))),s=new Dn(n);return new On(t.path,s)}isEqual(t){return this===t}}class gh extends(null&&nh){constructor(t,e){super(t),this.la=e}_toFieldTransform(t){const e=new xn(t.wt,En(t.wt,this.la));return new On(t.path,e)}isEqual(t){return this===t}}function yh(t,e,n,s){const i=t.aa(1,e,n);Rh("Data must be an object, but it was:",i,s);const r=[],o=De.empty();Lt(s,((t,s)=>{const u=vh(e,t,n);s=(0,dist_index_esm2017.m9)(s);const c=i.ia(u);if(s instanceof fh)r.push(u);else{const t=Th(s,c);null!=t&&(r.push(u),o.set(u,t))}}));const u=new zt(r);return new oh(o,u,i.fieldTransforms)}function ph(t,e,n,s,i,r){const o=t.aa(1,e,n),u=[bh(e,s,n)],c=[i];if(r.length%2!=0)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)u.push(bh(e,r[t])),c.push(r[t+1]);const a=[],h=De.empty();for(let t=u.length-1;t>=0;--t)if(!Sh(a,u[t])){const e=u[t];let n=c[t];n=(0,dist_index_esm2017.m9)(n);const s=o.ia(e);if(n instanceof fh)a.push(e);else{const t=Th(n,s);null!=t&&(a.push(e),h.set(e,t))}}const l=new zt(a);return new oh(h,l,o.fieldTransforms)}function Ih(t,e,n,s=!1){return Th(n,t.aa(s?4:3,e))}function Th(t,e){if(Ah(t=(0,dist_index_esm2017.m9)(t)))return Rh("Unsupported field value:",e,t),Eh(t,e);if(t instanceof nh)return function(t,e){if(!uh(e.Zc))throw e.oa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.oa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.na&&4!==e.Zc)throw e.oa("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Th(i,e.ra(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,dist_index_esm2017.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return En(e.wt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ut.fromDate(t);return{timestampValue:Ds(e.wt,n)}}if(t instanceof ut){const n=new ut(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ds(e.wt,n)}}if(t instanceof sh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof eh)return{bytesValue:Cs(e.wt,t._byteString)};if(t instanceof index_esm2017_ba){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.oa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ks(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.oa(`Unsupported field value: ${index_esm2017_pa(t)}`)}(t,e)}function Eh(t,e){const n={};return Ut(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Lt(t,((t,s)=>{const i=Th(s,e.ea(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ah(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ut||t instanceof sh||t instanceof eh||t instanceof index_esm2017_ba||t instanceof nh)}function Rh(t,e,n){if(!Ah(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=index_esm2017_pa(n);throw"an object"===s?e.oa(t+" a custom object"):e.oa(t+" "+s)}}function bh(t,e,n){if((e=(0,dist_index_esm2017.m9)(e))instanceof index_esm2017_Za)return e._internalPath;if("string"==typeof e)return vh(t,e);throw Vh("Field path arguments must be of type string or ",t,!1,void 0,n)}const Ph=new RegExp("[~\\*/\\[\\]]");function vh(t,e,n){if(e.search(Ph)>=0)throw Vh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new index_esm2017_Za(...e.split("."))._internalPath}catch(s){throw Vh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Vh(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new index_esm2017_Q(G.INVALID_ARGUMENT,u+t+c)}function Sh(t,e){return t.some((t=>t.isEqual(e)))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new index_esm2017_ba(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Ch(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(xh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Ch extends Dh{data(){return super.data()}}function xh(t,e){return"string"==typeof e?vh(t,e):e instanceof index_esm2017_Za?e._internalPath:e._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class kh extends Dh{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Oh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(xh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Oh extends kh{data(t={}){return super.data(t)}}class Mh{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Nh(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Oh(this._firestore,this._userDataWriter,n.key,n,new Nh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Oh(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Nh(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Oh(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nh(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Fh(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Fh(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return index_esm2017_L()}}function $h(t,e){return t instanceof kh&&e instanceof kh?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Mh&&e instanceof Mh&&(t._firestore===e._firestore&&index_esm2017_xa(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new index_esm2017_Q(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Lh{}function Uh(t,...e){for(const n of e)t=n._apply(t);return t}class qh extends Lh{constructor(t,e,n){super(),this.fa=t,this.da=e,this._a=n,this.type="where"}_apply(t){const e=hh(t.firestore),n=function(t,e,n,s,i,r,o){let u;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){sl(o,r);const e=[];for(const n of o)e.push(nl(s,t,n));u={arrayValue:{values:e}}}else u=nl(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||sl(o,r),u=Ih(n,e,o,"in"===r||"not-in"===r);const c=qe.create(i,r,u);return function(t,e){if(e.ht()){const n=cn(t);if(null!==n&&!n.isEqual(e.field))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=un(t);null!==s&&il(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,"where",e,t.firestore._databaseId,this.fa,this.da,this._a);return new index_esm2017_Pa(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Kh(t,e,n){const s=e,i=xh("where",t);return new qh(i,s,n)}class Gh extends Lh{constructor(t,e){super(),this.fa=t,this.wa=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Xe(e,n);return function(t,e){if(null===un(t)){const n=cn(t);null!==n&&il(t,n,e.field)}}(t,s),s}(t._query,this.fa,this.wa);return new index_esm2017_Pa(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new nn(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Qh(t,e="asc"){const n=e,s=xh("orderBy",t);return new Gh(s,n)}class jh extends Lh{constructor(t,e,n){super(),this.type=t,this.ma=e,this.ga=n}_apply(t){return new index_esm2017_Pa(t.firestore,t.converter,fn(t._query,this.ma,this.ga))}}function Wh(t){return index_esm2017_Ta("limit",t),new jh("limit",t,"F")}function zh(t){return index_esm2017_Ta("limitToLast",t),new jh("limitToLast",t,"L")}class Hh extends Lh{constructor(t,e,n){super(),this.type=t,this.ya=e,this.pa=n}_apply(t){const e=el(t,this.type,this.ya,this.pa);return new index_esm2017_Pa(t.firestore,t.converter,function(t,e){return new nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function Jh(...t){return new Hh("startAt",t,!0)}function Yh(...t){return new Hh("startAfter",t,!1)}class Xh extends(null&&Lh){constructor(t,e,n){super(),this.type=t,this.ya=e,this.pa=n}_apply(t){const e=el(t,this.type,this.ya,this.pa);return new index_esm2017_Pa(t.firestore,t.converter,function(t,e){return new nn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Zh(...t){return new Xh("endBefore",t,!1)}function tl(...t){return new Xh("endAt",t,!0)}function el(t,e,n,s){if(n[0]=(0,dist_index_esm2017.m9)(n[0]),n[0]instanceof Dh)return function(t,e,n,s,i){if(!s)throw new index_esm2017_Q(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of hn(t))if(n.field.isKeyField())r.push(ye(e,s.key));else{const t=s.data.field(n.field);if(ee(t))throw new index_esm2017_Q(G.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new Ye(r,i)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=hh(t.firestore);return function(t,e,n,s,i,r){const o=t.explicitOrderBy;if(i.length>o.length)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const u=[];for(let r=0;r<i.length;r++){const c=i[r];if(o[r].field.isKeyField()){if("string"!=typeof c)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof c}`);if(!an(t)&&-1!==c.indexOf("/"))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(ht.fromString(c));if(!dt.isDocumentKey(n))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new dt(n);u.push(ye(e,i))}else{const t=Ih(n,s,c);u.push(t)}}return new Ye(u,r)}(t._query,t.firestore._databaseId,i,e,n,s)}}function nl(t,e,n){if("string"==typeof(n=(0,dist_index_esm2017.m9)(n))){if(""===n)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!an(e)&&-1!==n.indexOf("/"))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(ht.fromString(n));if(!dt.isDocumentKey(s))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return ye(t,new dt(s))}if(n instanceof index_esm2017_ba)return ye(t,n._key);throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${index_esm2017_pa(n)}.`)}function sl(t,e){if(!Array.isArray(t)||0===t.length)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function il(t,e,n){if(!n.isEqual(e))throw new index_esm2017_Q(G.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl={maxAttempts:5};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{convertValue(t,e="none"){switch(le(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Zt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(te(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw index_esm2017_L()}}convertObject(t,e){const n={};return Lt(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new sh(Zt(t.latitude),Zt(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ne(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(se(t));default:return null}}convertTimestamp(t){const e=Xt(t);return new ut(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ht.fromString(t);index_esm2017_U(ui(n));const s=new re(n.get(1),n.get(3)),i=new dt(n.popFirst(5));return s.isEqual(e)||index_esm2017_F(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ul(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class cl extends(null&&ol){constructor(t){super(),this.firestore=t}convertBytes(t){return new eh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new index_esm2017_ba(this.firestore,null,e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=hh(t)}set(t,e,n){this._verifyNotCommitted();const s=hl(t,this._firestore),i=ul(s.converter,e,n),r=lh(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,$n.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=hl(t,this._firestore);let r;return r="string"==typeof(e=getModularInstance(e))||e instanceof index_esm2017_Za?ph(this._dataReader,"WriteBatch.update",i._key,e,n,s):yh(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(r.toMutation(i._key,$n.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=hl(t,this._firestore);return this._mutations=this._mutations.concat(new Yn(e._key,$n.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new index_esm2017_Q(G.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hl(t,e){if((t=getModularInstance(t)).firestore!==e)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(t){t=index_esm2017_Ia(t,index_esm2017_ba);const e=index_esm2017_Ia(t.firestore,index_esm2017_Fa);return index_esm2017_ua(index_esm2017_La(e),t._key).then((n=>bl(e,t,n)))}class fl extends ol{constructor(t){super(),this.firestore=t}convertBytes(t){return new eh(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new index_esm2017_ba(this.firestore,null,e)}}function dl(t){t=index_esm2017_Ia(t,index_esm2017_ba);const e=index_esm2017_Ia(t.firestore,index_esm2017_Fa),n=index_esm2017_La(e),s=new fl(e);return index_esm2017_oa(n,t._key).then((n=>new kh(e,s,t._key,n,new Nh(null!==n&&n.hasLocalMutations,!0),t.converter)))}function _l(t){t=index_esm2017_Ia(t,index_esm2017_ba);const e=index_esm2017_Ia(t.firestore,index_esm2017_Fa);return index_esm2017_ua(index_esm2017_La(e),t._key,{source:"server"}).then((n=>bl(e,t,n)))}function wl(t){t=index_esm2017_Ia(t,index_esm2017_Pa);const e=index_esm2017_Ia(t.firestore,index_esm2017_Fa),n=index_esm2017_La(e),s=new fl(e);return Bh(t._query),index_esm2017_aa(n,t._query).then((n=>new Mh(e,s,t,n)))}function ml(t){t=index_esm2017_Ia(t,index_esm2017_Pa);const e=index_esm2017_Ia(t.firestore,index_esm2017_Fa),n=index_esm2017_La(e),s=new fl(e);return ca(n,t._query).then((n=>new Mh(e,s,t,n)))}function gl(t){t=index_esm2017_Ia(t,index_esm2017_Pa);const e=index_esm2017_Ia(t.firestore,index_esm2017_Fa),n=index_esm2017_La(e),s=new fl(e);return index_esm2017_aa(n,t._query,{source:"server"}).then((n=>new Mh(e,s,t,n)))}function yl(t,e,n){t=index_esm2017_Ia(t,index_esm2017_ba);const s=index_esm2017_Ia(t.firestore,index_esm2017_Fa),i=ul(t.converter,e,n);return Rl(s,[lh(hh(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,$n.none())])}function pl(t,e,n,...s){t=index_esm2017_Ia(t,index_esm2017_ba);const i=index_esm2017_Ia(t.firestore,index_esm2017_Fa),r=hh(i);let o;o="string"==typeof(e=(0,dist_index_esm2017.m9)(e))||e instanceof index_esm2017_Za?ph(r,"updateDoc",t._key,e,n,s):yh(r,"updateDoc",t._key,e);return Rl(i,[o.toMutation(t._key,$n.exists(!0))])}function Il(t){return Rl(index_esm2017_Ia(t.firestore,index_esm2017_Fa),[new Yn(t._key,$n.none())])}function Tl(t,e){const n=index_esm2017_Ia(t.firestore,index_esm2017_Fa),s=Da(t),i=ul(t.converter,e);return Rl(n,[lh(hh(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,$n.exists(!1))]).then((()=>s))}function El(t,...e){var n,s,i;t=(0,dist_index_esm2017.m9)(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||index_esm2017_ka(e[o])||(r=e[o],o++);const u={includeMetadataChanges:r.includeMetadataChanges};if(index_esm2017_ka(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,a,h;if(t instanceof index_esm2017_ba)a=index_esm2017_Ia(t.firestore,index_esm2017_Fa),h=rn(t._key.path),c={next:n=>{e[o]&&e[o](bl(a,t,n))},error:e[o+1],complete:e[o+2]};else{const n=index_esm2017_Ia(t,index_esm2017_Pa);a=index_esm2017_Ia(n.firestore,index_esm2017_Fa),h=n._query;const s=new fl(a);c={next:t=>{e[o]&&e[o](new Mh(a,s,n,t))},error:e[o+1],complete:e[o+2]},Bh(t._query)}return function(t,e,n,s){const i=new index_esm2017_Gc(s),r=new Ju(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>Qu(await index_esm2017_sa(t),r))),()=>{i.Tc(),t.asyncQueue.enqueueAndForget((async()=>ju(await index_esm2017_sa(t),r)))}}(index_esm2017_La(a),h,u,c)}function Al(t,e){return index_esm2017_ha(index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)),index_esm2017_ka(e)?e:{next:e})}function Rl(t,e){return function(t,e){const n=new j;return t.asyncQueue.enqueueAndForget((async()=>index_esm2017_hc(await index_esm2017_na(t),e,n))),n.promise}(index_esm2017_La(t),e)}function bl(t,e,n){const s=n.docs.get(e._key),i=new fl(t);return new kh(t,i,e._key,s,new Nh(n.hasPendingWrites,n.fromCache),e.converter)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl extends(null&&class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=hh(t)}get(t){const e=hl(t,this._firestore),n=new cl(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return index_esm2017_L();const s=t[0];if(s.isFoundDocument())return new Dh(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new Dh(this._firestore,n,e._key,null,e.converter);throw index_esm2017_L()}))}set(t,e,n){const s=hl(t,this._firestore),i=ul(s.converter,e,n),r=lh(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(t,e,n,...s){const i=hl(t,this._firestore);let r;return r="string"==typeof(e=getModularInstance(e))||e instanceof index_esm2017_Za?ph(this._dataReader,"Transaction.update",i._key,e,n,s):yh(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,r),this}delete(t){const e=hl(t,this._firestore);return this._transaction.delete(e._key),this}}){constructor(t,e){super(t,e),this._firestore=t}get(t){const e=hl(t,this._firestore),n=new fl(this._firestore);return super.get(t).then((t=>new kh(this._firestore,n,e._key,t._document,new Nh(!1,!1),e.converter)))}}function vl(t,e,n){t=index_esm2017_Ia(t,index_esm2017_Fa);const s=Object.assign(Object.assign({},rl),n);!function(t){if(t.maxAttempts<1)throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Max attempts must be at least 1")}(s);return index_esm2017_la(index_esm2017_La(t),(n=>e(new Pl(t,n))),s)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(){return new fh("deleteField")}function Sl(){return new _h("serverTimestamp")}function Dl(...t){return new wh("arrayUnion",t)}function Cl(...t){return new mh("arrayRemove",t)}function xl(t){return new gh("increment",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nl(t){return index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa)),new al(t,(e=>Rl(t,e)))
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}function kl(t,e){index_esm2017_La(t=index_esm2017_Ia(t,index_esm2017_Fa));const n="string"==typeof e?function(t){var e;try{return JSON.parse(t)}catch(t){throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Failed to parse JSON:"+(null===(e=t)||void 0===e?void 0:e.message))}}(e):e,s=[];if(Array.isArray(n.indexes))for(const t of n.indexes){const e=Ol(t,"collectionGroup"),n=[];if(Array.isArray(t.fields))for(const e of t.fields){const t=vh("setIndexConfiguration",Ol(e,"fieldPath"));"CONTAINS"===e.arrayConfig?n.push(new gt(t,2)):"ASCENDING"===e.order?n.push(new gt(t,0)):"DESCENDING"===e.order&&n.push(new gt(t,1))}s.push(new _t(_t.UNKNOWN_ID,e,n,yt.empty()))}return Promise.resolve()}function Ol(t,e){if("string"!=typeof t[e])throw new index_esm2017_Q(G.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}!function(t,e=!0){!function(t){index_esm2017_x=t}(index_esm2017.Jn),(0,index_esm2017.Xd)(new esm_index_esm2017.wA("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),i=new index_esm2017_Fa(s,new index_esm2017_J(t.getProvider("auth-internal")),new tt(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),i._setSettings(n),i}),"PUBLIC")),(0,index_esm2017.KN)(index_esm2017_D,"3.4.11",t),(0,index_esm2017.KN)(index_esm2017_D,"3.4.11","esm2017")}();var auth=__webpack_require__(74874);var lib=__webpack_require__(75958);var store=__webpack_require__(7280);var FirebaseRepository=function(){function FirebaseRepository(attributes){(0,classCallCheck.Z)(this,FirebaseRepository);(0,defineProperty.Z)(this,"instance",void 0);(0,defineProperty.Z)(this,"firestore",void 0);(0,defineProperty.Z)(this,"collection",void 0);(0,defineProperty.Z)(this,"snapshot",void 0);(0,defineProperty.Z)(this,"model",null);this.instance=firebase.ZP;this.firestore=Ba();this.collection=index_esm2017_Va(this.firestore,attributes.collectionName)}(0,createClass.Z)(FirebaseRepository,[{key:"casting",value:function(){var _casting=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(data){return regenerator_default().wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt("return",this.model?new this.model(data):null);case 1:case"end":return _context.stop()}}}),_callee,this)})));function casting(_x){return _casting.apply(this,arguments)}return casting}()},{key:"_castData",value:function(){var _castData2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee3(querySnapshot){var _this=this;return regenerator_default().wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Promise.all(querySnapshot.docs.map(function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee2(doc){return regenerator_default().wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _this.casting(doc.data());case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop()}}}),_callee2)})));return function(_x3){return _ref.apply(this,arguments)}}()));case 2:return _context3.abrupt("return",_context3.sent);case 3:case"end":return _context3.stop()}}}),_callee3)})));function _castData(_x2){return _castData2.apply(this,arguments)}return _castData}()},{key:"all",value:function all(){this.snapshot=Uh(this.collection);return this}},{key:"where",value:function where(column,value){var operator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"==";return this.whereSnapshot(column,value,operator)}},{key:"whereSnapshot",value:function whereSnapshot(column,value){var _this$snapshot;var operator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"==";this.snapshot=Uh((_this$snapshot=this.snapshot)!==null&&_this$snapshot!==void 0?_this$snapshot:this.collection,Kh(column,operator,value));return this}},{key:"findOneById",value:function(){var _findOneById=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee4(id){return regenerator_default().wrap((function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",this.doc(id));case 1:case"end":return _context4.stop()}}}),_callee4,this)})));function findOneById(_x4){return _findOneById.apply(this,arguments)}return findOneById}()},{key:"documentReference",value:function documentReference(docID){if(docID.trim()==="")return null;return Da(this.firestore,this.collection.path,docID)}},{key:"doc",value:function(){var _doc=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee6(docID){var _this2=this;var cast,_args6=arguments;return regenerator_default().wrap((function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:cast=_args6.length>1&&_args6[1]!==undefined?_args6[1]:true;if(!(docID.trim()==="")){_context6.next=3;break}return _context6.abrupt("return",null);case 3:return _context6.abrupt("return",new Promise(function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee5(resolve,reject){var documentData;return regenerator_default().wrap((function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return ll(_this2.documentReference(docID)).catch((function(error){return reject(FirebaseRepository.verifyLogin(error))}));case 2:documentData=_context5.sent;if(!(documentData instanceof kh)){_context5.next=21;break}if(!documentData.exists()){_context5.next=17;break}_context5.t1=resolve;if(!cast){_context5.next=12;break}_context5.next=9;return _this2.casting(documentData.data());case 9:_context5.t2=_context5.sent;_context5.next=13;break;case 12:_context5.t2=documentData;case 13:_context5.t3=_context5.t2;_context5.t0=(0,_context5.t1)(_context5.t3);_context5.next=18;break;case 17:_context5.t0=resolve(null);case 18:return _context5.abrupt("return",_context5.t0);case 21:reject(null);case 22:case"end":return _context5.stop()}}}),_callee5)})));return function(_x6,_x7){return _ref2.apply(this,arguments)}}()));case 4:case"end":return _context6.stop()}}}),_callee6)})));function doc(_x5){return _doc.apply(this,arguments)}return doc}()},{key:"orderBy",value:function orderBy(fieldPath,directionStr){var _this$snapshot2;this.snapshot=Uh((_this$snapshot2=this.snapshot)!==null&&_this$snapshot2!==void 0?_this$snapshot2:this.collection,Qh(fieldPath,directionStr));return this}},{key:"get",value:function(){var _get=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee8(snapshot){var _this3=this;return regenerator_default().wrap((function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:return _context8.abrupt("return",new Promise((function(resolve,reject){if(!_this3.snapshot){return reject(null)}var _query=_this3.snapshot;wl(_query).then(function(){var _ref3=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee7(querySnapshot){return regenerator_default().wrap((function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_this3.snapshot=null;_context7.t0=resolve;_context7.next=4;return _this3._castData(querySnapshot);case 4:_context7.t1=_context7.sent;(0,_context7.t0)(_context7.t1);case 6:case"end":return _context7.stop()}}}),_callee7)})));return function(_x9){return _ref3.apply(this,arguments)}}()).catch((function(error){return reject(FirebaseRepository.verifyLogin(error))})).finally((function(){return _this3.snapshot=null}))})));case 1:case"end":return _context8.stop()}}}),_callee8)})));function get(_x8){return _get.apply(this,arguments)}return get}()},{key:"snapshots",value:function(){var _snapshots=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee10(callback){var _this4=this;return regenerator_default().wrap((function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:return _context10.abrupt("return",new Promise((function(resolve,reject){if(!_this4.snapshot){return reject(null)}var _query=_this4.snapshot;El(_query,function(){var _ref4=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee9(querySnapshot){var results;return regenerator_default().wrap((function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_this4.snapshot=null;_context9.next=3;return _this4._castData(querySnapshot);case 3:results=_context9.sent;if(callback){callback(results)}return _context9.abrupt("return",resolve(results));case 6:case"end":return _context9.stop()}}}),_callee9)})));return function(_x11){return _ref4.apply(this,arguments)}}(),(function(error){return reject(FirebaseRepository.verifyLogin(error))}),(function(){return _this4.snapshot=null}))})));case 1:case"end":return _context10.stop()}}}),_callee10)})));function snapshots(_x10){return _snapshots.apply(this,arguments)}return snapshots}()},{key:"update",value:function(){var _update=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee11(docID,data){var force,documentReference,_args11=arguments;return regenerator_default().wrap((function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:force=_args11.length>2&&_args11[2]!==undefined?_args11[2]:false;if(!(docID.trim()==="")){_context11.next=3;break}return _context11.abrupt("return",null);case 3:documentReference=this.documentReference(docID);if(!documentReference){_context11.next=14;break}data.updatedAt=FirebaseRepository._now();delete data.createdAt;if(!force){_context11.next=12;break}_context11.next=10;return yl(documentReference,data);case 10:_context11.next=14;break;case 12:_context11.next=14;return pl(documentReference,data);case 14:return _context11.abrupt("return",this.doc(docID));case 15:case"end":return _context11.stop()}}}),_callee11,this)})));function update(_x12,_x13){return _update.apply(this,arguments)}return update}()},{key:"count",value:function(){var _count=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee12(_where){var _limit,count,_query,snapshot;return regenerator_default().wrap((function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_limit=100;count=0;_query=_where?Uh(this.collection,_where,Qh("id","desc"),Wh(_limit)):Uh(this.collection,Qh("id","desc"),Wh(_limit));_context12.next=5;return wl(_query);case 5:snapshot=_context12.sent;if(!(snapshot.docs!=null)){_context12.next=14;break}case 7:if(!(snapshot.size>0&&!snapshot.empty)){_context12.next=14;break}count+=snapshot.size;_context12.next=11;return wl(Uh(_query,Yh(snapshot.docs[snapshot.size-1])));case 11:snapshot=_context12.sent;_context12.next=7;break;case 14:return _context12.abrupt("return",count);case 15:case"end":return _context12.stop()}}}),_callee12,this)})));function count(_x14){return _count.apply(this,arguments)}return count}()}],[{key:"verifyLogin",value:function verifyLogin(error){if(error.code==="permission-denied"){lib["default"]["delete"](store.Z.getters.TOKEN_NAME);return auth.uX.login.view()}else{return error}}},{key:"_now",value:function _now(){return ut.now().toDate()}}]);return FirebaseRepository}();var UserRepository=function(_FirebaseRepository){(0,inherits.Z)(UserRepository,_FirebaseRepository);var _super=(0,createSuper.Z)(UserRepository);function UserRepository(){var _this;(0,classCallCheck.Z)(this,UserRepository);_this=_super.call(this,{collectionName:User.collection});(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"model",void 0);_this.model=User;return _this}return(0,createClass.Z)(UserRepository)}(FirebaseRepository);var userRepository=new UserRepository;var member=__webpack_require__(73945);var Member=function(_MainMember){(0,inherits.Z)(Member,_MainMember);var _super=(0,createSuper.Z)(Member);function Member(){(0,classCallCheck.Z)(this,Member);return _super.apply(this,arguments)}return(0,createClass.Z)(Member)}(member.Z);(0,defineProperty.Z)(Member,"collection","members");var MemberRepository=function(_FirebaseRepository){(0,inherits.Z)(MemberRepository,_FirebaseRepository);var _super=(0,createSuper.Z)(MemberRepository);function MemberRepository(){var _this;(0,classCallCheck.Z)(this,MemberRepository);_this=_super.call(this,{collectionName:Member.collection});(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"model",void 0);_this.model=Member;return _this}(0,createClass.Z)(MemberRepository,[{key:"countPremium",value:function countPremium(){return this.count(Kh("premium","==",true))}}]);return MemberRepository}(FirebaseRepository);var memberRepository=new MemberRepository;var memberCount=function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){return regenerator_default().wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return memberRepository.count();case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}}),_callee)})));return function memberCount(){return _ref.apply(this,arguments)}}();var memberPremiumCount=function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee2(){var test;return regenerator_default().wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return memberRepository.countPremium();case 2:test=_context2.sent;console.log(test);return _context2.abrupt("return",test);case 5:case"end":return _context2.stop()}}}),_callee2)})));return function memberPremiumCount(){return _ref2.apply(this,arguments)}}();var partner=__webpack_require__(15891);var Partner=function(_MainPartner){(0,inherits.Z)(Partner,_MainPartner);var _super=(0,createSuper.Z)(Partner);function Partner(){(0,classCallCheck.Z)(this,Partner);return _super.apply(this,arguments)}return(0,createClass.Z)(Partner)}(partner.Z);(0,defineProperty.Z)(Partner,"collection","partners");var PartnerRepository=function(_FirebaseRepository){(0,inherits.Z)(PartnerRepository,_FirebaseRepository);var _super=(0,createSuper.Z)(PartnerRepository);function PartnerRepository(){var _this;(0,classCallCheck.Z)(this,PartnerRepository);_this=_super.call(this,{collectionName:Partner.collection});(0,defineProperty.Z)((0,assertThisInitialized.Z)(_this),"model",void 0);_this.model=Partner;return _this}return(0,createClass.Z)(PartnerRepository)}(FirebaseRepository);var partnerRepository=new PartnerRepository;var partnerCount=function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){return regenerator_default().wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return partnerRepository.count();case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}}),_callee)})));return function partnerCount(){return _ref.apply(this,arguments)}}();var useFirebaseUser=function useFirebaseUser(){var state=(0,reactivity_esm_bundler.qj)({userCount:(0,reactivity_esm_bundler.iH)(null),memberCount:(0,reactivity_esm_bundler.iH)(null),memberPremiumCount:(0,reactivity_esm_bundler.iH)(null),partnerCount:(0,reactivity_esm_bundler.iH)(null)});var countUser=function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){return regenerator_default().wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return userRepository.count();case 2:return _context.abrupt("return",state.userCount=_context.sent);case 3:case"end":return _context.stop()}}}),_callee)})));return function countUser(){return _ref.apply(this,arguments)}}();var countMember=function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee2(){return regenerator_default().wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return memberCount();case 2:return _context2.abrupt("return",state.memberCount=_context2.sent);case 3:case"end":return _context2.stop()}}}),_callee2)})));return function countMember(){return _ref2.apply(this,arguments)}}();var countPremiumMember=function(){var _ref3=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee3(){return regenerator_default().wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return memberPremiumCount();case 2:return _context3.abrupt("return",state.memberPremiumCount=_context3.sent);case 3:case"end":return _context3.stop()}}}),_callee3)})));return function countPremiumMember(){return _ref3.apply(this,arguments)}}();var countPartner=function(){var _ref4=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee4(){return regenerator_default().wrap((function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return partnerCount();case 2:return _context4.abrupt("return",state.partnerCount=_context4.sent);case 3:case"end":return _context4.stop()}}}),_callee4)})));return function countPartner(){return _ref4.apply(this,arguments)}}();var countAll=function(){var _ref5=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee5(){return regenerator_default().wrap((function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return countUser();case 2:_context5.next=4;return countMember();case 4:_context5.next=6;return countPartner();case 6:_context5.next=8;return countPremiumMember();case 8:case"end":return _context5.stop()}}}),_callee5)})));return function countAll(){return _ref5.apply(this,arguments)}}();var countItems=(0,runtime_core_esm_bundler.Fl)((function(){return[{count:state.userCount,label:"Utilisateurs inscrits"},{count:state.memberCount,label:"Adhérents inscrits"},{count:state.memberPremiumCount,label:"Adhérents premiums"},{count:state.partnerCount,label:"Partenaires inscrits"}]}));return(0,objectSpread2.Z)((0,objectSpread2.Z)({},(0,reactivity_esm_bundler.BK)(state)),{},{countItems:countItems,countAll:countAll})};var count_item=__webpack_require__(92902);var componentsvue_type_script_lang_js=(0,runtime_core_esm_bundler.aZ)({name:"home-index",components:{CountItem:count_item["default"],Logo:logo.Z},metaInfo:{title:"Accueil"},setup:function setup(){var _useFirebaseUser=useFirebaseUser(),countItems=_useFirebaseUser.countItems,countAll=_useFirebaseUser.countAll;(0,runtime_core_esm_bundler.bv)((0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){return regenerator_default().wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return countAll();case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}}),_callee)}))));return{countItems:countItems}}});var exportHelper=__webpack_require__(83744);const __exports__=(0,exportHelper.Z)(componentsvue_type_script_lang_js,[["render",render],["__scopeId","data-v-ce3ef3b8"]]);var components=__exports__}}]);