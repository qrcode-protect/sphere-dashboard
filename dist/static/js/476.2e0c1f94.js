"use strict";(self["webpackChunksphere_dashboard"]=self["webpackChunksphere_dashboard"]||[]).push([[476,7305],{37670:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{c:function(){return useForm}});var _mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(95082);var vue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2262);var _app_commons_validation__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(81909);var useForm=function useForm(){var state=(0,vue__WEBPACK_IMPORTED_MODULE_1__.qj)({error:null,success:null,errors:[],loading:false});var validator=function validator(data){var _result$errors;var result=(0,_app_commons_validation__WEBPACK_IMPORTED_MODULE_0__.sC)(data);state.errors=(_result$errors=result.errors)!==null&&_result$errors!==void 0?_result$errors:[];state.error=result.error;return result.valid};var setLoading=function setLoading(value){return state.loading=value};var setError=function setError(value){return state.error=value};var setSuccess=function setSuccess(value){return state.success=value};return(0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__.Z)((0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_2__.Z)({},(0,vue__WEBPACK_IMPORTED_MODULE_1__.BK)(state)),{},{validator:validator,setLoading:setLoading,setError:setError,setSuccess:setSuccess})}},72903:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{DT:function(){return useTenderForm},iv:function(){return useTenders},zd:function(){return useTender}});var _mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(95082);var vue__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2262);var vue__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(66252);var vuex__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(33907);var _app_modules_tender_tender__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(99422);var _app_vue_utils_helpers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(56818);var _app_modules_member_member_repository__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(94474);var vue_router__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(42119);var lodash__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(96486);var lodash__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_3__);var useTenders=function useTenders(){var store=(0,vuex__WEBPACK_IMPORTED_MODULE_4__.oR)();var state=(0,vue__WEBPACK_IMPORTED_MODULE_5__.qj)([]);var tenders=(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){return store.getters["tender/tenders"]}));return(0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.Z)((0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.Z)({},(0,vue__WEBPACK_IMPORTED_MODULE_5__.BK)(state)),{},{tenders:tenders,hasTenders:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){return tenders.value&&tenders.value.length>0})),fetchAllTenders:function fetchAllTenders(){return store.dispatch("tender/fetchAll")},fetchActiveTenders:function fetchActiveTenders(){return store.dispatch("tender/fetchActive")},fetchInactiveTenders:function fetchInactiveTenders(){return store.dispatch("tender/fetchInactive")}})};var useTender=function useTender(tender){var dateFormat=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"DD/MM/YYYY";var router=(0,vue_router__WEBPACK_IMPORTED_MODULE_8__.tv)();var state=(0,vue__WEBPACK_IMPORTED_MODULE_5__.qj)({full:false,actions:[]});var actionsList=function actionsList(){return[{method:function method(){return router.push({name:"tenders.edit",params:{id:tender.id}})},label:"Modifier",icon:"pen"},{method:function method(){return tender.file&&typeof tender.file==="string"&&tender.file.trim()!==""?window.open(tender.file,"_blank"):null},label:"Ouvrir le document",icon:"file-pdf"},{method:destroy,label:"Supprimer",icon:"trash-can-list"},{method:toggleActive,label:tender.available?"Bloquer":"Débloquer",icon:tender.available?"ban":"check-double"}]};var _useTenders=useTenders(),fetchInactiveTenders=_useTenders.fetchInactiveTenders,fetchActiveTenders=_useTenders.fetchActiveTenders;var updateActions=function updateActions(){return state.actions=actionsList()};var destroy=function destroy(){return tender.destroy().then((function(){return tender.active?fetchActiveTenders():fetchInactiveTenders()}))};var toggleActive=function toggleActive(){return(tender.available?tender.block():tender.unblock()).then((function(response){tender.available=response.available;return updateActions()}))};(0,vue__WEBPACK_IMPORTED_MODULE_6__.bv)((function(){return state.actions=actionsList()}));return(0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.Z)((0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.Z)({},(0,vue__WEBPACK_IMPORTED_MODULE_5__.BK)(state)),{},{toggleFull:function toggleFull(){return state.full=!state.full},accept:function accept(){return tender.accept().then((function(){return fetchInactiveTenders()}))},deny:function deny(){return tender.deny().then((function(){return fetchInactiveTenders()}))},amount:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){return tender.amount?"".concat(_app_vue_utils_helpers__WEBPACK_IMPORTED_MODULE_1__.Rx.pretty(tender.amount),"€"):"aucun"})),publishedAt:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){var _tender$publishedAt$f,_tender$publishedAt;return(_tender$publishedAt$f=(_tender$publishedAt=tender.publishedAt)===null||_tender$publishedAt===void 0?void 0:_tender$publishedAt.format(dateFormat))!==null&&_tender$publishedAt$f!==void 0?_tender$publishedAt$f:"inconnue"})),expiresAt:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){var _tender$expiresAt$for,_tender$expiresAt;return(_tender$expiresAt$for=(_tender$expiresAt=tender.expiresAt)===null||_tender$expiresAt===void 0?void 0:_tender$expiresAt.format(dateFormat))!==null&&_tender$expiresAt$for!==void 0?_tender$expiresAt$for:"aucune"})),beginAt:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){var _tender$beginAt$forma,_tender$beginAt;return(_tender$beginAt$forma=(_tender$beginAt=tender.beginAt)===null||_tender$beginAt===void 0?void 0:_tender$beginAt.format(dateFormat))!==null&&_tender$beginAt$forma!==void 0?_tender$beginAt$forma:"aucune"})),endAt:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){var _tender$endAt$format,_tender$endAt;return(_tender$endAt$format=(_tender$endAt=tender.endAt)===null||_tender$endAt===void 0?void 0:_tender$endAt.format(dateFormat))!==null&&_tender$endAt$format!==void 0?_tender$endAt$format:"aucune"})),shortDescription:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){var _tender$description;return(_tender$description=tender.description)===null||_tender$description===void 0?void 0:_tender$description.substring(0,200)})),isActive:(0,vue__WEBPACK_IMPORTED_MODULE_6__.Fl)((function(){return tender.active}))})};var useTenderForm=function useTenderForm(){var store=(0,vuex__WEBPACK_IMPORTED_MODULE_4__.oR)();var state=(0,vue__WEBPACK_IMPORTED_MODULE_5__.qj)({tender:_app_modules_tender_tender__WEBPACK_IMPORTED_MODULE_0__.Z.create(),initialState:null,members:null});var fetchMembersByEmail=function fetchMembersByEmail(email){return(0,_app_modules_member_member_repository__WEBPACK_IMPORTED_MODULE_2__.ql)(email).then((function(members){return state.members=members}))};var fetchMembers=function fetchMembers(){return(0,_app_modules_member_member_repository__WEBPACK_IMPORTED_MODULE_2__.K0)().then((function(members){return state.members=members}))};var storeTender=function storeTender(){return store.dispatch("tender/store",{tender:state.tender}).then((function(){return state.tender=_app_modules_tender_tender__WEBPACK_IMPORTED_MODULE_0__.Z.create()}))};var editTender=function editTender(){return store.dispatch("tender/edit",{tender:(0,lodash__WEBPACK_IMPORTED_MODULE_3__.omit)(state.tender,(function(v,k){return state.initialState[k]===v}))}).then((function(){return fetchById(state.tender.id)}))};var fetchById=function fetchById(tenderId){return store.dispatch("tender/fetchById",{tenderId:tenderId}).then((function(response){state.initialState=response;return state.tender=response}))};return(0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.Z)((0,_mnt_c_Users_sofiane_Documents_IT_Projects_sphere_dashboard_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_7__.Z)({},(0,vue__WEBPACK_IMPORTED_MODULE_5__.BK)(state)),{},{fetchMembersByEmail:fetchMembersByEmail,fetchMembers:fetchMembers,storeTender:storeTender,editTender:editTender,fetchById:fetchById})}},27305:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:function(){return form_next_button}});var runtime_core_esm_bundler=__webpack_require__(66252);var shared_esm_bundler=__webpack_require__(3577);var _hoisted_1={class:"btn color-2 pr-0",type:"button"};function render(_ctx,_cache,$props,$setup,$data,$options){var _component_ssf_icon=(0,runtime_core_esm_bundler.up)("ssf-icon");var _component_ssf_col=(0,runtime_core_esm_bundler.up)("ssf-col");var _component_ssf_row=(0,runtime_core_esm_bundler.up)("ssf-row");var _component_ssf_container=(0,runtime_core_esm_bundler.up)("ssf-container");return(0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_container,{name:"form-next-button","not-full":"",onClick:_cache[0]||(_cache[0]=function($event){return _ctx.$emit("next")})},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_row,null,{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_col,{class:"text-right",size:"12"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler._)("button",_hoisted_1,[(0,runtime_core_esm_bundler.Uk)((0,shared_esm_bundler.zw)(_ctx.text)+" ",1),(0,runtime_core_esm_bundler.Wm)(_component_ssf_icon,{icon:"arrow-to-right",light:""})])]})),_:1})]})),_:1})]})),_:1})}var form_next_buttonvue_type_script_lang_ts=(0,runtime_core_esm_bundler.aZ)({name:"form-next-button",emits:["next"],props:{text:{type:String,required:false,default:"Suivant"}},setup:function setup(){return{}}});var exportHelper=__webpack_require__(83744);const __exports__=(0,exportHelper.Z)(form_next_buttonvue_type_script_lang_ts,[["render",render]]);var form_next_button=__exports__},40476:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:function(){return form_tender_information}});var runtime_core_esm_bundler=__webpack_require__(66252);function render(_ctx,_cache,$props,$setup,$data,$options){var _component_qrcp_input=(0,runtime_core_esm_bundler.up)("qrcp-input");var _component_ssf_row=(0,runtime_core_esm_bundler.up)("ssf-row");var _component_form_next_button=(0,runtime_core_esm_bundler.up)("form-next-button");var _component_ssf_container=(0,runtime_core_esm_bundler.up)("ssf-container");return(0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_ssf_container,{name:"form-tender-information"},{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_ssf_row,null,{default:(0,runtime_core_esm_bundler.w5)((function(){return[(0,runtime_core_esm_bundler.Wm)(_component_qrcp_input,{errors:_ctx.errors,value:_ctx.tender.title,col:"col-12 col-md-8",icon:"font",label:"Titre de l'affaire",name:"title",required:"","onUpdate:value":_cache[0]||(_cache[0]=function(event){return _ctx.tender.title=event})},null,8,["errors","value"]),(0,runtime_core_esm_bundler.Wm)(_component_qrcp_input,{errors:_ctx.errors,value:_ctx.tender.amount,col:"col-12 col-md-4",icon:"euro-sign",label:"Budget maximum",min:"1",name:"amount",type:"number","onUpdate:value":_cache[1]||(_cache[1]=function(event){return _ctx.tender.amount=event})},null,8,["errors","value"])]})),_:1}),(0,runtime_core_esm_bundler.Wm)(_component_qrcp_input,{errors:_ctx.errors,value:_ctx.tender.description,icon:"message-captions",label:"Description",name:"description",required:"",row:"",textarea:"","onUpdate:value":_cache[2]||(_cache[2]=function(event){return _ctx.tender.description=event})},null,8,["errors","value"]),(0,runtime_core_esm_bundler.Wm)(_component_qrcp_input,{errors:_ctx.errors,value:_ctx.searchPremiumMember,"form-group-class":"mb-0",icon:"magnifying-glass","input-class":"members-search",label:"Rechercher un adhérent (avec l'adresse e-mail)",name:"searchPremiumMember",row:"",onInput:_ctx.onSearchInput,"onUpdate:value":_ctx.onSearchPremiumMemberUpdateValue},null,8,["errors","value","onInput","onUpdate:value"]),_ctx.members?((0,runtime_core_esm_bundler.wg)(),(0,runtime_core_esm_bundler.j4)(_component_qrcp_input,{key:0,errors:_ctx.errors,icon:_ctx.Member.icon.name,"option-items":_ctx.members,value:_ctx.tender.memberId,"form-group-class":"mt-0","input-class":"border-top-0 members-select",label:"Adhérents",name:"memberId","option-field":"id","option-label":"companyName",required:"",row:"",select:"","onUpdate:value":_cache[3]||(_cache[3]=function(event){return _ctx.tender.memberId=event})},null,8,["errors","icon","option-items","value"])):(0,runtime_core_esm_bundler.kq)("",true),(0,runtime_core_esm_bundler.Wm)(_component_form_next_button,{onNext:_ctx.onNext},null,8,["onNext"])]})),_:1})}var asyncToGenerator=__webpack_require__(48534);var regenerator=__webpack_require__(19298);var regenerator_default=__webpack_require__.n(regenerator);var reactivity_esm_bundler=__webpack_require__(2262);var tender_module=__webpack_require__(72903);var qrcp_input=__webpack_require__(50918);var commons_form=__webpack_require__(37670);var member=__webpack_require__(73945);var lodash=__webpack_require__(96486);var form_next_button=__webpack_require__(27305);var tender=__webpack_require__(99422);var form_tender_informationvue_type_script_lang_ts=(0,runtime_core_esm_bundler.aZ)({name:"form-tender-information",components:{FormNextButton:form_next_button["default"],QrcpInput:qrcp_input.Z},emits:["next"],props:{tender:{type:tender.Z,required:true},isEdition:{type:Boolean,required:false,default:false}},setup:function setup(props,_ref){var emit=_ref.emit;var _useTenderForm=(0,tender_module.DT)(),members=_useTenderForm.members,fetchMembersByEmail=_useTenderForm.fetchMembersByEmail,fetchMembers=_useTenderForm.fetchMembers;var _useForm=(0,commons_form.c)(),errors=_useForm.errors,validator=_useForm.validator;var searchPremiumMember=(0,reactivity_esm_bundler.iH)(null);var isTyping=(0,reactivity_esm_bundler.iH)(false);var onSearchPremiumMemberUpdateValue=function onSearchPremiumMemberUpdateValue(value){isTyping.value=true;searchPremiumMember.value=value};var onSearchInput=(0,lodash.debounce)((0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(){return regenerator_default().wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isTyping.value=false;props.tender.memberId=null;if(!(searchPremiumMember.value&&searchPremiumMember.value.trim()!=="")){_context.next=7;break}_context.next=5;return fetchMembersByEmail(searchPremiumMember.value);case 5:_context.next=9;break;case 7:_context.next=9;return fetchMembers();case 9:case"end":return _context.stop()}}}),_callee)}))),500);(0,runtime_core_esm_bundler.bv)((function(){return fetchMembers()}));var onNext=function onNext(){var tenderValue=props.tender;return props.isEdition||validator({title:tenderValue.title,description:tenderValue.description,memberId:tenderValue.memberId})?emit("next"):null};return{errors:errors,onNext:onNext,members:members,onSearchInput:onSearchInput,onSearchPremiumMemberUpdateValue:onSearchPremiumMemberUpdateValue,searchPremiumMember:searchPremiumMember,Member:member.Z}}});var exportHelper=__webpack_require__(83744);const __exports__=(0,exportHelper.Z)(form_tender_informationvue_type_script_lang_ts,[["render",render],["__scopeId","data-v-28cad312"]]);var form_tender_information=__exports__}}]);